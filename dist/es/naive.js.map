{"version":3,"file":"naive.js","sources":["../../src/utils.js","../../src/dom.js","../../src/vdom/vtext.js","../../src/directives/class.js","../../src/directives/show.js","../../src/directives/style.js","../../src/directive.js","../../src/event.js","../../src/vdom/vnode.js","../../src/vdom/utils.js","../../src/vdom/patch.js","../../src/vdom/list-diff.js","../../src/vdom/diff.js","../../src/vdom/h.js","../../src/api/hooks.js","../../src/exception.js","../../src/main.js"],"sourcesContent":["export function warn (message) {\n  if (window.console) {\n    console.warn(`[naive.js] ${message}`);\n  }\n}\n\nexport function error (message) {\n  if (window.console) {\n    console.error(`[naive.js] ${message}`);\n  }\n}\n\nexport const isArray = Array.isArray ? Array.isArray : function isArray (obj) {\n  return Object.prototype.toString.call(obj) === '[object Array]';\n};\n\nexport function isUndefined (obj) {\n  return typeof obj === 'undefined';\n}\n\nexport function noop () {}\n\nexport function extend(obj, props) {\n  if (props) {\n    for (let i in props) obj[i] = props[i];\n  }\n  return obj;\n}\n\nexport function clone(obj) {\n  return extend({}, obj);\n}\n\nexport function isFunction (obj) {\n  return typeof obj === 'function';\n}\n\nexport function isPlainObject (obj) {\n  return obj != null && typeof obj === 'object' && !isArray(obj) && Object.prototype.toString.call(obj) === '[object Object]';\n}\n\nlet resolved = typeof Promise!=='undefined' && Promise.resolve();\nexport const defer = resolved ? (f => { resolved.then(f); }) : setTimeout; // asap async\n","import { isUndefined } from './utils';\n\n/**\n * 获取元素\n *\n * IE 8 只支持到 CSS2 选择器\n *\n * @param {String} selector\n */\nexport function getElement(selector) {\n  return typeof selector === 'string' ? query(selector) : selector;\n}\n\nexport function createElement(tag) {\n  return document.createElement(tag);\n}\n\nexport function createTextNode (text) {\n  return document.createTextNode(text);\n}\n\nexport function createDocumentFragment () {\n  return document.createDocumentFragment();\n}\n\nexport function query(selector, context) {\n  context = context || document;\n  return context.querySelector(selector);\n}\n\n/**\n * 检查一个元素是否在 document 内\n */\nexport function inDoc(node) {\n  var doc = node.ownerDocument.documentElement;\n  return doc === node || node && node.nodeType === 1 && doc.contains(node);\n}\n\nexport function removeNode(node) {\n  node.parentNode.removeChild(node)\n}\n\nexport function createAnchor(name) {\n  var n = document.createTextNode('');\n  n.name = name;\n  return n;\n}\n\nexport function before(newNode, node) {\n  node.parentNode.insertBefore(newNode, node);\n}\n\nexport function replaceNode(newNode, node) {\n  node.parentNode.replaceChild(newNode, node);\n}\n\nexport function after(el, target) {\n  if (target.nextSibling) {\n    before(el, target.nextSibling)\n  } else {\n    target.parentNode.appendChild(el)\n  }\n}\n\nexport function appendChild (el, target) {\n  target.appendChild(el);\n}\n\nexport function setAttr (node, attr, value) {\n  node.setAttribute(attr, value);\n}\n\nexport function hasAttr(node, name) {\n  return node.hasAttribute(name);\n}\n\nexport function removeAttr(node, name) {\n  node.removeAttribute(name);\n}\n\nexport function removeAllChildren(node) {\n  while(node.childNodes.length > 0) {\n    node.removeChild(node.childNodes[0]);\n  }\n}\n\n\nconst classSplitReg = /\\s+/;\n\nconst supportClassList = !isUndefined(document.createElement('div').classList);\n\nlet getClasses = supportClassList ?\n  function(element) {\n    return Array.prototype.slice.call(element.classList);\n  }\n  :\n  function(element) {\n    return element.className.split(/\\s+/).filter(s => s);\n  };\n\nexport let hasClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var contains = true;\n    for (let i = 0; i < classes.length; ++i) {\n      if (!element.classList.contains(classes[i])) {\n        contains = false;\n        break;\n      }\n    }\n    return contains;\n  }\n  :\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var contains = true, tmp = element.className;\n    for (let i = 0; i < classes.length; ++i) {\n      if (tmp.indexOf(classes[i]) === -1) {\n        contains = false;\n        break;\n      }\n    }\n    return contains;\n  };\n\nexport let addClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    element.classList.add.apply(element.classList, classes);\n    return element;\n  }\n  :\n  function(element, classes) {\n    var tmp = element.className;\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      if (!hasClass(element, c)) {\n        tmp = tmp.replace(/\\s+|$/, ' ' + classes);\n      }\n    });\n    element.className = tmp;\n    return element;\n  };\n\nexport let removeClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    element.classList.remove.apply(element.classList, classes);\n    return element;\n  }\n  :\n  function(element, classes) {\n    var tmp = element.className;\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      if (hasClass(element, c)) {\n        tmp = tmp.replace(new RegExp(c, 'g'), '');\n      }\n    });\n    element.className = tmp;\n    return element;\n  };\n\nexport let toggleClass = supportClassList ?\n  function(element, classes, force) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      element.classList.toggle(c, force);\n    });\n    return element;\n  }\n  :\n  function(element, classes, force) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var useForce = force !== undefined;\n    classes.forEach(c => {\n      if (hasClass(element, c) && (useForce && !force || !useForce)) {\n        removeClass(element, c);\n      } else if (!hasClass(element, c) && (useForce && force || !useForce)) {\n        addClass(element, c);\n      }\n    });\n    return element;\n  };\n","import { createTextNode } from '../dom';\n\n// virtual text node\nexport default function VText (text) {\n  this.data = text;\n}\n\nVText.prototype.render = function vdom2dom () {\n  return createTextNode(this.data);\n};\n","import { isArray } from '../utils';\nimport { addClass, removeClass, setAttr } from '../dom';\n\nexport default function klass (setValue, element, context) {\n  if (typeof setValue === 'string') {\n    setAttr(element, 'class', setValue);\n  } else if (isArray(setValue)) {\n    setAttr(element, 'class', setValue.join(' '));\n  } else {\n    for (let c in setValue) {\n      if (setValue.hasOwnProperty(c)) {\n        if (setValue[c]) {\n          addClass(element, c);\n        } else {\n          removeClass(element, c);\n        }\n      }\n    }\n  }\n}\n","export default function show (value, element, context) {\n  element.style.display = value ? '' : 'none';\n}\n","export default function style (value, element, context) {\n  for (let s in value) {\n    element.style[s] = value[s];\n  }\n}\n","import { setAttr, removeClass } from './dom';\nimport { isArray } from './utils';\n\nimport klass from './directives/class';\nimport show from './directives/show';\nimport style from './directives/style';\n\nexport function handleDirective (directive, value, element, context) {\n  switch (directive) {\n    case 'show':\n      show(value, element, context);\n      break;\n    case 'class':\n      klass(value, element, context);\n      break;\n    case 'style':\n      style(value, element, context);\n      break;\n    default:\n      setAttr(element, directive, value);\n      break;\n  }\n}\n\nfunction removeClassAttr (removeValue, element, context) {\n  if (typeof removeValue === 'string') {\n    removeClass(element, removeValue);\n  } else if (isArray(removeValue)) {\n    removeClass(element, removeValue.join(' '));\n  } else {\n    for (let c in removeValue) {\n      if (removeValue.hasOwnProperty(c)) {\n        removeClass(element, c);\n      }\n    }\n  }\n}\n\nexport function handleDirectiveRemove (directive, value, element, context) {\n  switch (directive) {\n    case 'class':\n      removeClassAttr(value, element, context);\n      break;\n  }\n}\n","import { noop } from './utils';\n\nexport function attachEvent (el, eventName, handler) {\n  if (el.addEventListener) {\n    el.addEventListener(eventName, handler, false);\n  } else if (el.attachEvent) {\n    el.attachEvent(eventName, handler);\n  } else {\n    el[`on${eventName}`] = handler;\n  }\n}\n\nexport function detachEvent (el, eventName, handler) {\n  if (el.removeEventListener) {\n    el.removeEventListener(eventName, handler, false);\n  } else if (el.detachEvent) {\n    el.detachEvent(eventName, handler);\n  } else {\n    el[`on${eventName}`] = noop;\n  }\n}\n","import { createElement, setAttr, appendChild } from '../dom';\nimport VText from './vtext';\nimport { isVNode, isVText } from './utils';\nimport { isArray, isFunction } from '../utils';\nimport { handleDirective } from '../directive';\nimport { attachEvent } from '../event';\n\nexport default function VNode (tagName, props, children, key) {\n  this.tagName = tagName;\n  this.props = props || {};\n  this.key = key ? String(key) : undefined; // key 用来标识节点，方便 diff\n  let childNodes = [];\n  children = children || [];\n  for (let i = 0; i < children.length; ++i) {\n    const child = children[i];\n    if (isVNode(child) || isVText(child) || child._isComponent) {\n      childNodes.push(child);\n    } else if (typeof child === 'string' || typeof child === 'number') {\n      childNodes.push(new VText(child));\n    } else if (isArray(child)) {\n      childNodes = childNodes.concat(child);\n    } else {\n      // ignore\n    }\n  }\n  this.children = childNodes;\n  let count = this.children.length;\n  for (let i = 0; i < this.children.length; ++i) {\n    count += this.children[i].count || 0;\n  }\n  this.count = count; // 记录子节点数，方便 patch 的时候找到节点位置\n}\n\n// 检查是否指令属性\nfunction checkAttrDirective (attr) {\n  return /^@|n-|:/.test(attr);\n}\n\n// add event listener\nfunction isEventDirective (attr) {\n  return /^@/.test(attr);\n}\n\nVNode.prototype.render = function vdom2dom(context) {\n  const el = createElement(this.tagName);\n  const props = this.props;\n  for (let p in props) {\n    if (checkAttrDirective(p)) {\n      // 处理指令\n      if (/^n-/.test(p)) {\n        handleDirective(p.slice(2), props[p], el, context);\n      } else if (/^:/.test(p)) {\n        handleDirective(p.slice(1), props[p], el, context);\n      } else {\n        const eventName = p.slice(1);\n        const handlerFunc = isFunction(props[p]) ? props[p] : context[props[p]];\n        attachEvent(el, eventName, function handler(evt) {\n          handlerFunc.call(context, evt);\n        });\n      }\n    } else {\n      setAttr(el, p, props[p]);\n    }\n  }\n  for (let i = 0; i < this.children.length; ++i) {\n    appendChild(this.children[i].render(context), el);\n  }\n  return el;\n};\n","import VText from './vtext';\nimport VNode from './vnode';\n\nexport function isVNode (node) {\n  return node instanceof VNode;\n}\n\nexport function isVText (node) {\n  return node instanceof VText;\n}\n","import { setAttr, replaceNode, removeNode, removeAttr } from '../dom';\nimport { handleDirective, handleDirectiveRemove } from '../directive';\nimport { attachEvent, detachEvent } from '../event';\n\nexport const PATCH = {\n  REPLACE: 0, // 替换节点\n  INSERT: 1, // 插入\n  REMOVE: 2, // 移除\n  REORDER: 3, // 重排\n  PROPS: 4, // 修改属性\n  TEXT: 5 // 替换文本\n};\n\nexport function patch (context, domNode, patches) {\n  const walker = {index: 0};\n  dfsWalk(context, domNode, walker, patches);\n}\n\nfunction dfsWalk (context, domNode, walker, patches) {\n  const currentPatches = patches[walker.index];\n\n  const len = domNode.childNodes ? domNode.childNodes.length : 0;\n  for (let i = 0; i < len; i++) {\n    const child = domNode.childNodes[i];\n    walker.index++;\n    dfsWalk(context, child, walker, patches);\n  }\n  if (currentPatches) {\n    applyPatches(context, domNode, currentPatches);\n  }\n}\n\nfunction patchReorder (context, domNode, moves) {\n  for (let i = 0; i < moves.length; ++i) {\n    const move = moves[i];\n    switch (move.type) {\n      case PATCH.INSERT: // 插入新节点\n        const target = domNode.childNodes[move.index] || null; // null 插入末尾\n        domNode.insertBefore(move.item.render(context), target);\n        break;\n      case PATCH.REMOVE:\n        removeNode(domNode.childNodes[move.index]);\n        break;\n      default:\n        // error type\n    }\n  }\n}\n\n// 检查是否指令属性\nfunction isAttrDirective (attr) {\n  return /^@|n-|:/.test(attr);\n}\n// 检查是否事件指令\nfunction isEventDirective (attr) {\n  return /^@/.test(attr);\n}\n\nfunction patchProps (domNode, patch, context) {\n  for (let p in patch.props) {\n    if (patch.props.hasOwnProperty(p)) {\n      // 检查是否指令属性\n      if (isAttrDirective(p)) {\n        // 处理指令\n        if (/^n-/.test(p)) {\n          handleDirective(p.slice(2), patch.props[p], domNode, context);\n        } else if (/^:/.test(p)) {\n          handleDirective(p.slice(1), patch.props[p], domNode, context);\n        } else {\n          // 事件指令\n          // remove old event listener\n          // detachEvent(domNode, p.slice(1), patch.props[p]);\n          // add new event listener\n        }\n      } else { // 普通属性\n        if (typeof patch.props[p] === 'undefined') {\n          removeAttr(domNode, p);\n        } else {\n          setAttr(domNode, p, patch.props[p]);\n        }\n      }\n    }\n  }\n  // @TODO remove 错误\n  for (let p in patch.removeProps) {\n    if (patch.removeProps.hasOwnProperty(p)) {\n      if (isAttrDirective(p)) {\n        if (/^n-/.test(p)) {\n        } else if (/^:/.test(p)) {\n          handleDirectiveRemove(p.slice(1), patch.removeProps[p], domNode, context);\n        } else {\n        }\n      }\n    }\n  }\n}\n\n// 根据补丁更新 DOM 节点\nfunction applyPatches (context, domNode, patches) {\n  for (let i = 0; i < patches.length; ++i) {\n    const patch = patches[i];\n    switch (patch.type) {\n      case PATCH.REPLACE: // 替换元素节点\n        replaceNode(patch.node.render(context), domNode);\n        break;\n      case PATCH.PROPS: // 属性修改\n        patchProps(domNode, patch, context);\n        break;\n      case PATCH.TEXT: // 替换文本内容\n        domNode.data = patch.data;\n        break;\n      case PATCH.REORDER: // 子节点重新排序\n        patchReorder(context, domNode, patch.moves);\n        break;\n      default:\n        // warn\n    }\n  }\n}\n","import { PATCH } from './patch'; //REORDER_INSERT\n\n// 分别找到有 key 的元素位置和没有 key 的元素的位置\nfunction makeKeyIndexAndFree (list) {\n  const keyIndex = {}; // 有 key 的节点位置\n  const free = []; // 可替换的位置（没有 key 的节点都被标识为可替换的节点）\n  for (let i = 0, len = list.length; i < len; i++) {\n    const item = list[i]\n    const itemKey = item.key;\n    if (itemKey) {\n      keyIndex[itemKey] = i;\n    } else {\n      free.push(item);\n    }\n  }\n  return {\n    keyIndex: keyIndex,\n    free: free\n  };\n}\n\nexport default function listDiff (pList, nList) {\n  const nMap = makeKeyIndexAndFree(nList);\n  const nKeys = nMap.keyIndex, nFree = nMap.free;\n  const pMap = makeKeyIndexAndFree(pList);\n  const pKeys = pMap.keyIndex, pFree = pMap.free;\n\n  // rList 数组保存的是 nList 的节点，根据 key 找到 pList 中的对应节点并按照 pList 中节点的顺序排列，这样就可以在 diffChildren 的时候按顺序一一比较\n  // 在“重排”的过程中，记录实现 nList 的节点顺序的重排操作，保存在 moves 中，这样在 patch 的时候就可以找到对应的 dom\n  const rList = [];\n\n  // 找 pList 中有 key 的节点的对应节点\n  for (let i = 0, freeIndex = 0; i < pList.length; ++i) {\n    const item = pList[i];\n    const itemKey = item.key;\n    if (itemKey) {\n      if (!nKeys.hasOwnProperty(itemKey)) { // 如果 pList 有但 nList 没有，说明该节点一定会被删掉\n        rList.push(null);\n      } else { // 有对应节点\n        const itemKeyIndex = nKeys[itemKey];\n        rList.push(nList[itemKeyIndex]);\n      }\n    } else { // 如果该节点没有 key 就在 nList 中也找一个没有 key 的节点（空闲节点）来填这个位置（按照顺序取），如果 nList 已经没有“空闲节点”，那么这个节点一定会被删掉\n      rList.push(nFree[freeIndex++] || null);\n    }\n  }\n  const moves = [];\n  function remove (index) {\n    moves.push({\n      type: PATCH.REMOVE,\n      index: index\n    });\n  }\n  function insert (index, item) {\n    moves.push({\n      type: PATCH.INSERT,\n      index: index,\n      item: item\n    });\n  }\n  // rList 已经处理完，开始模拟 reorder 操作，找出实际 reorder 的操作步骤\n  // simulateList 用来模拟 reorder 过程中的 pList\n  const simulateList = rList.slice(0);\n  // 找出 pList 中被移除的节点（前面已经标识为 null 的节点）\n  for (let i = 0; i < simulateList.length;) {\n    if (simulateList[i] === null) {\n      remove(i);\n      simulateList.splice(i, 1);\n    } else {\n      ++i;\n    }\n  }\n  // 遍历 nList 安排其他节点，包括没有被删的节点（有 key 对应的节点）、nList 中有 pList 中没有的节点\n  for (let s = 0, n = 0; n < nList.length; ++n) {\n    const nItem = nList[n];\n    const nItemKey = nItem.key;\n    const sItem = simulateList[s];\n    if (sItem) { // 已经超出 simulateList 范围，剩余的节点都插入\n      const sItemKey = sItem.key;\n      if (sItemKey === nItemKey) { // 位置相同，不需要 reorder 包括没有 key 的也不需要 reorder\n        ++s;\n      } else {\n        if (typeof nItemKey !== 'undefined' && !pKeys.hasOwnProperty(nItemKey)) { // 旧列表中不存在，新节点直接插入\n          insert(n, nItem);\n        } else { // 旧列表中存在，需要对 sItem 和 nItem 进行对调\n          const nextSItem = simulateList[s + 1];\n          if (nextSItem && (nextSItem.key === nItemKey)) {\n            remove(n);\n            simulateList.splice(s, 1);\n            ++s;\n          } else {\n            insert(n, nItem);\n            if (n === nList.length-1) {\n              remove(n+1);\n            }\n          }\n        }\n      }\n    } else { // 旧列表该位置为空，直接插入\n      insert(n, nItem);\n    }\n  }\n  return {\n    moves: moves,\n    rList: rList\n  };\n}\n","import { isVNode, isVText } from './utils';\nimport listDiff from './list-diff';\nimport { PATCH } from './patch';\nimport { isArray, isPlainObject } from '../utils';\n\n// diff two vdom node\nexport function diff (oldTree, newTree) {\n  let index = 0;\n  let patches = {};\n  if (isArray(oldTree)) {\n    const currentPatches = [];\n    diffChildren(oldTree, newTree, 0, patches, currentPatches);\n    if (currentPatches.length) {\n      patches[0] = currentPatches;\n    }\n  } else {\n    diffWalk(oldTree, newTree, index, patches);\n  }\n  return patches;\n}\n\nfunction diffWalk (pNode, nNode, index, patches) {\n  let currentPatches = []; // 当前层级的 patch\n  if (nNode === null) {\n    // 这种情况属于：在 diffChildren 的时候该节点被标识为被删除的节点，但是不需要在这里删除（在 reorder 的时候会处理删除）\n  } else if (isVNode(pNode) && isVNode(nNode)) { // 都是 VNode\n    if (pNode.tagName !== nNode.tagName || pNode.key !== nNode.key) { // 不同节点，或者已标识不是同一节点，要替换\n      currentPatches.push({type: PATCH.REPLACE, node: nNode});\n    } else {\n      let propsPatches = diffProps(pNode, nNode);\n      if (propsPatches) {\n        currentPatches.push({type: PATCH.PROPS, props: propsPatches.set, removeProps: propsPatches.remove});\n      }\n      // 继续 diff 子节点\n      diffChildren(pNode.children, nNode.children, index, patches, currentPatches);\n    }\n  } else if (isVText(pNode) && isVText(nNode)) { // 都是 VText\n    if (pNode.data !== nNode.data) { // 内容不一样的时候才替换（只替换内容即可）\n      currentPatches.push({type: PATCH.TEXT, data: nNode.data});\n    }\n  } else if (pNode._isComponent && nNode._isComponent) { // 都是组件\n  } else { // 类型不一样，绝对要替换\n    currentPatches.push({type: PATCH.REPLACE, node: nNode});\n  }\n  if (currentPatches.length) {\n    patches[index] = currentPatches;\n  }\n}\n\n// 快速比较两个对象是否“相等”\nfunction objectEquals (a, b) {\n  return JSON.stringify(a) === JSON.stringify(b);\n}\n\nfunction diffProps (oldTree, newTree) {\n  let oldTreeProps = oldTree.props;\n  let newTreeProps = newTree.props;\n  let setPropsPatches = {}, removePropsPatches = {}, hasPatch = false;\n  for (let p in oldTreeProps) {\n    if (!newTreeProps.hasOwnProperty(p) || typeof newTreeProps[p] === 'undefined') { // 属性被移除\n      hasPatch = true;\n      removePropsPatches[p] = oldTreeProps[p];\n    } else if (isPlainObject(newTreeProps[p])) {\n      if (!objectEquals(newTreeProps[p], oldTreeProps[p])) {\n        hasPatch = true;\n        setPropsPatches[p] = newTreeProps[p];\n      }\n    } else if (newTreeProps[p] !== oldTreeProps[p]) {\n      hasPatch = true;\n      setPropsPatches[p] = newTreeProps[p];\n    }\n  }\n  // 检查新属性\n  for (let p in newTree) {\n    if (newTree.hasOwnProperty(p) && !oldTree.hasOwnProperty(p)) {\n      hasPatch = true;\n      setPropsPatches[p] = newTreeProps[p];\n    }\n  }\n  if (!hasPatch) {\n    return null;\n  }\n  return {\n    set: setPropsPatches,\n    remove: removePropsPatches\n  };\n}\n\nfunction diffChildren (pChildNodes, nChildNodes, index, patches, currentPatches) {\n  const diffs = listDiff(pChildNodes, nChildNodes, index, patches);\n  const reorderChildNodes = diffs.rList;\n\n  if (diffs.moves.length) { // 需要 reorder\n    // reorder 的操作在父节点执行，所以应该加到父节点的 patch\n    const reorderPatch = { type: PATCH.REORDER, moves: diffs.moves };\n    currentPatches.push(reorderPatch);\n  }\n  \n  // 除了重排的 patch 还有各个子节点自身的 patch\n  let leftNode = null;\n  let currentNodeIndex = index;\n  for (let i = 0; i < pChildNodes.length; ++i) {\n    currentNodeIndex = (leftNode && leftNode.count)\n      ? currentNodeIndex + leftNode.count + 1\n      : currentNodeIndex + 1\n    diffWalk(pChildNodes[i], reorderChildNodes[i], currentNodeIndex, patches);\n    leftNode = pChildNodes[i];\n  }\n}\n","import VNode from './vnode';\nimport VText from './vtext';\nimport { isArray, isPlainObject } from '../utils';\nimport { isVNode, isVText } from './utils';\n\nimport Naive from '../main';\n\nexport default function h (tagName, props, children, key) {\n  const context = this || {};\n  const components = context['components'] || {};\n  if (isVNode(tagName) || isVText(tagName)) {\n    return tagName;\n  } else if (isPlainObject(tagName)) {\n    if (components.hasOwnProperty(tagName.tagName)) {\n      console.log(tagName.tagName);\n    }\n    return new VNode(tagName.tagName, tagName.attrs, tagName.children, tagName.key);\n  } else if (isArray(tagName)) {\n    const list = [];\n    for (let i = 0; i < tagName.length; ++i) {\n      list.push(h(tagName[i]));\n    }\n    return list;\n  } else if(arguments.length < 2) {\n    return new VText(tagName);\n  } else {\n    if (components.hasOwnProperty(tagName)) {\n      return components[tagName]();\n    } else {\n      return new VNode(tagName, props, children, key);\n    }\n  }\n}\n","import { isArray } from '../utils';\n\nexport function addHook (hookName, callback) {\n  let callbacks = this._hooks[hookName];\n  if (!callbacks) {\n    callbacks = [];\n  }\n  if (isArray(callback)) {\n    callbacks = callbacks.concat(callback);\n  } else {\n    callbacks.push(callback);\n  }\n  this._hooks[hookName] = callbacks;\n}\n\nexport function removeHook (hookName, callback) {\n  const callbacks = this._hooks[hookName];\n  if (!callbacks || callbacks.length === 0) {\n    return this;\n  }\n  if (!callback) {\n    callbacks.splice(0, callbacks.length);\n  } else {\n    for (let i = 0; i < callbacks.length; ++i) {\n      if (callbacks[i] === callback) {\n        callbacks.splice(i, 1);\n        break;\n      }\n    }\n  }\n  return this;\n}\n\nexport function callHooks (hookName) {\n  const _callbacks = this._hooks[hookName] || [];\n  for (let i = 0; i < _callbacks.length; ++i) {\n    _callbacks[i].call(this);\n  }\n}\n","export function NaiveException (message) {\n  this.name = 'NaiveException';\n  this.message = message;\n}\n","import { getElement, createDocumentFragment, appendChild, replaceNode } from './dom';\nimport { diff, patch } from './vdom/vdom';\nimport h from './vdom/h';\nimport { warn, extend, isFunction, isPlainObject } from './utils';\nimport { addHook, removeHook, callHooks } from './api/hooks';\nimport { NaiveException } from './exception';\n\nfunction emptyRender () {\n  return null;\n}\n\nexport default function Naive (options) {\n  options = options || {};\n  this.name = options.name || '';\n  this._hooks = {};\n  this._isComponent = true;\n  if ('state' in options) {\n    if (!isFunction(options.state)) {\n      // 必须是 function\n      throw new NaiveException('state 必须是 [Function]');\n    }\n    const _state = options.state();\n    if (isPlainObject(_state)) {\n      this.state = _state;\n    } else {\n      warn('state 必须返回 [Plain Object]');\n      this.state = {};\n    }\n  } else {\n    this.state = {};\n  }\n  const context = this;\n  const _vdomRender = options.render || emptyRender;\n  const _templateHelpers = {\n    \"if\": function (condition, options) {\n      return condition ? h(options) : condition;\n    },\n    \"each\": function (list, createItem) {\n      const nodes = [];\n      for (let i = 0; i < list.length; ++i) {\n        const item = list[i];\n        const key = isPlainObject(item) && 'id' in item ? item['id'] : i;\n        nodes.push(h(createItem.call(context, item, i, key)));\n      }\n      return nodes;\n    }\n  };\n  this.vdomRender = function vdomRender () {\n    return _vdomRender.call(\n      this,\n      function createVdom () {\n        return h.apply(context, Array.prototype.slice.call(arguments, 0));\n      },\n      _templateHelpers\n    );\n  };\n  this.ele = null;\n  // components\n  this.components = {};\n  const componentsOptions = options.components || {};\n  for (let p in componentsOptions) {\n    if (componentsOptions.hasOwnProperty(p)) {\n      const componentDefine = componentsOptions[p] || {};\n      componentDefine.name = componentDefine.name || p;\n      context.components[p] = createComponentCreator(this, componentDefine);\n    }\n  }\n  this._init(options);\n}\n\nfunction createComponentCreator (context, componentDefine) {\n  return function createComponent() {\n    return new Naive(componentDefine);\n  };\n}\n\nconst prtt = Naive.prototype;\n\nprtt.render = function render () {\n  const vdom = this.vdom;\n  if (vdom.length) { // fragment\n    const docFragment = createDocumentFragment();\n    const simFragment = { childNodes: [] };\n    for (let i = 0; i < vdom.length; ++i) {\n      const node = vdom[i].render(this);\n      simFragment.childNodes.push(node);\n      appendChild(node, docFragment);\n    }\n    this.ele = simFragment;\n    return docFragment;\n  } else {\n    this.ele = vdom.render(this);\n    return this.ele;\n  }\n};\n\nprtt.setState = function setState (state) {\n  extend(this.state, state);\n  this.update(); // @TODO nextTick 的时候再 update\n  return this;\n};\n\n// 更新视图\nprtt.update = function update () {\n  if (!this.mounted) { // 如果组件没有挂载到元素上，不需要更新视图\n    return this;\n  }\n  const preVdom = this.vdom;\n  this.vdom = this.vdomRender();\n  // console.log(preVdom, this.vdom);\n  const patches = diff(preVdom, this.vdom);\n  // console.log(patches);\n  if (patches) {\n    patch(this, this.ele, patches);\n  } else {\n    warn('不需要更新视图');\n  }\n};\n\nprtt._init = function _init (options) {\n  const methods = options.methods || {};\n  // 将 methods 移到 this\n  for (let m in methods) {\n    if (methods.hasOwnProperty(m)) {\n      if (this.hasOwnProperty(m)) {\n        warn(`属性 \"${m}\" 已存在`);\n      } else {\n        this[m] = methods[m];\n      }\n    }\n  }\n  const hooks = options.hooks || {};\n  for (let p in hooks) {\n    if (hooks.hasOwnProperty(p)) {\n      this._addHook(p, hooks[p]);\n    }\n  }\n  this.vdom = this.vdomRender();\n};\n\nprtt.mount = function mount (selector) {\n  const mountPoint = typeof selector === 'string' ? getElement(selector) : selector;\n  if (!mountPoint) {\n    throw new NaiveException('找不到挂载节点');\n  }\n  replaceNode(this.render(), mountPoint);\n  this.mounted = true;\n  this._callHooks('mounted');\n};\n\nprtt._callHooks = callHooks;\n\nprtt._addHook = addHook;\n\nprtt._removeHook = removeHook;\n\n// 销毁组件\nprtt.destroy = function destroy () {\n  // 销毁事件监听\n  // 调用 destroy 勾子\n  this._callHooks('destroy');\n  // 销毁勾子回调\n  for (let p in this._hooks) {\n    if (this._hooks.hasOwnProperty(p)) {\n      this._removeHook(p);\n    }\n  }\n};\n"],"names":["warn","message","window","console","isArray","Array","obj","Object","prototype","toString","call","isUndefined","extend","props","i","isFunction","isPlainObject","getElement","selector","query","createElement","tag","document","createTextNode","text","createDocumentFragment","context","querySelector","removeNode","node","parentNode","removeChild","replaceNode","newNode","replaceChild","appendChild","el","target","setAttr","attr","value","setAttribute","removeAttr","name","removeAttribute","supportClassList","classList","hasClass","element","classes","split","filter","s","contains","length","tmp","className","indexOf","addClass","add","apply","forEach","c","replace","removeClass","remove","RegExp","VText","data","render","vdom2dom","klass","setValue","join","hasOwnProperty","show","style","display","handleDirective","directive","removeClassAttr","removeValue","handleDirectiveRemove","attachEvent","eventName","handler","addEventListener","VNode","tagName","children","key","String","undefined","childNodes","child","isVNode","isVText","_isComponent","push","concat","count","checkAttrDirective","test","p","slice","handlerFunc","evt","PATCH","patch","domNode","patches","walker","index","dfsWalk","currentPatches","len","patchReorder","moves","move","type","INSERT","insertBefore","item","REMOVE","isAttrDirective","patchProps","removeProps","applyPatches","REPLACE","PROPS","TEXT","REORDER","makeKeyIndexAndFree","list","keyIndex","free","itemKey","listDiff","pList","nList","nMap","nKeys","nFree","pMap","pKeys","pFree","rList","freeIndex","itemKeyIndex","insert","simulateList","splice","n","nItem","nItemKey","sItem","sItemKey","nextSItem","diff","oldTree","newTree","diffWalk","pNode","nNode","propsPatches","diffProps","set","objectEquals","a","b","JSON","stringify","oldTreeProps","newTreeProps","setPropsPatches","removePropsPatches","hasPatch","diffChildren","pChildNodes","nChildNodes","diffs","reorderChildNodes","reorderPatch","leftNode","currentNodeIndex","h","components","log","attrs","arguments","addHook","hookName","callback","callbacks","_hooks","removeHook","callHooks","_callbacks","NaiveException","emptyRender","Naive","options","state","_state","_vdomRender","_templateHelpers","condition","createItem","nodes","vdomRender","createVdom","ele","componentsOptions","componentDefine","createComponentCreator","_init","createComponent","prtt","vdom","docFragment","simFragment","setState","update","mounted","preVdom","methods","m","hooks","_addHook","mount","mountPoint","_callHooks","_removeHook","destroy"],"mappings":"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"}