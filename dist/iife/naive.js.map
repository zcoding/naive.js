{"version":3,"file":"naive.js","sources":["../../src/utils.js","../../src/dom.js","../../src/vdom/vtext.js","../../src/directive.js","../../src/vdom/vnode.js","../../src/vdom/utils.js","../../src/vdom/patch.js","../../src/vdom/list-diff.js","../../src/vdom/diff.js","../../src/vdom/h.js","../../src/api/hooks.js","../../src/exception.js","../../src/main.js"],"sourcesContent":["export function warn (message) {\n  if (window.console) {\n    console.warn(`[naive.js] ${message}`);\n  }\n}\n\nexport function error (message) {\n  if (window.console) {\n    console.error(`[naive.js] ${message}`);\n  }\n}\n\nexport const isArray = Array.isArray ? Array.isArray : function isArray (obj) {\n  return Object.prototype.toString.call(obj) === '[object Array]';\n};\n\nexport function isUndefined (obj) {\n  return typeof obj === 'undefined';\n}\n\nexport function noop () {}\n\nexport function extend(obj, props) {\n  if (props) {\n    for (let i in props) obj[i] = props[i];\n  }\n  return obj;\n}\n\nexport function clone(obj) {\n  return extend({}, obj);\n}\n\nexport function isFunction (obj) {\n  return typeof obj === 'function';\n}\n\nexport function isPlainObject (obj) {\n  return obj != null && typeof obj === 'object' && !isArray(obj) && Object.prototype.toString.call(obj) === '[object Object]';\n}\n\nlet resolved = typeof Promise!=='undefined' && Promise.resolve();\nexport const defer = resolved ? (f => { resolved.then(f); }) : setTimeout; // asap async\n","import { isUndefined } from './utils';\n\n/**\n * 获取元素\n *\n * IE 8 只支持到 CSS2 选择器\n *\n * @param {String} selector\n */\nexport function getElement(selector) {\n  return typeof selector === 'string' ? query(selector) : selector;\n}\n\nexport function createElement(tag) {\n  return document.createElement(tag);\n}\n\nexport function createTextNode (text) {\n  return document.createTextNode(text);\n}\n\nexport function createDocumentFragment () {\n  return document.createDocumentFragment();\n}\n\nexport function query(selector, context) {\n  context = context || document;\n  return context.querySelector(selector);\n}\n\n/**\n * 检查一个元素是否在 document 内\n */\nexport function inDoc(node) {\n  var doc = node.ownerDocument.documentElement;\n  return doc === node || node && node.nodeType === 1 && doc.contains(node);\n}\n\nexport function removeNode(node) {\n  node.parentNode.removeChild(node)\n}\n\nexport function createAnchor(name) {\n  var n = document.createTextNode('');\n  n.name = name;\n  return n;\n}\n\nexport function before(newNode, node) {\n  node.parentNode.insertBefore(newNode, node);\n}\n\nexport function replaceNode(newNode, node) {\n  node.parentNode.replaceChild(newNode, node);\n}\n\nexport function after(el, target) {\n  if (target.nextSibling) {\n    before(el, target.nextSibling)\n  } else {\n    target.parentNode.appendChild(el)\n  }\n}\n\nexport function appendChild (el, target) {\n  target.appendChild(el);\n}\n\nexport function setAttr (node, attr, value) {\n  node.setAttribute(attr, value);\n}\n\nexport function hasAttr(node, name) {\n  return node.hasAttribute(name);\n}\n\nexport function removeAttr(node, name) {\n  node.removeAttribute(name);\n}\n\nexport function removeAllChildren(node) {\n  while(node.childNodes.length > 0) {\n    node.removeChild(node.childNodes[0]);\n  }\n}\n\n\nconst classSplitReg = /\\s+/;\n\nconst supportClassList = !isUndefined(document.createElement('div').classList);\n\nlet getClasses = supportClassList ?\n  function(element) {\n    return Array.prototype.slice.call(element.classList);\n  }\n  :\n  function(element) {\n    return element.className.split(/\\s+/).filter(s => s);\n  };\n\nexport let hasClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var contains = true;\n    for (let i = 0; i < classes.length; ++i) {\n      if (!element.classList.contains(classes[i])) {\n        contains = false;\n        break;\n      }\n    }\n    return contains;\n  }\n  :\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var contains = true, tmp = element.className;\n    for (let i = 0; i < classes.length; ++i) {\n      if (tmp.indexOf(classes[i]) === -1) {\n        contains = false;\n        break;\n      }\n    }\n    return contains;\n  };\n\nexport let addClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    element.classList.add.apply(element.classList, classes);\n    return element;\n  }\n  :\n  function(element, classes) {\n    var tmp = element.className;\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      if (!hasClass(element, c)) {\n        tmp = tmp.replace(/\\s+|$/, ' ' + classes);\n      }\n    });\n    element.className = tmp;\n    return element;\n  };\n\nexport let removeClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    element.classList.remove.apply(element.classList, classes);\n    return element;\n  }\n  :\n  function(element, classes) {\n    var tmp = element.className;\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      if (hasClass(element, c)) {\n        tmp = tmp.replace(new RegExp(c, 'g'), '');\n      }\n    });\n    element.className = tmp;\n    return element;\n  };\n\nexport let toggleClass = supportClassList ?\n  function(element, classes, force) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      element.classList.toggle(c, force);\n    });\n    return element;\n  }\n  :\n  function(element, classes, force) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var useForce = force !== undefined;\n    classes.forEach(c => {\n      if (hasClass(element, c) && (useForce && !force || !useForce)) {\n        removeClass(element, c);\n      } else if (!hasClass(element, c) && (useForce && force || !useForce)) {\n        addClass(element, c);\n      }\n    });\n    return element;\n  };\n","import { createTextNode } from '../dom';\n\n// virtual text node\nexport default function VText (text) {\n  this.data = text;\n}\n\nVText.prototype.render = function vdom2dom () {\n  return createTextNode(this.data);\n};\n","import { removeNode, addClass } from './dom';\n\nexport function handleDirective (directive, value, element, context) {\n  switch (directive) {\n    case 'show':\n      element.style.display = value ? '' : 'none';\n      break;\n    case 'class':\n      for (let c in value) {\n        if (value[c]) {\n          addClass(element, c);\n        } else {\n          removeClass(element, c);\n        }\n      }\n      break;\n    default:\n      break;\n  }\n}\n","import { createElement, setAttr, appendChild } from '../dom';\nimport VText from './vtext';\nimport { isVNode, isVText } from './utils';\nimport { isArray, isFunction } from '../utils';\nimport { handleDirective } from '../directive';\n\nexport default function VNode (tagName, props, children, key) {\n  this.tagName = tagName;\n  this.props = props || {};\n  this.key = key ? String(key) : undefined; // key 用来标识节点，方便 diff\n  let childNodes = [];\n  children = children || [];\n  for (let i = 0; i < children.length; ++i) {\n    const child = children[i];\n    if (isVNode(child) || isVText(child) || child._isComponent) {\n      childNodes.push(child);\n    } else if (typeof child === 'string') {\n      childNodes.push(new VText(child));\n    } else if (isArray(child)) {\n      childNodes = childNodes.concat(child);\n    } else {\n      // ignore\n    }\n  }\n  this.children = childNodes;\n  let count = this.children.length;\n  for (let i = 0; i < this.children.length; ++i) {\n    count += this.children[i].count || 0;\n  }\n  this.count = count; // 记录子节点数，方便 patch 的时候找到节点位置\n}\n\n// 检查是否指令属性\nfunction checkAttrDirective (attr) {\n  return /^@|n-|:/.test(attr);\n}\n\n// add event listener\nfunction isEventDirective (attr) {\n  return /^@/.test(attr);\n}\n\nfunction attachEvent (el, eventName, handler) {\n  if (el.addEventListener) {\n    el.addEventListener(eventName, handler, false);\n  } else if (el.attachEvent) {\n    el.attachEvent(eventName, handler);\n  } else {\n    el[`on${eventName}`] = handler;\n  }\n}\n\nfunction detachEvent () {}\n\nVNode.prototype.render = function vdom2dom(context) {\n  const el = createElement(this.tagName);\n  const props = this.props;\n  for (let p in props) {\n    if (checkAttrDirective(p)) {\n      if (isEventDirective(p)) {\n        const eventName = p.slice(1);\n        const handlerFunc = isFunction(props[p]) ? props[p] : context[props[p]];\n        attachEvent(el, eventName, function handler(evt) {\n          handlerFunc.call(context, evt);\n        });\n      } else {\n        // 处理指令\n        if (/^n-/.test(p)) {\n          handleDirective(p.slice(2), props[p], el, context);\n        } else if (/^:/.test(p)) {\n          handleDirective(p.slice(1), props[p], el, context);\n        } else {}\n      }\n    } else {\n      setAttr(el, p, props[p]);\n    }\n  }\n  for (let i = 0; i < this.children.length; ++i) {\n    appendChild(this.children[i].render(context), el);\n  }\n  return el;\n};\n","import VText from './vtext';\nimport VNode from './vnode';\n\nexport function isVNode (node) {\n  return node instanceof VNode;\n}\n\nexport function isVText (node) {\n  return node instanceof VText;\n}\n","import { setAttr, replaceNode, removeNode } from '../dom';\nimport { handleDirective } from '../directive';\n\nexport const PATCH = {\n  REPLACE: 0, // 替换节点\n  INSERT: 1, // 插入\n  REMOVE: 2, // 移除\n  REORDER: 3, // 重排\n  PROPS: 4, // 修改属性\n  TEXT: 5 // 替换文本\n};\n\nexport function patch (context, domNode, patches) {\n  const walker = {index: 0};\n  dfsWalk(context, domNode, walker, patches);\n}\n\nfunction dfsWalk (context, domNode, walker, patches) {\n  const currentPatches = patches[walker.index];\n\n  const len = domNode.childNodes ? domNode.childNodes.length : 0;\n  for (let i = 0; i < len; i++) {\n    const child = domNode.childNodes[i];\n    walker.index++;\n    dfsWalk(context, child, walker, patches);\n  }\n  if (currentPatches) {\n    applyPatches(context, domNode, currentPatches);\n  }\n}\n\nfunction patchReorder (context, domNode, moves) {\n  for (let i = 0; i < moves.length; ++i) {\n    const move = moves[i];\n    switch (move.type) {\n      case PATCH.INSERT: // 插入新节点\n        const target = domNode.childNodes[move.index] || null; // null 插入末尾\n        domNode.insertBefore(move.item.render(context), target);\n        break;\n      case PATCH.REMOVE:\n        removeNode(domNode.childNodes[move.index]);\n        break;\n      default:\n        // error type\n    }\n  }\n}\n\n// 检查是否指令属性\nfunction isAttrDirective (attr) {\n  return /^@|n-|:/.test(attr);\n}\n// 检查是否事件指令\nfunction isEventDirective (attr) {\n  return /^@/.test(attr);\n}\n\nfunction patchProps (domNode, patch, context) {\n  for (let p in patch.props) {\n    if (patch.props.hasOwnProperty(p)) {\n      // 检查是否指令属性\n      if (isAttrDirective(p)) {\n        if (isEventDirective(p)) {\n          // removeEventListener\n          // addEventListener\n        } else { // 其他指令属性\n          // 处理指令\n          if (/^n-/.test(p)) {\n            handleDirective(p.slice(2), patch.props[p], domNode, context);\n          } else if (/^:/.test(p)) {\n            handleDirective(p.slice(1), patch.props[p], domNode, context);\n          } else {}\n        }\n      } else { // 普通属性\n        setAttr(domNode, p, patch.props[p]);\n      }\n    }\n  }\n}\n\n// 根据补丁更新 DOM 节点\nfunction applyPatches (context, domNode, patches) {\n  for (let i = 0; i < patches.length; ++i) {\n    const patch = patches[i];\n    switch (patch.type) {\n      case PATCH.REPLACE: // 替换元素节点\n        replaceNode(patch.node.render(context), domNode);\n        break;\n      case PATCH.PROPS: // 属性修改\n        patchProps(domNode, patch, context);\n        break;\n      case PATCH.TEXT: // 替换文本内容\n        domNode.data = patch.data;\n        break;\n      case PATCH.REORDER: // 子节点重新排序\n        patchReorder(context, domNode, patch.moves);\n        break;\n      default:\n        // warn\n    }\n  }\n}\n","import { PATCH } from './patch'; //REORDER_INSERT\n\n// 分别找到有 key 的元素位置和没有 key 的元素的位置\nfunction makeKeyIndexAndFree (list) {\n  const keyIndex = {}; // 有 key 的节点位置\n  const free = []; // 可替换的位置（没有 key 的节点都被标识为可替换的节点）\n  for (let i = 0, len = list.length; i < len; i++) {\n    const item = list[i]\n    const itemKey = item.key;\n    if (itemKey) {\n      keyIndex[itemKey] = i;\n    } else {\n      free.push(item);\n    }\n  }\n  return {\n    keyIndex: keyIndex,\n    free: free\n  };\n}\n\nexport default function listDiff (pList, nList) {\n  const nMap = makeKeyIndexAndFree(nList);\n  const nKeys = nMap.keyIndex, nFree = nMap.free;\n  const pMap = makeKeyIndexAndFree(pList);\n  const pKeys = pMap.keyIndex, pFree = pMap.free;\n  // 先处理有 key 的元素，看其在 nList 还是否存在，如果不存在说明被移除\n  const children = [];\n  for (let i = 0, freeIndex = 0; i < pList.length; ++i) {\n    const item = pList[i];\n    const itemKey = item.key;\n    if (itemKey) {\n      if (!nKeys.hasOwnProperty(itemKey)) {\n        children.push(null);\n      } else {\n        const itemKeyIndex = nKeys[itemKey];\n        children.push(nList[itemKeyIndex]);\n      }\n    } else {\n      children.push(nFree[freeIndex++] || null);\n    }\n  }\n  const moves = [];\n  function remove (index) {\n    moves.push({\n      type: PATCH.REMOVE,\n      index: index\n    });\n  }\n  function insert (index, item) {\n    moves.push({\n      type: PATCH.INSERT,\n      index: index,\n      item: item\n    });\n  }\n  const simulateList = children.slice(0);\n  // 找出被移除的节点\n  let i = 0;\n  while (i < simulateList.length) {\n    if (simulateList[i] === null) {\n      remove(i);\n      simulateList.splice(i, 1);\n    } else {\n      ++i;\n    }\n  }\n  // 遍历 nList\n  for (let s = 0, n = 0; n < nList.length; ++n) {\n    const nItem = nList[n];\n    const nItemKey = nItem.key;\n    const sItem = simulateList[s];\n    if (sItem) {\n      const sItemKey = sItem.key;\n      if (sItemKey === nItemKey) { // 相同元素相同位置\n        s++;\n      } else {\n        if (!pKeys.hasOwnProperty(nItemKey)) { // 旧列表中不存在，新节点\n          insert(n, nItem); // 在位置 n 插入新节点 nItem\n        } else { // 旧列表中存在，需要移位（移位操作包括删除和插入两者中的一个或两个）\n          const nsItemKey = simulateList[s + 1].key;\n          if (nsItemKey === nItemKey) {\n            remove(n);\n            simulateList.splice(s, 1);\n            s++;\n          } else {\n            insert(n, nItem);\n          }\n        }\n      }\n    } else { // 旧列表该位置为空，直接插入\n      insert(n, nItem);\n    }\n  }\n  return {\n    moves: moves,\n    children: children\n  };\n}\n","import { isVNode, isVText } from './utils';\nimport listDiff from './list-diff';\nimport { PATCH } from './patch';\nimport { isArray, isPlainObject } from '../utils';\n\n// diff two vdom node\nexport function diff (oldTree, newTree) {\n  let index = 0;\n  let patches = {};\n  if (isArray(oldTree)) {\n    const currentPatches = [];\n    diffChildren(oldTree, newTree, 0, patches, currentPatches);\n    if (currentPatches.length) {\n      patches[0] = currentPatches;\n    }\n  } else {\n    diffWalk(oldTree, newTree, index, patches);\n  }\n  return patches;\n}\n\nfunction diffWalk (pNode, nNode, index, patches) {\n  let currentPatches = []; // 当前层级的 patch\n  if (nNode === null) {\n    // 这种情况属于：在 diffChildren 的时候该节点被标识为被删除的节点，但是不需要在这里删除（在 reorder 的时候会处理删除）\n  } else if (isVNode(pNode) && isVNode(nNode)) { // 都是 VNode\n    if (pNode.tagName !== nNode.tagName || pNode.key !== nNode.key) { // 不同节点，或者已标识不是同一节点，要替换\n      currentPatches.push({type: PATCH.REPLACE, node: nNode});\n    } else {\n      let propsPatches = diffProps(pNode, nNode);\n      if (propsPatches) {\n        currentPatches.push({type: PATCH.PROPS, props: propsPatches});\n      }\n      // 继续 diff 子节点\n      diffChildren(pNode.children, nNode.children, index, patches, currentPatches);\n    }\n  } else if (isVText(pNode) && isVText(nNode)) { // 都是 VText\n    if (pNode.data !== nNode.data) { // 内容不一样的时候才替换（只替换内容即可）\n      currentPatches.push({type: PATCH.TEXT, data: nNode.data});\n    }\n  } else { // 类型不一样，绝对要替换\n    currentPatches.push({type: PATCH.REPLACE, node: nNode});\n  }\n  if (currentPatches.length) {\n    patches[index] = currentPatches;\n  }\n}\n\n// 快速比较两个对象是否“相等”\nfunction objectEquals (a, b) {\n  return JSON.stringify(a) === JSON.stringify(b);\n}\n\nfunction diffProps (oldTree, newTree) {\n  let oldTreeProps = oldTree.props;\n  let newTreeProps = newTree.props;\n  let propsPatches = {}, count = 0;\n  for (let p in oldTreeProps) {\n    // 如果是指令属性，而且 value 是对象，则比较对象\n    if (!newTreeProps.hasOwnProperty(p)) {\n      propsPatches[p] = newTreeProps[p];\n      count += 1;\n    } else if (isPlainObject(newTreeProps[p])) {\n      if (!objectEquals(newTreeProps[p], oldTreeProps[p])) {\n        propsPatches[p] = newTreeProps[p];\n        count += 1;\n      }\n    } else if (newTreeProps[p] !== oldTreeProps[p]) {\n      propsPatches[p] = newTreeProps[p];\n      count += 1;\n    }\n  }\n  if (count <= 0) {\n    return null;\n  }\n  return propsPatches;\n}\n\nfunction diffChildren (pChildNodes, nChildNodes, index, patches, currentPatches) {\n  const diffs = listDiff(pChildNodes, nChildNodes, index, patches);\n  const newChildren = diffs.children;\n\n  if (diffs.moves.length) { // 需要 reorder\n    // reorder 的操作在父节点执行，所以应该加到父节点的 patch\n    const reorderPatch = { type: PATCH.REORDER, moves: diffs.moves };\n    currentPatches.push(reorderPatch);\n  }\n  \n  // 除了重排的 patch 还有各个子节点自身的 patch\n  let leftNode = null;\n  let currentNodeIndex = index;\n  for (let i = 0; i < pChildNodes.length; ++i) {\n    currentNodeIndex = (leftNode && leftNode.count)\n      ? currentNodeIndex + leftNode.count + 1\n      : currentNodeIndex + 1\n    diffWalk(pChildNodes[i], newChildren[i], currentNodeIndex, patches);\n    leftNode = pChildNodes[i];\n  }\n}\n","import VNode from './vnode';\nimport VText from './vtext';\nimport { isArray, isPlainObject } from '../utils';\nimport { isVNode, isVText } from './utils';\n\nimport Naive from '../main';\n\nexport default function h (tagName, props, children, key) {\n  const context = this || {};\n  const components = context['components'] || {};\n  if (isVNode(tagName) || isVText(tagName)) {\n    return tagName;\n  } else if (isPlainObject(tagName)) {\n    if (components.hasOwnProperty(tagName.tagName)) {\n      console.log(tagName.tagName);\n    }\n    return new VNode(tagName.tagName, tagName.attrs, tagName.children, tagName.key);\n  } else if (isArray(tagName)) {\n    const list = [];\n    for (let i = 0; i < tagName.length; ++i) {\n      list.push(h(tagName[i]));\n    }\n    return list;\n  } else if(arguments.length < 2) {\n    return new VText(tagName);\n  } else {\n    if (components.hasOwnProperty(tagName)) {\n      return components[tagName]();\n    } else {\n      return new VNode(tagName, props, children, key);\n    }\n  }\n}\n","import { isArray } from '../utils';\n\nexport function addHook (hookName, callback) {\n  let callbacks = this._hooks[hookName];\n  if (!callbacks) {\n    callbacks = [];\n  }\n  if (isArray(callback)) {\n    callbacks = callbacks.concat(callback);\n  } else {\n    callbacks.push(callback);\n  }\n  this._hooks[hookName] = callbacks;\n}\n\nexport function removeHook (hookName, callback) {\n  const callbacks = this._hooks[hookName];\n  if (!callbacks || callbacks.length === 0) {\n    return this;\n  }\n  if (!callback) {\n    callbacks.splice(0, callbacks.length);\n  } else {\n    for (let i = 0; i < callbacks.length; ++i) {\n      if (callbacks[i] === callback) {\n        callbacks.splice(i, 1);\n        break;\n      }\n    }\n  }\n  return this;\n}\n\nexport function callHooks (hookName) {\n  const _callbacks = this._hooks[hookName] || [];\n  for (let i = 0; i < _callbacks.length; ++i) {\n    _callbacks[i].call(this);\n  }\n}\n","export function NaiveException (message) {\n  this.name = 'NaiveException';\n  this.message = message;\n}\n","import { getElement, createDocumentFragment, appendChild, replaceNode } from './dom';\nimport { diff, patch } from './vdom/vdom';\nimport h from './vdom/h';\nimport { warn, extend, isFunction, isPlainObject } from './utils';\nimport { addHook, removeHook, callHooks } from './api/hooks';\nimport { NaiveException } from './exception';\n\nconst templateHelpers = {\n  \"if\": function (condition, options) {\n    return condition ? h(options) : condition;\n  },\n  \"each\": function (list, createItem) {\n    const nodes = [];\n    for (let i = 0; i < list.length; ++i) {\n      const item = list[i];\n      const key = 'id' in item ? item['id'] : i;\n      nodes.push(h(createItem(item, key)));\n    }\n    return nodes;\n  }\n};\n\nfunction emptyRender () {\n  return null;\n}\n\nexport default function Naive (options) {\n  options = options || {};\n  this.name = options.name || '';\n  this._hooks = {};\n  this._isComponent = true;\n  if ('state' in options) {\n    if (!isFunction(options.state)) {\n      // 必须是 function\n      throw new NaiveException('state 必须是 [Function]');\n    }\n    const _state = options.state();\n    if (isPlainObject(_state)) {\n      this.state = _state;\n    } else {\n      warn('state 必须返回 [Plain Object]');\n      this.state = {};\n    }\n  } else {\n    this.state = {};\n  }\n  const context = this;\n  const vdomRender = options.render || emptyRender;\n  this.vdomRender = function render () {\n    return vdomRender.call(\n      this,\n      function createVdom () {\n        return h.apply(context, Array.prototype.slice.call(arguments, 0));\n      },\n      templateHelpers\n    );\n  };\n  this.ele = null;\n  // components\n  this.components = {};\n  const componentsOptions = options.components || {};\n  for (let p in componentsOptions) {\n    if (componentsOptions.hasOwnProperty(p)) {\n      const componentDefine = componentsOptions[p] || {};\n      componentDefine.name = componentDefine.name || p;\n      context.components[p] = createComponentCreator(this, componentDefine);\n    }\n  }\n  this._init(options);\n}\n\nfunction createComponentCreator (context, componentDefine) {\n  return function createComponent() {\n    return new Naive(componentDefine);\n  };\n}\n\nconst prtt = Naive.prototype;\n\nprtt.render = function render () {\n  return this.vdomRender().render();\n};\n\nprtt.setState = function setState (state) {\n  extend(this.state, state);\n  this.update();\n  return this;\n};\n\n// 更新视图\nprtt.update = function update () {\n  if (!this.mounted) { // 如果组件没有挂载到元素上，不需要更新视图\n    return this;\n  }\n  const preVdom = this.vdom;\n  this.vdom = this.vdomRender();\n  // console.log(preVdom, this.vdom);\n  const patches = diff(preVdom, this.vdom);\n  console.log(patches);\n  if (patches) {\n    patch(this, this.ele, patches);\n  } else {\n    warn('不需要更新视图');\n  }\n};\n\nprtt._init = function _init (options) {\n  const methods = options.methods || {};\n  // 将 methods 移到 this\n  for (let m in methods) {\n    if (methods.hasOwnProperty(m)) {\n      if (this.hasOwnProperty(m)) {\n        warn(`属性 \"${m}\" 已存在`);\n      } else {\n        this[m] = methods[m];\n      }\n    }\n  }\n  const hooks = options.hooks || {};\n  for (let p in hooks) {\n    if (hooks.hasOwnProperty(p)) {\n      this._addHook(p, hooks[p]);\n    }\n  }\n  this.vdom = this.vdomRender();\n};\n\nprtt.mount = function mount (selector) {\n  const mountPoint = typeof selector === 'string' ? getElement(selector) : selector;\n  if (!mountPoint) {\n    throw new NaiveException('找不到挂载节点');\n  }\n  const vdom = this.vdom;\n  if (vdom.length) { // fragment\n    const docFragment = createDocumentFragment();\n    const simFragment = { childNodes: [] };\n    for (let i = 0; i < vdom.length; ++i) {\n      const node = vdom[i].render(this);\n      simFragment.childNodes.push(node);\n      appendChild(node, docFragment);\n    }\n    this.ele = simFragment;\n    replaceNode(docFragment, mountPoint);\n  } else {\n    this.ele = vdom.render(this);\n    replaceNode(this.ele, mountPoint);\n  }\n  this.mounted = true;\n  this._callHooks('mounted');\n};\n\nprtt._callHooks = callHooks;\n\nprtt._addHook = addHook;\n\nprtt._removeHook = removeHook;\n\n// 销毁组件\nprtt.destroy = function destroy () {\n  // 销毁事件监听\n  // 调用 destroy 勾子\n  this._callHooks('destroy');\n  // 销毁勾子回调\n  for (let p in this._hooks) {\n    if (this._hooks.hasOwnProperty(p)) {\n      this._removeHook(p);\n    }\n  }\n};\n"],"names":["warn","message","window","console","isArray","Array","obj","Object","prototype","toString","call","isUndefined","extend","props","i","isFunction","isPlainObject","getElement","selector","query","createElement","tag","document","createTextNode","text","createDocumentFragment","context","querySelector","removeNode","node","parentNode","removeChild","replaceNode","newNode","replaceChild","appendChild","el","target","setAttr","attr","value","setAttribute","supportClassList","classList","hasClass","element","classes","split","filter","s","contains","length","tmp","className","indexOf","addClass","add","apply","forEach","c","replace","removeClass","VText","data","render","vdom2dom","handleDirective","directive","style","display","VNode","tagName","children","key","String","undefined","childNodes","child","isVNode","isVText","_isComponent","push","concat","count","checkAttrDirective","test","isEventDirective","attachEvent","eventName","handler","addEventListener","p","slice","handlerFunc","evt","PATCH","patch","domNode","patches","walker","index","dfsWalk","currentPatches","len","patchReorder","moves","move","type","INSERT","insertBefore","item","REMOVE","isAttrDirective","patchProps","hasOwnProperty","applyPatches","REPLACE","PROPS","TEXT","REORDER","makeKeyIndexAndFree","list","keyIndex","free","itemKey","listDiff","pList","nList","nMap","nKeys","nFree","pMap","pKeys","pFree","freeIndex","itemKeyIndex","remove","insert","simulateList","splice","n","nItem","nItemKey","sItem","sItemKey","nsItemKey","diff","oldTree","newTree","diffWalk","pNode","nNode","propsPatches","diffProps","objectEquals","a","b","JSON","stringify","oldTreeProps","newTreeProps","diffChildren","pChildNodes","nChildNodes","diffs","newChildren","reorderPatch","leftNode","currentNodeIndex","h","components","log","attrs","arguments","addHook","hookName","callback","callbacks","_hooks","removeHook","callHooks","_callbacks","NaiveException","name","templateHelpers","condition","options","createItem","nodes","emptyRender","Naive","state","_state","vdomRender","createVdom","ele","componentsOptions","componentDefine","createComponentCreator","_init","createComponent","prtt","setState","update","mounted","preVdom","vdom","methods","m","hooks","_addHook","mount","mountPoint","docFragment","simFragment","_callHooks","_removeHook","destroy"],"mappings":"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"}