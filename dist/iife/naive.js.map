{"version":3,"file":"naive.js","sources":["../../src/utils.js","../../src/dom.js","../../src/vdom/vtext.js","../../src/directive.js","../../src/vdom/vnode.js","../../src/vdom/utils.js","../../src/vdom/patch.js","../../src/vdom/list-diff.js","../../src/vdom/diff.js","../../src/vdom/h.js","../../src/api/hooks.js","../../src/exception.js","../../src/main.js"],"sourcesContent":["export function warn (message) {\n  if (window.console) {\n    console.warn(`[naive.js] ${message}`);\n  }\n}\n\nexport function error (message) {\n  if (window.console) {\n    console.error(`[naive.js] ${message}`);\n  }\n}\n\nexport const isArray = Array.isArray ? Array.isArray : function isArray (obj) {\n  return Object.prototype.toString.call(obj) === '[object Array]';\n};\n\nexport function isUndefined (obj) {\n  return typeof obj === 'undefined';\n}\n\nexport function noop () {}\n\nexport function extend(obj, props) {\n  if (props) {\n    for (let i in props) obj[i] = props[i];\n  }\n  return obj;\n}\n\nexport function clone(obj) {\n  return extend({}, obj);\n}\n\nexport function isFunction (obj) {\n  return typeof obj === 'function';\n}\n\nexport function isPlainObject (obj) {\n  return obj != null && typeof obj === 'object' && !isArray(obj) && Object.prototype.toString.call(obj) === '[object Object]';\n}\n\nlet resolved = typeof Promise!=='undefined' && Promise.resolve();\nexport const defer = resolved ? (f => { resolved.then(f); }) : setTimeout; // asap async\n","import { isUndefined } from './utils';\n\n/**\n * 获取元素\n *\n * IE 8 只支持到 CSS2 选择器\n *\n * @param {String} selector\n */\nexport function getElement(selector) {\n  return typeof selector === 'string' ? query(selector) : selector;\n}\n\nexport function createElement(tag) {\n  return document.createElement(tag);\n}\n\nexport function createTextNode (text) {\n  return document.createTextNode(text);\n}\n\nexport function createDocumentFragment () {\n  return document.createDocumentFragment();\n}\n\nexport function query(selector, context) {\n  context = context || document;\n  return context.querySelector(selector);\n}\n\n/**\n * 检查一个元素是否在 document 内\n */\nexport function inDoc(node) {\n  var doc = node.ownerDocument.documentElement;\n  return doc === node || node && node.nodeType === 1 && doc.contains(node);\n}\n\nexport function removeNode(node) {\n  node.parentNode.removeChild(node)\n}\n\nexport function createAnchor(name) {\n  var n = document.createTextNode('');\n  n.name = name;\n  return n;\n}\n\nexport function before(newNode, node) {\n  node.parentNode.insertBefore(newNode, node);\n}\n\nexport function replaceNode(newNode, node) {\n  node.parentNode.replaceChild(newNode, node);\n}\n\nexport function after(el, target) {\n  if (target.nextSibling) {\n    before(el, target.nextSibling)\n  } else {\n    target.parentNode.appendChild(el)\n  }\n}\n\nexport function appendChild (el, target) {\n  target.appendChild(el);\n}\n\nexport function setAttr (node, attr, value) {\n  node.setAttribute(attr, value);\n}\n\nexport function hasAttr(node, name) {\n  return node.hasAttribute(name);\n}\n\nexport function removeAttr(node, name) {\n  node.removeAttribute(name);\n}\n\nexport function removeAllChildren(node) {\n  while(node.childNodes.length > 0) {\n    node.removeChild(node.childNodes[0]);\n  }\n}\n\n\nconst classSplitReg = /\\s+/;\n\nconst supportClassList = !isUndefined(document.createElement('div').classList);\n\nlet getClasses = supportClassList ?\n  function(element) {\n    return Array.prototype.slice.call(element.classList);\n  }\n  :\n  function(element) {\n    return element.className.split(/\\s+/).filter(s => s);\n  };\n\nexport let hasClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var contains = true;\n    for (let i = 0; i < classes.length; ++i) {\n      if (!element.classList.contains(classes[i])) {\n        contains = false;\n        break;\n      }\n    }\n    return contains;\n  }\n  :\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var contains = true, tmp = element.className;\n    for (let i = 0; i < classes.length; ++i) {\n      if (tmp.indexOf(classes[i]) === -1) {\n        contains = false;\n        break;\n      }\n    }\n    return contains;\n  };\n\nexport let addClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    element.classList.add.apply(element.classList, classes);\n    return element;\n  }\n  :\n  function(element, classes) {\n    var tmp = element.className;\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      if (!hasClass(element, c)) {\n        tmp = tmp.replace(/\\s+|$/, ' ' + classes);\n      }\n    });\n    element.className = tmp;\n    return element;\n  };\n\nexport let removeClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    element.classList.remove.apply(element.classList, classes);\n    return element;\n  }\n  :\n  function(element, classes) {\n    var tmp = element.className;\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      if (hasClass(element, c)) {\n        tmp = tmp.replace(new RegExp(c, 'g'), '');\n      }\n    });\n    element.className = tmp;\n    return element;\n  };\n\nexport let toggleClass = supportClassList ?\n  function(element, classes, force) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      element.classList.toggle(c, force);\n    });\n    return element;\n  }\n  :\n  function(element, classes, force) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var useForce = force !== undefined;\n    classes.forEach(c => {\n      if (hasClass(element, c) && (useForce && !force || !useForce)) {\n        removeClass(element, c);\n      } else if (!hasClass(element, c) && (useForce && force || !useForce)) {\n        addClass(element, c);\n      }\n    });\n    return element;\n  };\n","import { createTextNode } from '../dom';\n\n// virtual text node\nexport default function VText (text) {\n  this.data = text;\n}\n\nVText.prototype.render = function vdom2dom () {\n  return createTextNode(this.data);\n};\n","import { removeNode, addClass } from './dom';\n\nexport function handleDirective (directive, value, element, context) {\n  switch (directive) {\n    case 'show':\n      element.style.display = value ? '' : 'none';\n      break;\n    case 'class':\n      for (let c in value) {\n        if (value[c]) {\n          addClass(element, c);\n        } else {\n          removeClass(element, c);\n        }\n      }\n      break;\n    default:\n      break;\n  }\n}\n","import { createElement, setAttr, appendChild } from '../dom';\nimport VText from './vtext';\nimport { isVNode, isVText } from './utils';\nimport { isArray, isFunction } from '../utils';\nimport { handleDirective } from '../directive';\n\nexport default function VNode (tagName, props, children, key) {\n  this.tagName = tagName;\n  this.props = props || {};\n  this.key = key ? String(key) : undefined; // key 用来标识节点，方便 diff\n  let childNodes = [];\n  children = children || [];\n  for (let i = 0; i < children.length; ++i) {\n    const child = children[i];\n    if (isVNode(child) || isVText(child)) {\n      childNodes.push(child);\n    } else if (typeof child === 'string') {\n      childNodes.push(new VText(child));\n    } else if (isArray(child)) {\n      childNodes = childNodes.concat(child);\n    } else {\n      // ignore\n    }\n  }\n  this.children = childNodes;\n  let count = this.children.length;\n  for (let i = 0; i < this.children.length; ++i) {\n    count += this.children[i].count || 0;\n  }\n  this.count = count; // 记录子节点数，方便 patch 的时候找到节点位置\n}\n\n// 检查是否指令属性\nfunction checkAttrDirective (attr) {\n  return /^@|n-|:/.test(attr);\n}\n\n// add event listener\nfunction isEventDirective (attr) {\n  return /^@/.test(attr);\n}\n\nfunction attachEvent (el, eventName, handler) {\n  if (el.addEventListener) {\n    el.addEventListener(eventName, handler, false);\n  } else if (el.attachEvent) {\n    el.attachEvent(eventName, handler);\n  } else {\n    el[`on${eventName}`] = handler;\n  }\n}\n\nfunction detachEvent () {}\n\nVNode.prototype.render = function vdom2dom(context) {\n  const el = createElement(this.tagName);\n  const props = this.props;\n  for (let p in props) {\n    if (checkAttrDirective(p)) {\n      if (isEventDirective(p)) {\n        const eventName = p.slice(1);\n        const handlerFunc = isFunction(props[p]) ? props[p] : context[props[p]];\n        attachEvent(el, eventName, function handler(evt) {\n          handlerFunc.call(context, evt);\n        });\n      } else {\n        // 处理指令\n        if (/^n-/.test(p)) {\n          handleDirective(p.slice(2), props[p], el, context);\n        } else if (/^:/.test(p)) {\n          handleDirective(p.slice(1), props[p], el, context);\n        } else {}\n      }\n    } else {\n      setAttr(el, p, props[p]);\n    }\n  }\n  for (let i = 0; i < this.children.length; ++i) {\n    appendChild(this.children[i].render(context), el);\n  }\n  return el;\n};\n","import VText from './vtext';\nimport VNode from './vnode';\n\nexport function isVNode (node) {\n  return node instanceof VNode;\n}\n\nexport function isVText (node) {\n  return node instanceof VText;\n}\n","import { setAttr, replaceNode } from '../dom';\nimport { handleDirective } from '../directive';\n\nexport const PATCH = {\n  REPLACE: 0, // 替换节点\n  INSERT: 1, // 插入\n  REMOVE: 2, // 移除\n  REORDER: 3, // 重排\n  PROPS: 4, // 修改属性\n  TEXT: 5 // 替换文本\n};\n\nexport function patch (context, domNode, patches) {\n  const walker = {index: 0};\n  dfsWalk(context, domNode, walker, patches);\n}\n\nfunction dfsWalk (context, domNode, walker, patches) {\n  const currentPatches = patches[walker.index];\n\n  const len = domNode.childNodes ? domNode.childNodes.length : 0;\n  for (let i = 0; i < len; i++) {\n    const child = domNode.childNodes[i];\n    walker.index++;\n    dfsWalk(context, child, walker, patches);\n  }\n  if (currentPatches) {\n    applyPatches(context, domNode, currentPatches);\n  }\n}\n\nfunction patchReorder (context, domNode, moves) {\n  for (let i = 0; i < moves.length; ++i) {\n    const move = moves[i];\n    switch (move.type) {\n      case PATCH.INSERT: // 插入新节点\n        const target = domNode.childNodes[move.index] || null; // null 插入末尾\n        domNode.insertBefore(move.item.render(context), target);\n        break;\n      case PATCH.REMOVE:\n        removeNode(domNode.childNodes[move.index]);\n        break;\n      default:\n        // error type\n    }\n  }\n}\n\n// 检查是否指令属性\nfunction isAttrDirective (attr) {\n  return /^@|n-|:/.test(attr);\n}\n// 检查是否事件指令\nfunction isEventDirective (attr) {\n  return /^@/.test(attr);\n}\n\nfunction patchProps (domNode, patch, context) {\n  for (let p in patch.props) {\n    if (patch.props.hasOwnProperty(p)) {\n      // 检查是否指令属性\n      if (isAttrDirective(p)) {\n        if (isEventDirective(p)) {\n          // removeEventListener\n          // addEventListener\n        } else { // 其他指令属性\n          // 处理指令\n          if (/^n-/.test(p)) {\n            handleDirective(p.slice(2), patch.props[p], domNode, context);\n          } else if (/^:/.test(p)) {\n            handleDirective(p.slice(1), patch.props[p], domNode, context);\n          } else {}\n        }\n      } else { // 普通属性\n        setAttr(domNode, p, patch.props[p]);\n      }\n    }\n  }\n}\n\n// 根据补丁更新 DOM 节点\nfunction applyPatches (context, domNode, patches) {\n  for (let i = 0; i < patches.length; ++i) {\n    const patch = patches[i];\n    switch (patch.type) {\n      case PATCH.REPLACE: // 替换元素节点\n        replaceNode(patch.node.render(context), domNode);\n        break;\n      case PATCH.PROPS: // 属性修改\n        patchProps(domNode, patch, context);\n        break;\n      case PATCH.TEXT: // 替换文本内容\n        domNode.data = patch.data;\n        break;\n      case PATCH.REORDER: // 子节点重新排序\n        patchReorder(context, domNode, patch.moves);\n        break;\n      default:\n        // warn\n    }\n  }\n}\n","import { PATCH } from './patch'; //REORDER_INSERT\n\n// 分别找到有 key 的元素位置和没有 key 的元素的位置\nfunction makeKeyIndexAndFree (list) {\n  const keyIndex = {}; // 有 key 的节点位置\n  const free = []; // 可替换的位置（没有 key 的节点都被标识为可替换的节点）\n  for (let i = 0, len = list.length; i < len; i++) {\n    const item = list[i]\n    const itemKey = item.key;\n    if (itemKey) {\n      keyIndex[itemKey] = i;\n    } else {\n      free.push(item);\n    }\n  }\n  return {\n    keyIndex: keyIndex,\n    free: free\n  };\n}\n\nexport default function listDiff (pList, nList) {\n  const nMap = makeKeyIndexAndFree(nList);\n  const nKeys = nMap.keyIndex, nFree = nMap.free;\n  const pMap = makeKeyIndexAndFree(pList);\n  const pKeys = pMap.keyIndex, pFree = pMap.free;\n  // 先处理有 key 的元素，看其在 nList 还是否存在，如果不存在说明被移除\n  const children = [];\n  for (let i = 0, freeIndex = 0; i < pList.length; ++i) {\n    const item = pList[i];\n    const itemKey = item.key;\n    if (itemKey) {\n      if (!nKeys.hasOwnProperty(itemKey)) {\n        children.push(null);\n      } else {\n        const itemKeyIndex = nKeys[itemKey];\n        children.push(nList[itemKeyIndex]);\n      }\n    } else {\n      children.push(nFree[freeIndex++] || null);\n    }\n  }\n  const moves = [];\n  function remove (index) {\n    moves.push({\n      type: PATCH.REMOVE,\n      index: index\n    });\n  }\n  function insert (index, item) {\n    moves.push({\n      type: PATCH.INSERT,\n      index: index,\n      item: item\n    });\n  }\n  const simulateList = children.slice(0);\n  // 找出被移除的节点\n  let i = 0;\n  while (i < simulateList.length) {\n    if (simulateList[i] === null) {\n      remove(i);\n      simulateList.splice(i, 1);\n    } else {\n      ++i;\n    }\n  }\n  // 遍历 nList\n  for (let s = 0, n = 0; n < nList.length; ++n) {\n    const nItem = nList[n];\n    const nItemKey = nItem.key;\n    const sItem = simulateList[s];\n    if (sItem) {\n      const sItemKey = sItem.key;\n      if (sItemKey === nItemKey) { // 相同元素相同位置\n        s++;\n      } else {\n        if (!pKeys.hasOwnProperty(nItemKey)) { // 旧列表中不存在，新节点\n          insert(n, nItem); // 在位置 n 插入新节点 nItem\n        } else { // 旧列表中存在，需要移位（移位操作包括删除和插入两者中的一个或两个）\n          const nsItemKey = simulateList[s + 1].key;\n          if (nsItemKey === nItemKey) {\n            remove(n);\n            simulateList.splice(s, 1);\n            s++;\n          } else {\n            insert(n, nItem);\n          }\n        }\n      }\n    } else { // 旧列表该位置为空，直接插入\n      insert(n, nItem);\n    }\n  }\n  return {\n    moves: moves,\n    children: children\n  };\n}\n","import { isVNode, isVText } from './utils';\nimport listDiff from './list-diff';\nimport { PATCH } from './patch';\nimport { isArray, isPlainObject } from '../utils';\n\n// diff two vdom node\nexport function diff (oldTree, newTree) {\n  let index = 0;\n  let patches = {};\n  if (isArray(oldTree)) {\n    const currentPatches = [];\n    diffChildren(oldTree, newTree, 0, patches, currentPatches);\n    if (currentPatches.length) {\n      patches[0] = currentPatches;\n    }\n  } else {\n    diffWalk(oldTree, newTree, index, patches);\n  }\n  return patches;\n}\n\nfunction diffWalk (pNode, nNode, index, patches) {\n  let currentPatches = []; // 当前层级的 patch\n  if (nNode === null) {\n    // 这种情况属于：在 diffChildren 的时候该节点被标识为被删除的节点，但是不需要在这里删除（在 reorder 的时候会处理删除）\n  } else if (isVNode(pNode) && isVNode(nNode)) { // 都是 VNode\n    if (pNode.tagName !== nNode.tagName || pNode.key !== nNode.key) { // 不同节点，或者已标识不是同一节点，要替换\n      currentPatches.push({type: PATCH.REPLACE, node: nNode});\n    } else {\n      let propsPatches = diffProps(pNode, nNode);\n      if (propsPatches) {\n        currentPatches.push({type: PATCH.PROPS, props: propsPatches});\n      }\n      // 继续 diff 子节点\n      diffChildren(pNode.children, nNode.children, index, patches, currentPatches);\n    }\n  } else if (isVText(pNode) && isVText(nNode)) { // 都是 VText\n    if (pNode.data !== nNode.data) { // 内容不一样的时候才替换（只替换内容即可）\n      currentPatches.push({type: PATCH.TEXT, data: nNode.data});\n    }\n  } else { // 类型不一样，绝对要替换\n    currentPatches.push({type: PATCH.REPLACE, node: nNode});\n  }\n  if (currentPatches.length) {\n    patches[index] = currentPatches;\n  }\n}\n\n// 快速比较两个对象是否“相等”\nfunction objectEquals (a, b) {\n  return JSON.stringify(a) === JSON.stringify(b);\n}\n\nfunction diffProps (oldTree, newTree) {\n  let oldTreeProps = oldTree.props;\n  let newTreeProps = newTree.props;\n  let propsPatches = {}, count = 0;\n  for (let p in oldTreeProps) {\n    // 如果是指令属性，而且 value 是对象，则比较对象\n    if (!newTreeProps.hasOwnProperty(p)) {\n      propsPatches[p] = newTreeProps[p];\n      count += 1;\n    } else if (isPlainObject(newTreeProps[p])) {\n      if (!objectEquals(newTreeProps[p], oldTreeProps[p])) {\n        propsPatches[p] = newTreeProps[p];\n        count += 1;\n      }\n    } else if (newTreeProps[p] !== oldTreeProps[p]) {\n      propsPatches[p] = newTreeProps[p];\n      count += 1;\n    }\n  }\n  if (count <= 0) {\n    return null;\n  }\n  return propsPatches;\n}\n\nfunction diffChildren (pChildNodes, nChildNodes, index, patches, currentPatches) {\n  const diffs = listDiff(pChildNodes, nChildNodes, index, patches);\n  const newChildren = diffs.children;\n\n  if (diffs.moves.length) { // 需要 reorder\n    // reorder 的操作在父节点执行，所以应该加到父节点的 patch\n    const reorderPatch = { type: PATCH.REORDER, moves: diffs.moves };\n    currentPatches.push(reorderPatch);\n  }\n  \n  // 除了重排的 patch 还有各个子节点自身的 patch\n  let leftNode = null;\n  let currentNodeIndex = index;\n  for (let i = 0; i < pChildNodes.length; ++i) {\n    currentNodeIndex = (leftNode && leftNode.count)\n      ? currentNodeIndex + leftNode.count + 1\n      : currentNodeIndex + 1\n    diffWalk(pChildNodes[i], newChildren[i], currentNodeIndex, patches);\n    leftNode = pChildNodes[i];\n  }\n}\n","import VNode from './vnode';\nimport VText from './vtext';\nimport { isArray, isPlainObject } from '../utils';\nimport { isVNode, isVText } from './utils';\n\nexport default function h (tagName, props, children, key) {\n  if (isVNode(tagName) || isVText(tagName)) {\n    return tagName;\n  } else if (isPlainObject(tagName)) {\n    return new VNode(tagName.tagName, tagName.attrs, tagName.children, tagName.key);\n  } else if (isArray(tagName)) {\n    const list = [];\n    for (let i = 0; i < tagName.length; ++i) {\n      list.push(h(tagName[i]));\n    }\n    return list;\n  } else if(arguments.length < 2) {\n    return new VText(tagName);\n  } else {\n    return new VNode(tagName, props, children, key);\n  }\n}\n","import { isArray } from '../utils';\n\nexport function addHook (hookName, callback) {\n  let callbacks = this._hooks[hookName];\n  if (!callbacks) {\n    callbacks = [];\n  }\n  if (isArray(callback)) {\n    callbacks = callbacks.concat(callback);\n  } else {\n    callbacks.push(callback);\n  }\n  this._hooks[hookName] = callbacks;\n}\n\nexport function removeHook (hookName, callback) {\n  const callbacks = this._hooks[hookName];\n  if (!callbacks || callbacks.length === 0) {\n    return this;\n  }\n  if (!callback) {\n    callbacks.splice(0, callbacks.length);\n  } else {\n    for (let i = 0; i < callbacks.length; ++i) {\n      if (callbacks[i] === callback) {\n        callbacks.splice(i, 1);\n        break;\n      }\n    }\n  }\n  return this;\n}\n\nexport function callHooks (hookName) {\n  const _callbacks = this._hooks[hookName] || [];\n  for (let i = 0; i < _callbacks.length; ++i) {\n    _callbacks[i].call(this);\n  }\n}\n","export function NaiveException (message) {\n  this.name = 'NaiveException';\n  this.message = message;\n}\n","import { getElement, createDocumentFragment, appendChild, replaceNode } from './dom';\nimport { diff, patch } from './vdom/vdom';\nimport h from './vdom/h';\nimport { warn, extend, isFunction, isPlainObject } from './utils';\nimport { addHook, removeHook, callHooks } from './api/hooks';\nimport { NaiveException } from './exception';\n\nconst templateHelpers = {\n  \"if\": function (condition, options) {\n    return condition ? h(options) : condition;\n  },\n  \"each\": function (list, createItem) {\n    const nodes = [];\n    for (let i = 0; i < list.length; ++i) {\n      const item = list[i];\n      const key = 'id' in item ? item['id'] : i;\n      nodes.push(h(createItem(item, key)));\n    }\n    return nodes;\n  }\n};\n\nexport default function Naive (options) {\n  options = options || {};\n  this._hooks = {};\n  if (!isFunction(options.state)) {\n    // 必须是 function\n    throw new NaiveException('state 必须是 [Function]');\n  }\n  const _state = options.state();\n  if (isPlainObject(_state)) {\n    this.state = _state;\n  } else {\n    warn('state 必须返回 [Plain Object]');\n    this.state = {};\n  }\n  this.render = function render () {\n    return options.render.call(this, h, templateHelpers);\n  };\n  this.ele = null;\n  this._init(options);\n}\n\n// Naive.createVElement = h;\n\nconst prtt = Naive.prototype;\n\nprtt.setState = function setState (state) {\n  extend(this.state, state);\n  this.update();\n  return this;\n};\n\n// 更新视图\nprtt.update = function update () {\n  if (!this.mounted) { // 如果组件没有挂载到元素上，不需要更新视图\n    return this;\n  }\n  const preVdom = this.vdom;\n  this.vdom = this.render();\n  console.log(preVdom, this.vdom);\n  const patches = diff(preVdom, this.vdom);\n  console.log(patches);\n  if (patches) {\n    patch(this, this.ele, patches);\n  } else {\n    warn('不需要更新视图');\n  }\n};\n\nprtt._init = function _init (options) {\n  const methods = options.methods || {};\n  // 将 methods 移到 this\n  for (let m in methods) {\n    if (methods.hasOwnProperty(m)) {\n      if (this.hasOwnProperty(m)) {\n        warn(`属性 \"${m}\" 已存在`);\n      } else {\n        this[m] = methods[m];\n      }\n    }\n  }\n  const hooks = options.hooks || {};\n  for (let p in hooks) {\n    if (hooks.hasOwnProperty(p)) {\n      this._addHook(p, hooks[p]);\n    }\n  }\n  this.vdom = this.render();\n};\n\nprtt.mount = function mount (selector) {\n  const mountPoint = getElement(selector);\n  if (!mountPoint) {\n    throw new NaiveException('找不到挂载节点');\n  }\n  const vdom = this.vdom;\n  if (vdom.length) { // fragment\n    const docFragment = createDocumentFragment();\n    const simFragment = { childNodes: [] };\n    for (let i = 0; i < vdom.length; ++i) {\n      const node = vdom[i].render(this);\n      simFragment.childNodes.push(node);\n      appendChild(node, docFragment);\n    }\n    this.ele = simFragment;\n    replaceNode(docFragment, mountPoint);\n  } else {\n    this.ele = vdom.render(this);\n    replaceNode(this.ele, mountPoint);\n  }\n  this.mounted = true;\n  this._callHooks('mounted');\n};\n\nprtt._callHooks = callHooks;\n\nprtt._addHook = addHook;\n\nprtt._removeHook = removeHook;\n\n// 销毁组件\nprtt.destroy = function destroy () {\n  // 销毁事件监听\n  // 调用 destroy 勾子\n  this._callHooks('destroy');\n  // 销毁勾子回调\n  for (let p in this._hooks) {\n    if (this._hooks.hasOwnProperty(p)) {\n      this._removeHook(p);\n    }\n  }\n};\n"],"names":["warn","message","window","console","isArray","Array","obj","Object","prototype","toString","call","isUndefined","extend","props","i","isFunction","isPlainObject","getElement","selector","query","createElement","tag","document","createTextNode","text","createDocumentFragment","context","querySelector","replaceNode","newNode","node","parentNode","replaceChild","appendChild","el","target","setAttr","attr","value","setAttribute","supportClassList","classList","hasClass","element","classes","split","filter","s","contains","length","tmp","className","indexOf","addClass","add","apply","forEach","c","replace","removeClass","VText","data","render","vdom2dom","handleDirective","directive","style","display","VNode","tagName","children","key","String","undefined","childNodes","child","isVNode","isVText","push","concat","count","checkAttrDirective","test","isEventDirective","attachEvent","eventName","handler","addEventListener","p","slice","handlerFunc","evt","PATCH","patch","domNode","patches","walker","index","dfsWalk","currentPatches","len","patchReorder","moves","move","type","INSERT","insertBefore","item","REMOVE","isAttrDirective","patchProps","hasOwnProperty","applyPatches","REPLACE","PROPS","TEXT","REORDER","makeKeyIndexAndFree","list","keyIndex","free","itemKey","listDiff","pList","nList","nMap","nKeys","nFree","pMap","pKeys","pFree","freeIndex","itemKeyIndex","remove","insert","simulateList","splice","n","nItem","nItemKey","sItem","sItemKey","nsItemKey","diff","oldTree","newTree","diffWalk","pNode","nNode","propsPatches","diffProps","objectEquals","a","b","JSON","stringify","oldTreeProps","newTreeProps","diffChildren","pChildNodes","nChildNodes","diffs","newChildren","reorderPatch","leftNode","currentNodeIndex","h","attrs","arguments","addHook","hookName","callback","callbacks","_hooks","removeHook","callHooks","_callbacks","NaiveException","name","templateHelpers","condition","options","createItem","nodes","Naive","state","_state","ele","_init","prtt","setState","update","mounted","preVdom","vdom","log","methods","m","hooks","_addHook","mount","mountPoint","docFragment","simFragment","_callHooks","_removeHook","destroy"],"mappings":"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"}