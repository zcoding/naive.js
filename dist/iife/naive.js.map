{"version":3,"file":"naive.js","sources":["../../src/utils.js","../../src/dom.js","../../src/vdom/vtext.js","../../src/directives/class.js","../../src/directives/show.js","../../src/directives/style.js","../../src/cache.js","../../src/parser.js","../../src/directives/model.js","../../src/event.js","../../src/directive.js","../../src/exception.js","../../src/vdom/h.js","../../src/vdom/vnode.js","../../src/vdom/utils.js","../../src/vdom/list-diff.js","../../src/vdom/dom-index.js","../../src/vdom/patch.js","../../src/vdom/diff.js","../../src/api/hooks.js","../../src/main.js"],"sourcesContent":["export function warn (message) {\n  if (window.console) {\n    console.warn(`[naive.js] ${message}`);\n  }\n}\n\nexport function error (message) {\n  if (window.console) {\n    console.error(`[naive.js] ${message}`);\n  }\n}\n\nexport const isArray = Array.isArray ? Array.isArray : function isArray (obj) {\n  return Object.prototype.toString.call(obj) === '[object Array]';\n};\n\nexport function toArray (obj) {\n  return Array.prototype.slice.call(obj, 0);\n}\n\nexport function isUndefined (obj) {\n  return typeof obj === 'undefined';\n}\n\nexport function noop () {}\n\nexport function extend(dest) {\n  if (typeof dest !== 'object' || !dest) {\n    return dest;\n  }\n  const sources = Array.prototype.slice.call(arguments, 1);\n  while (sources.length) {\n    const current = sources.shift();\n    for (let p in current) {\n      dest[p] = current[p]\n    }\n  }\n  return dest;\n}\n\nexport function clone(obj) {\n  return extend({}, obj);\n}\n\nexport function isFunction (obj) {\n  return typeof obj === 'function';\n}\n\nexport function isPlainObject (obj) {\n  return obj != null && typeof obj === 'object' && !isArray(obj) && Object.prototype.toString.call(obj) === '[object Object]';\n}\n\nexport function hasOwn (obj, prop) {\n  return obj.hasOwnProperty(prop);\n}\n\nlet resolved = typeof Promise!=='undefined' && Promise.resolve();\nexport const defer = resolved ? (f => { resolved.then(f); }) : setTimeout; // asap async\n","import { isUndefined, toArray } from './utils';\n\n/**\n * 获取元素\n *\n * IE 8 只支持到 CSS2 选择器\n *\n * @param {String} selector\n */\nexport function getElement(selector) {\n  return typeof selector === 'string' ? query(selector) : selector;\n}\n\nexport function createElement(tag) {\n  return document.createElement(tag);\n}\n\nexport function createTextNode (text) {\n  return document.createTextNode(text);\n}\n\nexport function createDocumentFragment () {\n  return document.createDocumentFragment();\n}\n\nexport function query(selector, context) {\n  context = context || document;\n  return context.querySelector(selector);\n}\n\n/**\n * 检查一个元素是否在 document 内\n */\nexport function inDoc(node) {\n  var doc = node.ownerDocument.documentElement;\n  return doc === node || node && node.nodeType === 1 && doc.contains(node);\n}\n\nexport function removeNode(node) {\n  const parentNode = node ? node.parentNode : null;\n  if (parentNode) {\n    parentNode.removeChild(node);\n  }\n}\n\nexport function createAnchor(name) {\n  var n = document.createTextNode('');\n  n.name = name;\n  return n;\n}\n\nexport function before(newNode, node) {\n  node.parentNode.insertBefore(newNode, node);\n}\n\nexport function replaceNode(newNode, node) {\n  node.parentNode.replaceChild(newNode, node);\n}\n\nexport function after(el, target) {\n  if (target.nextSibling) {\n    before(el, target.nextSibling)\n  } else {\n    target.parentNode.appendChild(el)\n  }\n}\n\nexport function appendChild (el, target) {\n  target.appendChild(el);\n}\n\nexport function setAttr (node, attr, value) {\n  node.setAttribute(attr, value);\n}\n\nexport function hasAttr(node, name) {\n  return node.hasAttribute(name);\n}\n\nexport function removeAttr(node, name) {\n  node.removeAttribute(name);\n}\n\nexport function removeAllChildren(node) {\n  while(node.childNodes.length > 0) {\n    node.removeChild(node.childNodes[0]);\n  }\n}\n\n\nconst classSplitReg = /\\s+/;\n\nconst supportClassList = !isUndefined(document.createElement('div').classList);\n\nlet getClasses = supportClassList ?\n  function(element) {\n    return toArray(element.classList);\n  }\n  :\n  function(element) {\n    return element.className.split(/\\s+/).filter(s => s);\n  };\n\nexport let hasClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var contains = true;\n    for (let i = 0; i < classes.length; ++i) {\n      if (!element.classList.contains(classes[i])) {\n        contains = false;\n        break;\n      }\n    }\n    return contains;\n  }\n  :\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var contains = true, tmp = element.className;\n    for (let i = 0; i < classes.length; ++i) {\n      if (tmp.indexOf(classes[i]) === -1) {\n        contains = false;\n        break;\n      }\n    }\n    return contains;\n  };\n\nexport let addClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    element.classList.add.apply(element.classList, classes);\n    return element;\n  }\n  :\n  function(element, classes) {\n    var tmp = element.className;\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      if (!hasClass(element, c)) {\n        tmp = tmp.replace(/\\s+|$/, ' ' + classes);\n      }\n    });\n    element.className = tmp;\n    return element;\n  };\n\nexport let removeClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    element.classList.remove.apply(element.classList, classes);\n    return element;\n  }\n  :\n  function(element, classes) {\n    var tmp = element.className;\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      if (hasClass(element, c)) {\n        tmp = tmp.replace(new RegExp(c, 'g'), '');\n      }\n    });\n    element.className = tmp;\n    return element;\n  };\n\nexport let toggleClass = supportClassList ?\n  function(element, classes, force) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      element.classList.toggle(c, force);\n    });\n    return element;\n  }\n  :\n  function(element, classes, force) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var useForce = force !== undefined;\n    classes.forEach(c => {\n      if (hasClass(element, c) && (useForce && !force || !useForce)) {\n        removeClass(element, c);\n      } else if (!hasClass(element, c) && (useForce && force || !useForce)) {\n        addClass(element, c);\n      }\n    });\n    return element;\n  };\n","import { createTextNode } from '../dom';\n\n// virtual text node\nexport default function VText (text) {\n  this.data = text;\n}\n\nVText.prototype.render = function renderVTextToTextNode () {\n  return createTextNode(this.data);\n};\n","import { isArray } from '../utils';\nimport { addClass, removeClass, setAttr } from '../dom';\n\nexport default function klass (setValue, element, context) {\n  if (typeof setValue === 'string') {\n    setAttr(element, 'class', setValue);\n  } else if (isArray(setValue)) {\n    setAttr(element, 'class', setValue.join(' '));\n  } else {\n    for (let c in setValue) {\n      if (setValue.hasOwnProperty(c)) {\n        if (setValue[c]) {\n          addClass(element, c);\n        } else {\n          removeClass(element, c);\n        }\n      }\n    }\n  }\n}\n","export default function show (value, element, context) {\n  element.style.display = value ? '' : 'none';\n}\n","export default function style (value, element, context) {\n  for (let s in value) {\n    element.style[s] = value[s];\n  }\n}\n","/**\n * 双向链表实现的使用 LRU 算法的缓存\n * 缓存最近最常用的项目，当缓存满时丢弃最近最少用的项目\n *\n * @param {Number} 缓存最大限制\n * @constructor\n */\n\nexport default function Cache (limit) {\n  this.size = 0; // 缓存大小\n  this.limit = limit; // 缓存大小最大限制\n  this.head = this.tail = undefined; // 头尾指针\n  this._keymap = Object.create(null); // 缓存映射表\n}\n\nvar p = Cache.prototype;\n\n/**\n * 将 <key> <value> 键值对存储到缓存映射表\n * 如果缓存满了，删除一个节点让出空间给新的缓存，并返回被删的节点\n * 否则返回 undefined\n *\n * @param {String} 键\n * @param {*} 值\n * @return {Entry|undefined}\n */\n\np.put = function (key, value) {\n  var removed;\n\n  var entry = this.get(key, true); // 先查看是否已经有缓存，如果有，只需要更新它的 value 就可以了\n  if (!entry) {\n    if (this.size === this.limit) { // 缓存满了\n      removed = this.shift();\n    }\n    entry = {\n      key: key\n    };\n    this._keymap[key] = entry;\n    if (this.tail) {\n      this.tail.newer = entry;\n      entry.older = this.tail;\n    } else {\n      this.head = entry;\n    }\n    this.tail = entry; // 将这个项目作为最新的插入缓存\n    this.size++;\n  }\n  entry.value = value;\n\n  return removed;\n}\n\n/**\n * 从缓存中清除最近最少使用（放得最久的）项目\n * 返回被清除的项目，如果缓存为空就返回 undefined\n */\n\np.shift = function () {\n  var entry = this.head;\n  if (entry) {\n    this.head = this.head.newer; // 头部的是最旧的，所以要从头部开始清除\n    this.head.older = undefined;\n    entry.newer = entry.older = undefined;\n    this._keymap[entry.key] = undefined;\n    this.size--;\n  }\n  return entry;\n}\n\n/**\n * 获取并且注册最近使用的 <key>\n * 返回 <key> 对应的值\n * 如果缓存中找不到这个 <key> 就返回 undefined\n *\n * @param {String} 键\n * @param {Boolean} 是否返回整个 entry ，如果为 false 则只返回 value\n * @return {Entry|*} 返回 Entry 或者它的值，或者 undefined\n */\n\np.get = function (key, returnEntry) {\n  var entry = this._keymap[key];\n  if (entry === undefined) return; // 缓存不存在，直接返回 undefined\n  if (entry === this.tail) { // 缓存是最新的，直接返回这个缓存项（或者它的值）\n    return returnEntry\n      ? entry\n      : entry.value;\n  }\n  // HEAD--------------TAIL\n  //   <.older   .newer>\n  //  <--- add direction --\n  //   A  B  C  <D>  E\n  if (entry.newer) { // 如果缓存不是最新的\n    if (entry === this.head) { // 如果缓存是最旧的\n      this.head = entry.newer; // 将比它新的作为最旧的\n    }\n    entry.newer.older = entry.older; // C <-- E. 将它的后一个作为前一个的最旧\n  }\n  if (entry.older) { // 如果有比它更旧的\n    entry.older.newer = entry.newer; // C. --> E 将它的前一个作为后一个的最新\n  }\n  entry.newer = undefined; // D --x // 它本身没有更新的\n  entry.older = this.tail; // D. --> E\n  if (this.tail) {\n    this.tail.newer = entry; // E. <-- D\n  }\n  this.tail = entry; // 将自己作为最新的\n  return returnEntry\n    ? entry\n    : entry.value;\n}\n","import Cache from './cache';\nimport { isUndefined } from './utils';\n\nconst pathCache = new Cache(1000);\n\nconst TrimRE = /^\\s+|\\s$/g;\nconst WordsRE = /([a-zA-Z$][\\w.$]*)/g;\n\n// 一个别名对应一个作用域\nfunction parseExpressionFor(exp, scope) {\n  var vars = exp.split(/\\s+in\\s+/);\n  var alias = vars[0], expression = vars[1];\n  return {\n    alias: alias,\n    raw: expression,\n    scope: expression,\n    expression: parseExpressionGetter(expression, scope)\n  };\n}\n\nexport function splitPath(expression) {\n  expression = expression.replace(/^\\s+|\\s$/g, ''); // trim\n  var wordsRE = /([a-zA-Z$][\\w.$]*)/g;\n  return expression.match(wordsRE) || [];\n}\n\nconst saveRE = /[\\{,]\\s*[\\w\\$_]+\\s*:|('(?:[^'\\\\]|\\\\.)*'|\"(?:[^\"\\\\]|\\\\.)*\")/g;\nconst restoreRE = /\"(\\d+)\"/g;\nconst wsRE = /\\s/g;\nconst newlineRE = /\\n/g;\nconst identRE = /[^\\w$\\.](?:[A-Za-z_$][\\w$]*)/g;\n\nvar saved = [];\n\nfunction save (str, isString) {\n  var i = saved.length\n  saved[i] = isString\n    ? str.replace(newlineRE, '\\\\n')\n    : str\n  return '\"' + i + '\"'\n}\n\nfunction rewrite (raw, scope) {\n  var c = raw.charAt(0);\n  var path = raw.slice(1);\n  path = path.indexOf('\"') > -1\n    ? path.replace(restoreRE, restore)\n    : path;\n  var scopeVarKey = '';\n  for (let i = scope.length - 1; i >= 0; --i) { // 从后往前\n    var _scope = scope[i];\n    var namePaths = parsePath(path);\n    if (namePaths.length > 0 && namePaths[0] === _scope.alias) { // 匹配到别名，说明在当前作用域\n      namePaths = namePaths.slice(1);\n      scopeVarKey = _scope.scope + '[' + _scope.$index + ']' + (namePaths.length > 0 ? '.' + namePaths.join('.') : '');\n      break;\n    }\n  }\n  var body = 'vm.get(\"' + (scopeVarKey ? scopeVarKey : path) + '\")';\n  return c + body;\n}\n\nfunction restore (str, i) {\n  return saved[i];\n}\n\n/**\n * 解析一个表达式\n * @param {String} expression 表达式字符串\n * @param {String} scope 作用域限制\n * @return {Function} 一个函数，用来返回表达式的值\n */\nexport function parseExpressionGetter(expression, scope) {\n  saved.length = 0;\n  var parsed = expression\n    .replace(saveRE, save)\n    .replace(wsRE, '');\n  parsed = (' ' + parsed)\n    .replace(identRE, function(raw) {\n      return rewrite(raw, scope);\n    })\n    .replace(restoreRE, restore);\n  return makeGetterFunction(parsed);\n}\n\nfunction makeGetterFunction(body) {\n  return new Function('vm', 'return ' + body + ';');\n}\n\n/**\n * parseExpression 解析表达式\n * 对于 `b-for` 指令，需要特殊处理，其它指令只要返回表达式执行函数即可\n *\n * @param {String} name 指令名称\n * @param {String} expression 表达式字符串\n * @param {String} 作用域限制\n * @return {{raw:String, expression:Function}}\n */\nexport function parseExpression(name, expression, scope) {\n  if (name === 'b-for') {\n    return parseExpressionFor(expression, scope);\n  }\n  if (name === 'b-on') {\n    return {\n      raw: expression,\n      expression: expression\n    };\n  }\n  return {\n    raw: expression,\n    expression: parseExpressionGetter(expression, scope)\n  };\n}\n\n/**\n * parsePath 解析取值路径，返回真正的值，如果找不到，返回 undefined\n *\n * @param {Object} data\n * @param {String} path\n * @return {*} value\n * @throw {Error} 不合法的路径\n *\n * @example\n * parsePath('a.b.c') === ['a', 'b', 'c']\n */\nexport function parsePath(path) {\n  var hit = pathCache.get(path);\n  if (hit) {\n    return hit;\n  }\n  // data.a.b.c 👍\n  // data.a[\"b\"].c 👍\n  // data[\"a\"][\"b\"][\"c\"] 👍\n  // data.a[\"b.c\"] 👍\n  // data[\"a.b.c\"] 👍\n  // data.a[b] 👎\n  // data.a[b.c] 👎\n  var parts = path.split(/\\[|\\]/g), i = 0;\n  var props = [];\n  while (i < parts.length) {\n    var match1 = /^(\\.)?[^\\'\\\"\\.\\s]+(\\.[^\\'\\\"\\.\\s]+)*$/.test(parts[i]);\n    var match2 = /(^\\s*\\'.+\\'\\s*$)|(^\\s*\\\".+\\\"\\s*$)|(^\\s*$)/.test(parts[i]);\n    if (!(match1 || match2)) {\n      throw new Error(\"不合法的路径: \" + path);\n    }\n    if (match1) {\n      var _props = parts[i].split('.'), j = 0;\n      while(j < _props.length) {\n        if (_props[j] === '') {\n          if (i !== 0) {\n            j++;\n            continue;\n          } else {\n            throw new Error(\"不合法的路径: \" + path);\n          }\n        } else {\n          props.push(_props[j]);\n        }\n        j++;\n      }\n    } else { // match2\n      if (!/^\\s*$/.test(parts[i])) {\n        var _prop = parts[i].replace(/^\\s*[\\\"\\']|[\\'\\\"]\\s*$/g, '');\n        props.push(_prop);\n      }\n    }\n    i++;\n  }\n  pathCache.put(path, props);\n  return props;\n}\n\nexport function getObjectFromPath(data, path) {\n  var props = parsePath(path);\n  var result = props.length > 0 ? data : undefined;\n  for (let i = 0; i < props.length; ++i) {\n    result = result[props[i]];\n    if (!result) {\n      break;\n    }\n  }\n  return result;\n}\n\nexport function setObjectFromPath(data, path, value) {\n  var props = parsePath(path);\n  var current = data, parent = data;\n  for (var i = 0; i < props.length - 1; ++i) {\n    parent = current;\n    current = current[props[i]];\n    if (isUndefined(current)) {\n      current = {};\n      parent[props[i]] = current;\n    }\n  }\n  if (i >= 0) {\n    if (typeof current === 'object') {\n     current[props[i]] = value;\n    } else {\n      current = {};\n      current[props[i]] = value;\n      parent[props[i-1]] = current;\n    }\n  }\n}\n","import { getObjectFromPath } from '../parser';\nimport { isArray } from '../utils';\n\nexport default function model(value, element, context) {\n  const currentValue = getObjectFromPath(context.state, value);\n  if (element.type === 'radio') {\n    element.checked = currentValue === element.value;\n  } else if (element.type === 'checkbox') {\n    if (isArray(currentValue)) {\n      element.checked = currentValue.indexOf(element.value) !== -1;\n    } else {\n      element.checked = currentValue === element.value;\n    }\n  } else if (element.tagName === 'SELECT') {\n    if (element.multiple) {\n      const options = element.options;\n      for (let i = 0; i < options.length; ++i) {\n        if (currentValue.indexOf(options[i].value) !== -1) {\n          options[i].selected = true;\n        } else {\n          options[i].selected = false;\n        }\n      }\n    } else {\n      if (element.value !== currentValue) {\n        element.value = currentValue;\n      }\n    }\n  } else {\n    if (element.value !== currentValue) {\n      element.value = currentValue;\n    }\n  }\n}\n","export function attachEvent (el, eventName, handler) {\n  if (el.addEventListener) {\n    el.addEventListener(eventName, handler, false);\n  } else if (el.attachEvent) {\n    el.attachEvent(eventName, handler);\n  }\n}\n\nexport function detachEvent (el, eventName, handler) {\n  if (el.removeEventListener) {\n    el.removeEventListener(eventName, handler, false);\n  } else if (el.detachEvent) {\n    el.detachEvent(eventName, handler);\n  }\n}\n","import { setAttr, removeAttr, removeClass } from './dom';\nimport { isArray } from './utils';\nimport klass from './directives/class';\nimport show from './directives/show';\nimport style from './directives/style';\nimport model from './directives/model';\nimport { attachEvent } from './event';\nimport { getObjectFromPath, setObjectFromPath } from './parser';\n\nexport function handleDirective (directive, value, element, context) {\n  switch (directive) {\n    case 'show':\n      show(value, element, context);\n      break;\n    case 'class':\n      klass(value, element, context);\n      break;\n    case 'style':\n      style(value, element, context);\n      break;\n    case 'model':\n      model(value, element, context);\n      break;\n    default:\n      if (directive === 'disabled' || directive === 'checked') {\n        if (value) {\n          setAttr(element, directive, directive);\n        } else {\n          removeAttr(element, directive);\n        }\n      } else {\n        setAttr(element, directive, value);\n      }\n      break;\n  }\n}\n\nexport function bindDirective (directive, value, element, context) {\n  switch (directive) {\n    case 'model':\n      if (element.type === 'radio') {\n        attachEvent(element, 'change', function handleChange(event) {\n          const selectValue = event.currentTarget.value;\n          const currentState = context.state;\n          setObjectFromPath(currentState, value, selectValue);\n          context.setState(currentState);\n        });\n      } else if (element.type === 'checkbox') {\n        attachEvent(element, 'change', function handleChange() {\n          const selectValue = event.currentTarget.value;\n          const currentState = context.state;\n          const preValue = getObjectFromPath(currentState, value);\n          if (event.currentTarget.checked) {\n            if (preValue.indexOf(selectValue) === -1) {\n              preValue.push(selectValue);\n            }\n          } else {\n            let i = 0;\n            while(i < preValue.length) {\n              if (preValue[i] === selectValue) {\n                preValue.splice(i, 1);\n                break;\n              }\n              ++i;\n            }\n          }\n          context.setState(currentState);\n        });\n      } else if (element.tagName === 'SELECT') {\n        attachEvent(element, 'change', function handleInput () {\n          // 通过 path 设置 state\n          const currentState = context.state;\n          if (element.multiple) {\n            const options = element.options;\n            const newValue = [];\n            for (let i = 0; i < options.length; ++i) {\n              if (options[i].selected) {\n                newValue.push(options[i].value);\n              }\n            }\n            setObjectFromPath(currentState, value, newValue);\n            context.setState(currentState);\n          } else {\n            setObjectFromPath(currentState, value, element.value);\n            context.setState(currentState);\n          }\n        });\n      } else {\n        attachEvent(element, 'input', function handleInput () {\n          // 通过 path 设置 state\n          const currentState = context.state;\n          setObjectFromPath(currentState, value, element.value);\n          context.setState(currentState);\n        });\n      }\n      break;\n    default:\n  }\n}\n\nfunction removeClassAttr (removeValue, element, context) {\n  if (typeof removeValue === 'string') {\n    removeClass(element, removeValue);\n  } else if (isArray(removeValue)) {\n    removeClass(element, removeValue.join(' '));\n  } else {\n    for (let c in removeValue) {\n      if (removeValue.hasOwnProperty(c)) {\n        removeClass(element, c);\n      }\n    }\n  }\n}\n\nexport function handleDirectiveRemove (directive, value, element, context) {\n  switch (directive) {\n    case 'class':\n      removeClassAttr(value, element, context);\n      break;\n  }\n}\n","export function NaiveException (message) {\n  this.name = 'NaiveException';\n  this.message = message;\n}\n","import VNode from './vnode';\nimport VText from './vtext';\nimport { isArray, isPlainObject } from '../utils';\nimport { isVNode, isVText, isVComponent } from './utils';\n\n// create VNode, VText, VComponent\nexport default function h (tagName, props, children, key) {\n  const context = this || {};\n  const components = context['components'] || {};\n  if (isVNode(tagName) || isVText(tagName) || isVComponent(tagName)) {\n    return tagName;\n  } else if (isPlainObject(tagName)) {\n    if (components.hasOwnProperty(tagName.tagName)) {\n      return components[tagName.tagName](tagName.props, tagName.children, tagName.key);\n    } else {\n      return new VNode(tagName.tagName, tagName.attrs, tagName.children, tagName.key);\n    }\n  } else if (isArray(tagName)) {\n    const list = [];\n    for (let i = 0; i < tagName.length; ++i) {\n      list.push(h(tagName[i]));\n    }\n    return list;\n  } else if(arguments.length < 2) {\n    return new VText(tagName);\n  } else {\n    if (components.hasOwnProperty(tagName)) {\n      return components[tagName](props, children, key);\n    } else {\n      return new VNode(tagName, props, children, key);\n    }\n  }\n}\n","import { createElement, setAttr, appendChild } from '../dom';\nimport VText from './vtext';\nimport { isVNode, isVText, isVComponent } from './utils';\nimport { isArray, isFunction, warn, toArray } from '../utils';\nimport { handleDirective, bindDirective } from '../directive';\nimport { attachEvent } from '../event';\nimport { NaiveException } from '../exception';\nimport { getObjectFromPath } from '../parser';\nimport h from './h';\n\nexport default function VNode (tagName, props, children, key) {\n  this.tagName = tagName;\n  this.props = props || {};\n  this.key = key ? String(key) : undefined; // key 用来标识节点，方便 diff\n  let childNodes = [];\n  children = children || [];\n  for (let i = 0; i < children.length; ++i) {\n    const child = children[i];\n    if (isArray(child)) {\n      childNodes = childNodes.concat(h.call(this, child));\n    } else {\n      if (child) {\n        childNodes.push(h.call(this, child));\n      }\n    }\n  }\n  this.children = childNodes;\n  let count = this.children.length;\n  for (let i = 0; i < this.children.length; ++i) {\n    count += this.children[i].count || 0;\n  }\n  this.count = count; // 记录子节点数，在 patch 的时候找到节点位置\n}\n\n// 检查是否指令属性\nfunction checkAttrDirective (attr) {\n  return /^@|n-|:/.test(attr);\n}\n\n// add event listener\nfunction isEventDirective (attr) {\n  return /^@/.test(attr);\n}\n\n// 事件指令的值可能是表达式\nfunction matchExpression (exp) {\n  return exp.match(/(.*)\\((.*)\\)/);\n}\n\nfunction parseArgumentList (exp) {\n  let i = 0;\n  let needSeparate = false;\n  let inSingle = false;\n  let single = [];\n  let inDouble = false;\n  let double = [];\n  let inWord = false;\n  let word = [];\n  let args = [];\n  while (i < exp.length) {\n    const t = exp[i];\n    if (t === '\\'') {\n      if (inSingle) {\n        args.push({\n          type: 'string',\n          value: single.join('')\n        });\n        single.splice(0);\n        inSingle = false;\n        needSeparate = true;\n      } else if (inDouble) {\n        double.push(t);\n      } else if (inWord) {\n        throw new NaiveException('参数错误');\n      } else if (needSeparate) {\n        throw new NaiveException('参数错误');\n      } else {\n        inSingle = true;\n      }\n    } else if (t === '\"') {\n      if (inDouble) {\n        args.push({\n          type: 'string',\n          value: double.join('')\n        });\n        double.splice(0);\n        inDouble = false;\n        needSeparate = true;\n      } else if (inSingle) {\n        double.push(t);\n      } else if (inWord) {\n        throw new NaiveException('参数错误');\n      } else if (needSeparate) {\n        throw new NaiveException('参数错误');\n      } else {\n        inDouble = true;\n      }\n    } else if (t === ',') {\n      if (inSingle) {\n        single.push(t);\n      } else if (inDouble) {\n        double.push(t);\n      } else if (inWord) {\n        args.push({\n          type: 'exp',\n          value: word.join('')\n        });\n        word.splice(0);\n        inWord = false;\n        needSeparate = false;\n      } else if (!needSeparate) {\n        throw new NaiveException('参数错误');\n      } else {\n        needSeparate = false;\n      }\n    } else if (t === ' ') {\n      if (inSingle) {\n        single.push(t);\n      } else if (inDouble) {\n        double.push(t);\n      } else if (inWord) {\n        throw new NaiveException('参数错误');\n      }\n    } else {\n      if (inSingle) {\n        single.push(t);\n      } else if (inDouble) {\n        double.push(t);\n      } else if (inWord) {\n        word.push(t);\n      } else {\n        if (needSeparate) {\n          throw new NaiveException('参数错误');\n        } else {\n          word.push(t);\n          inWord = true;\n        }\n      }\n    }\n    ++i;\n  }\n  if (inSingle || inDouble) {\n    throw new NaiveException('参数错误');\n  } else if (inWord) {\n    args.push({\n      type: 'exp',\n      value: word.join('')\n    });\n  }\n  return args;\n}\n\nfunction parseExpression (exp, data) {\n  if (/^[+-]?\\d+\\.?\\d*?$/.test(exp)) {\n    return Number(exp);\n  } else {\n    return getObjectFromPath(data, exp);\n  }\n}\n\nexport function bindEvent (eventName, exp, element, context) {\n  let handlerFunc;\n  if (isFunction(exp)) {\n    handlerFunc = exp;\n  } else {\n    const matches = matchExpression(exp);\n    if (matches) {\n      const methodName = matches[1];\n      handlerFunc = function (evt) {\n        const args = parseArgumentList(matches[2]);\n        const _args = [];\n        for (let i = 0; i < args.length; ++i) {\n          if (args[i].type === 'string') {\n            _args.push(args[i].value);\n          } else if (args[i].value === '$event') {\n            _args.push(evt);\n          } else {\n            _args.push(parseExpression(args[i].value, this.state));\n          }\n        }\n        this[methodName].apply(this, _args);\n      };\n    } else {\n      handlerFunc = context[exp];\n    }\n  }\n  attachEvent(element, eventName, function handler(evt) {\n    return handlerFunc.call(context, evt);\n  });\n}\n\nVNode.prototype.render = function renderVNodeToElement(context) {\n  const element = createElement(this.tagName);\n  const props = this.props;\n  const nodeContext = this;\n  for (let p in props) {\n    if (props.hasOwnProperty(p)) {\n      if (/^n-/.test(p)) {\n        bindDirective(p.slice(2), props[p], element, context);\n        handleDirective(p.slice(2), props[p], element, context);\n      } else if (/^:/.test(p)) {\n        handleDirective(p.slice(1), props[p], element, context);\n      } else if (/^@/.test(p)) {\n        const eventName = p.slice(1);\n        const exp = props[p];\n        bindEvent(eventName, exp, element, context);\n      } else {\n        setAttr(element, p, props[p]);\n      }\n    }\n  }\n  for (let i = 0; i < this.children.length; ++i) {\n    const child = this.children[i];\n    appendChild(child.render(context), element);\n    if (isVComponent(child)) {\n      child._callHooks('mounted');\n    }\n  }\n  return element;\n};\n","import VText from './vtext';\nimport VNode from './vnode';\nimport Naive from '../main';\n\nexport function isVNode (node) {\n  return node instanceof VNode;\n}\n\nexport function isVText (node) {\n  return node instanceof VText;\n}\n\nexport function isVComponent (node) {\n  return node instanceof Naive;\n}\n","// 分别找到有 key 的元素位置和没有 key 的元素的位置\nfunction keyIndex (list) {\n  const keys = {}; // 有 key 的节点位置\n  const free = []; // 可替换的位置（没有 key 的节点都被标识为可替换的节点）\n  for (let i = 0; i < list.length; i++) {\n    const item = list[i]\n    const itemKey = item.key;\n    if (typeof itemKey !== 'undefined') {\n      keys[itemKey] = i;\n    } else {\n      free.push(i);\n    }\n  }\n  return {\n    keys: keys,\n    free: free\n  };\n}\n\n// 模拟删除\nfunction remove(arr, index, key) {\n  arr.splice(index, 1);\n  return {\n    from: index,\n    key: key\n  };\n}\n\nexport default function reorder(pList, nList) {\n  // N: pList.length\n  // M: nList.length\n  // O(M) time, O(M) memory\n  const nListIndex = keyIndex(nList);\n  const nKeys = nListIndex.keys;\n  const nFree = nListIndex.free;\n\n  if (nFree.length === nList.length) { // 如果 nList 全部节点都没有 key 就不需要 reorder 把 nList 直接作为 reorder 之后的列表返回\n    return {\n      list: nList,\n      moves: null\n    };\n  }\n\n  // O(N) time, O(N) memory\n  const pListIndex = keyIndex(pList)\n  const pKeys = pListIndex.keys;\n  const pFree = pListIndex.free;\n\n  if (pFree.length === pList.length) { // 如果 pList 全部节点都没有 key 就不需要 reorder 把 nList 直接作为 reorder 之后的列表返回\n    return {\n      list: nList,\n      moves: null\n    };\n  }\n\n  // O(MAX(N, M)) memory\n  const rList = [];\n\n  let freeIndex = 0; // 表示没有 key 的节点已使用的个数\n  let freeCount = nFree.length; // 表示 nList 中没有 key 的节点的总个数\n  let deletedItems = 0; // 被删除的节点的个数\n\n  // O(N) time\n  // 遍历 pList 将 pList 有 key 的节点映射到 nList 的节点，如果没有映射，就用 null 表示节点将被删除。pList 空闲节点用 nList 的空闲节点按顺序占位\n  for (let i = 0 ; i < pList.length; i++) {\n    const pItem = pList[i];\n\n    if (typeof pItem.key !== 'undefined') { // key 节点\n      if (nKeys.hasOwnProperty(pItem.key)) { // 有映射\n        const itemIndex = nKeys[pItem.key];\n        rList.push(nList[itemIndex]);\n      } else { // 没有映射\n        deletedItems++;\n        rList.push(null);\n      }\n    } else { // 空闲节点\n      if (freeIndex < freeCount) { // nList 的空闲节点还没用完，继续用\n        const itemIndex = nFree[freeIndex++];\n        rList.push(nList[itemIndex]);\n      } else { // nList 的空闲节点用完了，这个 pList 的空闲节点没有节点与其对应，应该被删除\n        deletedItems++;\n        rList.push(null);\n      }\n    }\n  }\n\n  const lastFreeIndex = freeIndex >= nFree.length ? // nList 中下一个空闲节点的位置\n      nList.length : // nList 中空闲节点已经用完了\n      nFree[freeIndex]; // 未用完\n\n  // O(M) time\n  // 遍历 nList 将新增节点／剩余空闲节点追加到 rList 末尾\n  for (let j = 0; j < nList.length; j++) {\n    const nItem = nList[j];\n    if (nItem.key) {\n      if (!pKeys.hasOwnProperty(nItem.key)) {\n        rList.push(nItem);\n      }\n    } else if (j >= lastFreeIndex) {\n      rList.push(nItem);\n    }\n  }\n\n  const simulateList = rList.slice(0); // 复制一份，模拟 rList -> nList 重排操作\n  let simulateIndex = 0;\n  const removes = []; // 被移除的节点\n  const inserts = []; // 被插入的节点\n  let simulateItem;\n\n  for (let k = 0; k < nList.length;) {\n    const wantedItem = nList[k]; // 目标节点\n    simulateItem = simulateList[simulateIndex]; // 模拟节点\n\n    // 先模拟删除\n    while (simulateItem === null && simulateList.length) {\n      removes.push(remove(simulateList, simulateIndex, null)); // 删除不需要记录 key 的节点\n      simulateItem = simulateList[simulateIndex];\n    }\n\n    if (!simulateItem || simulateItem.key !== wantedItem.key) {\n      // 如果当前位置有 key\n      if (wantedItem.key) {\n        // 如果当前节点的位置不对，要进行移动\n        if (simulateItem && simulateItem.key) {\n          if (nKeys[simulateItem.key] !== k + 1) {\n            removes.push(remove(simulateList, simulateIndex, simulateItem.key)); // 先移除当前位置的节点\n            simulateItem = simulateList[simulateIndex]; // 删除后，该位置对应的是下一个节点\n            // 然后在当前位置插入目标节点\n            if (!simulateItem || simulateItem.key !== wantedItem.key) { // 如果删除之后还不对应，就插入目标节点\n              inserts.push({key: wantedItem.key, to: k});\n            } else { // 删除后正好对应就不需要插入了\n              simulateIndex++; // 检查下一个\n            }\n          }\n          else { // nKeys[simulateItem.key] === k + 1 如果下一个目标节点和当前模拟节点对应\n            inserts.push({key: wantedItem.key, to: k});\n          }\n        }\n        else { // 位置不对，插入\n          inserts.push({key: wantedItem.key, to: k});\n        }\n        k++;\n      }\n      // 目标节点没有 key 但是 模拟节点有 key\n      else if (simulateItem && simulateItem.key) {\n        // 位置不对，删除\n        removes.push(remove(simulateList, simulateIndex, simulateItem.key))\n      }\n    }\n    else {\n      simulateIndex++;\n      k++;\n    }\n  }\n\n  // 删除所有剩余节点\n  while(simulateIndex < simulateList.length) {\n    simulateItem = simulateList[simulateIndex];\n    removes.push(remove(simulateList, simulateIndex, simulateItem && simulateItem.key));\n  }\n\n  // 这种情况不需要移位，只需要删除多余的节点：没有 key 对应的节点、多余的空闲节点\n  if (removes.length === deletedItems && !inserts.length) {\n    return {\n      list: rList,\n      moves: null\n    };\n  }\n\n  return {\n    list: rList,\n    moves: {\n      removes: removes,\n      inserts: inserts\n    }\n  };\n}\n\n// reorder:\n// [f1, A, B, C, D, f2] => [f3, C, B, A, f4, E, f5]\n// rList: [f3, A, B, C, null, f4]\n// rList: [f3, A, B, C, null, f4, E, f5]\n// deletedItems: 1\n// simulateList: [f3, A, B, C, null, f4, E, f5]\n// nList:        [f3, C, B, A, f4,   E,  f5   ]\n// si:0, k:0, nItem:f3, sItem:f3\n// s1:1, k:1, nItem:C, sItem:A\n// remove(1, A) => simulateList:[f3, B, C, null, f4, E, f5], sItem:B\n// insert(1, C) k++\n// si:1, k:2, nItem:B, sItem:B\n// si:2, k:3, nItem:A, sItem:C\n// remove(2, C) => simulateList:[f3, B, null, f4, E, f5], sItem:null\n// insert(3, A) k++\n// si:2, k:4, nItem:f4, sItem:null\n// remove(2, null) => simulateList:[f3, B, f4, E, f5], sItem:f4\n// si:2, k:4, nItem:f4, sItem:f4 => si++, k++\n// si:3, k:5, nItem:E, sItem:E => si++, k++\n// si:4, k:6, nItem:f5, sItem:f5 => si++, k++\n// si:5, k:7\n// moves:{removes: [(1, A), (2, C), (2, null)], inserts: [(1, C), (3, A)]}\n\n// diffChildren:\n// pList: [f1, A1, B1, C1, D,    f2       ]\n// rList: [f3, A2, B2, C2, null, f4, E, f5]\n// diff(f1, f3)\n// diff(A1, A2)\n// diff(B1, B2)\n// diff(C1, C2)\n// diff(D, null) => remove(D)\n// diff(f2, f4)\n// insert(null, E)\n// insert(null, f5)\n// {order: moves}\n\n// patch:\n// [f1, A1, B1, C1, D, f2]\n// 目标: [f3, C2, B2, A2, f4, E, f5]\n// insert(null, E) => [f1, A1, B1, C1, D, f2, E]\n// insert(null, f5) => [f1, A1, B1, C1, D, f2, E, f5]\n// patch order:\n// remove(1, A) => [f1, B1, C1, D, f2, E, f5], map:{A: A1}\n// remove(2, C) => [f1, B1, D, f2, E, f5], map:{A: A1, C: C1}\n// remove(2, null) => [f1, B1, f2, E, f5]\n// insert(1, C) => [f1, C1, B1, f2, E, f5]\n// insert(3, A) => [f1, C1, B1, A1, f2, E, f5]\n// patch 子节点\n// patch(f1, f3)\n// patch(A1, A2)\n// patch(B1, B2)\n// patch(C1, C2)\n// remove D 已删除，不会重复删除\n// patch(f2, f4)\n","// 映射 dom 树与 virtual-dom 树，找到对应索引的 dom 节点并保存索引映射\nexport function domIndex (domTree, vdomTree, indices) {\n  if (indices.length === 0) {\n    return {};\n  } else {\n    const mapping = {};\n    recurse(domTree, vdomTree, indices, mapping, 0);\n    return mapping;\n  }\n}\n\nfunction recurse (rootNode, vdomTree, indices, mapping, rootIndex) {\n  if (rootNode) {\n    if (indexInRange(indices, rootIndex, rootIndex)) {\n      mapping[rootIndex] = rootNode;\n    }\n    if (vdomTree.children) { // 只有 VNode 要查找 VText/VComponent 不需要\n      let currentIndex = rootIndex;\n      const childNodes = rootNode.childNodes;\n      for (let i = 0; i < vdomTree.children.length; ++i) {\n        const vChild = vdomTree.children[i] || {};\n        currentIndex += 1;\n        const nextIndex = currentIndex + (vChild.count || 0);\n        if (indexInRange(indices, currentIndex, nextIndex)) {\n          recurse(childNodes[i], vChild, indices, mapping, currentIndex);\n        }\n        currentIndex = nextIndex;\n      }\n    }\n  }\n}\n\n// 查找 indices 数组（已排序），判断是否存在 [min, max] 区间内的元素\nfunction indexInRange (indices, min, max) {\n  if (indices.length === 0 || min > max) {\n    return false;\n  }\n  let result = false;\n  let head = 0, tail = indices.length - 1;\n  let current, currentIndex;\n  while (head <= tail) {\n    currentIndex = ((head + tail) / 2) >> 0; // 移位操作为了快速向下取整\n    current = indices[currentIndex];\n    if (head === tail) {\n      result = current >= min && current <= max;\n      break;\n    } else if (current < min) {\n      head = currentIndex + 1;\n    } else if (current > max) {\n      tail = currentIndex - 1;\n    } else { // min <= current <= max\n      result = true;\n      break;\n    }\n  }\n  return result;\n}\n","import { setAttr, replaceNode, removeNode, removeAttr } from '../dom';\nimport { handleDirective, handleDirectiveRemove } from '../directive';\nimport { attachEvent, detachEvent } from '../event';\nimport { domIndex } from './dom-index';\nimport { bindEvent } from './vnode';\nimport { isVComponent } from './utils';\n\nexport const PATCH = {\n  REPLACE: 0, // 替换节点\n  INSERT: 1, // 插入\n  REMOVE: 2, // 移除\n  REORDER: 3, // 重排\n  PROPS: 4, // 修改属性\n  TEXT: 5, // 替换文本\n  COMPONENT: 6 // 组件 patch\n};\n\nfunction ascending(a, b) {\n  return a > b ? 1 : -1;\n}\n\n// 根据补丁更新 DOM 节点\nfunction doApplyPatches (context, domNode, patches) {\n  for (let i = 0; i < patches.length; ++i) {\n    const patch = patches[i];\n    switch (patch.type) {\n      case PATCH.REPLACE: // 替换元素节点\n        replaceNode(patch.node.render(context), domNode);\n        break;\n      case PATCH.PROPS: // 属性修改\n        patchProps(domNode, patch, context);\n        break;\n      case PATCH.TEXT: // 替换文本内容\n        domNode.data = patch.data;\n        break;\n      case PATCH.REORDER: // 子节点重新排序\n        patchReorder(context, domNode, patch.moves);\n        break;\n      case PATCH.INSERT:\n        if (isVComponent(patch.node)) { // 插入组件\n          // console.log('插入组件')\n          const childComponent = patch.node;\n          if (childComponent.$root) {\n            // 如果组件已经有 $root 就 setState -> update\n            childComponent.update();\n            domNode.appendChild(childComponent.$root)\n          } else {\n            // 否则直接 render\n            domNode.appendChild(childComponent.render(context))\n          }\n          childComponent._callHooks('mounted');\n        } else { // 插入节点\n          if (domNode) {\n            domNode.appendChild(patch.node.render(context));\n          } else {\n            // 如果节点不存在了，不需要执行插入操作\n          }\n        }\n        break;\n      case PATCH.REMOVE:\n        if (isVComponent(patch.node)) { // 移除组件\n          // console.log('移除组件')\n          const childComponent = patch.node;\n          childComponent.unmount();\n        } else { // 移除节点\n          removeNode(domNode);\n        }\n        break;\n      case PATCH.COMPONENT: // 可能是同一组件或不同组件，但肯定都是组件\n        if (patch.pVdom.key === patch.nVdom.key) {\n          patch.pVdom.update();\n        } else {\n          patch.nVdom.update();\n          patch.nVdom.mount(patch.pVdom.$root);\n          patch.pVdom.unmount();\n        }\n        break;\n      default:\n        // warn\n    }\n  }\n}\n\nexport function applyPatch (context, domNode, patch) {\n  const patches = patch.patches;\n  // 先找需要 patch 的 dom 节点\n  const indices = [];\n  for (let p in patches) {\n    if (patches.hasOwnProperty(p)) {\n      indices.push(+p); // 一定要转成数字\n    }\n  }\n  indices.sort(ascending);\n  let pVdom = patch.pVdom;\n  const domMapping = domIndex(domNode, pVdom, indices);\n  for (let i = 0; i < indices.length; ++i) {\n    const idx = indices[i];\n    doApplyPatches(context, domMapping[idx], patches[idx]);\n  }\n}\n\nfunction patchReorder (context, domNode, moves) {\n  const removes = moves.removes;\n  const inserts = moves.inserts;\n  const childNodes = domNode.childNodes;\n  const keyMap = {};\n  // 先删除\n  for (let i = 0; i < removes.length; ++i) {\n    const remove = removes[i];\n    const toRemove = childNodes[remove.from];\n    if (remove.key) { // 需要保留，等待重新插入\n      keyMap[remove.key] = toRemove;\n    }\n    removeNode(toRemove);\n  }\n  // 后插入\n  for (let i = 0; i < inserts.length; ++i) {\n    const insert = inserts[i];\n    const target = insert.to < childNodes.length ? childNodes[insert.to] : null;\n    const toInsert = keyMap[insert.key];\n    domNode.insertBefore(toInsert, target);\n  }\n}\n\n// 检查是否指令属性\nfunction isAttrDirective (attr) {\n  return /^@|n-|:/.test(attr);\n}\n// 检查是否事件指令\nfunction isEventDirective (attr) {\n  return /^@/.test(attr);\n}\n\nfunction patchProps (domNode, patch, context) {\n  const setProps = patch.props.set;\n  const removeProps = patch.props.remove;\n  for (let p in setProps) {\n    if (setProps.hasOwnProperty(p)) {\n      // 检查是否指令属性\n      if (isAttrDirective(p)) {\n        // 处理指令\n        if (/^n-/.test(p)) {\n          handleDirective(p.slice(2), setProps[p], domNode, context);\n        } else if (/^:/.test(p)) {\n          handleDirective(p.slice(1), setProps[p], domNode, context);\n        } else {\n          const eventName = p.slice(1);\n          const exp = setProps[p];\n          // detachEvent(domNode, eventName); // @TODO 需要解除绑定原有的事件?\n          bindEvent(eventName, exp, domNode, context);\n        }\n      } else { // 普通属性\n        if (typeof patch.props[p] === 'undefined') {\n          removeAttr(domNode, p);\n        } else {\n          setAttr(domNode, p, patch.props[p]);\n        }\n      }\n    }\n  }\n  // @TODO remove 错误\n  for (let p in removeProps) {\n    if (removeProps.hasOwnProperty(p)) {\n      if (isAttrDirective(p)) {\n        if (/^n-/.test(p)) {\n        } else if (/^:/.test(p)) {\n          handleDirectiveRemove(p.slice(1), removeProps[p], domNode, context);\n        } else {\n        }\n      }\n    }\n  }\n}\n","import { isVNode, isVText, isVComponent } from './utils';\nimport { isArray, isPlainObject } from '../utils';\nimport listDiff from './list-diff';\nimport { PATCH } from './patch';\n\n// 快速比较两个对象是否“相等”\nfunction objectEquals (a, b) {\n  return JSON.stringify(a) === JSON.stringify(b);\n}\n\nfunction diffProps (oldTree, newTree) {\n  let oldTreeProps = oldTree.props;\n  let newTreeProps = newTree.props;\n  let setPropsPatches = {}, removePropsPatches = {}, hasPatch = false;\n  for (let p in oldTreeProps) {\n    if (!newTreeProps.hasOwnProperty(p) || typeof newTreeProps[p] === 'undefined') { // 属性被移除\n      hasPatch = true;\n      removePropsPatches[p] = oldTreeProps[p];\n    } else if (isPlainObject(newTreeProps[p])) {\n      if (!objectEquals(newTreeProps[p], oldTreeProps[p])) {\n        hasPatch = true;\n        setPropsPatches[p] = newTreeProps[p];\n      }\n    } else if (newTreeProps[p] !== oldTreeProps[p]) {\n      hasPatch = true;\n      setPropsPatches[p] = newTreeProps[p];\n    } else if (p === 'n-model') {\n      hasPatch = true;\n      setPropsPatches[p] = newTreeProps[p];\n    }\n  }\n  // 检查新属性\n  for (let p in newTree) {\n    if (newTree.hasOwnProperty(p) && !oldTree.hasOwnProperty(p)) {\n      hasPatch = true;\n      setPropsPatches[p] = newTreeProps[p];\n    }\n  }\n  if (!hasPatch) {\n    return null;\n  }\n  return {\n    set: setPropsPatches,\n    remove: removePropsPatches\n  };\n}\n\n// 按照先删除后插入的顺序\nfunction diffChildren (pChildren, nChildren, parentIndex, patches, parentPatches) {\n  const diffs = listDiff(pChildren, nChildren);\n  const orderedList = diffs.list;\n\n  const pLen = pChildren.length;\n  const oLen = orderedList.length;\n  const len = pLen > oLen ? pLen : oLen; // const len = max(pLen, oLen);\n\n  let currentIndex = parentIndex;\n  for (let i = 0; i < len; ++i) {\n    const pNode = pChildren[i];\n    const nNode = orderedList[i];\n    currentIndex = currentIndex + 1;\n    if (!pNode) {\n      if (nNode) { // 旧的没有新的有，插入（末尾）\n        parentPatches.push({\n          type: PATCH.INSERT,\n          node: nNode\n        });\n      }\n    } else {\n      diffWalk(pNode, nNode, currentIndex, patches);\n    }\n    if (pNode && pNode.count) {\n      currentIndex += pNode.count;\n    }\n  }\n  if (diffs.moves) {\n    parentPatches.push({\n      type: PATCH.REORDER,\n      moves: diffs.moves\n    });\n  }\n}\n\nfunction diffWalk (pVdom, nVdom, currentIndex, patches) {\n  let currentPatches = []; // 当前层级的 patch\n  if (nVdom == null) { // * VS null|undefined\n    currentPatches.push({\n      type: PATCH.REMOVE,\n      from: currentIndex,\n      node: pVdom,\n      key: null\n    });\n  } else if (isVComponent(pVdom) && isVComponent(nVdom)) { // Component VS Component\n    currentPatches.push({\n      type: PATCH.COMPONENT,\n      pVdom: pVdom,\n      nVdom: nVdom\n    });\n  } else if (isVNode(pVdom) && isVNode(nVdom)) { // VNode VS VNode\n    if (pVdom.tagName !== nVdom.tagName || pVdom.key !== nVdom.key) { // 不同 tagName/key 节点: 替换\n      currentPatches.push({\n        type: PATCH.REPLACE,\n        node: nVdom\n      });\n    } else { // 同 key 同 tagName 节点: 比较属性和子节点\n      const propsPatches = diffProps(pVdom, nVdom);\n      if (propsPatches) {\n        currentPatches.push({\n          type: PATCH.PROPS,\n          props: propsPatches\n        });\n      }\n      // 继续 diff 子节点\n      diffChildren(pVdom.children, nVdom.children, currentIndex, patches, currentPatches);\n    }\n  } else if (isVText(pVdom) && isVText(nVdom)) { // VText VS VText\n    if (pVdom.data !== nVdom.data) { // 内容不一样的时候才替换（只替换内容即可）\n      currentPatches.push({type: PATCH.TEXT, data: nVdom.data});\n    }\n  } else { // 不同类型的节点\n    currentPatches.push({\n      type: PATCH.REPLACE,\n      node: nVdom,\n      preNode: pVdom\n    });\n  }\n  if (currentPatches.length > 0) {\n    patches[currentIndex] = currentPatches;\n  }\n}\n\nexport function diff (pVdom, nVdom) {\n  const patch = {};\n  patch.pVdom = pVdom;\n  const patches = {};\n  diffWalk(pVdom, nVdom, 0, patches);\n  patch.patches = patches;\n  return patch;\n}\n","import { isArray } from '../utils';\n\nexport function addHook (hookName, callback) {\n  let callbacks = this._hooks[hookName];\n  if (!callbacks) {\n    callbacks = [];\n  }\n  if (isArray(callback)) {\n    callbacks = callbacks.concat(callback);\n  } else {\n    callbacks.push(callback);\n  }\n  this._hooks[hookName] = callbacks;\n}\n\nexport function removeHook (hookName, callback) {\n  const callbacks = this._hooks[hookName];\n  if (!callbacks || callbacks.length === 0) {\n    return this;\n  }\n  if (!callback) {\n    callbacks.splice(0, callbacks.length);\n  } else {\n    for (let i = 0; i < callbacks.length; ++i) {\n      if (callbacks[i] === callback) {\n        callbacks.splice(i, 1);\n        break;\n      }\n    }\n  }\n  return this;\n}\n\nexport function callHooks (hookName) {\n  const _callbacks = this._hooks[hookName] || [];\n  for (let i = 0; i < _callbacks.length; ++i) {\n    _callbacks[i].call(this);\n  }\n}\n","import { getElement, appendChild, replaceNode, removeNode } from './dom';\nimport { diff } from './vdom/diff';\nimport { applyPatch } from './vdom/patch';\nimport h from './vdom/h';\nimport { warn, extend, isFunction, isPlainObject, toArray, isArray } from './utils';\nimport { addHook, removeHook, callHooks } from './api/hooks';\nimport { NaiveException } from './exception';\n\nlet componentId = 1;\n\n// 因为是在应用内生成的组件，所以不需要用 uuid 算法，只需要保证在应用内唯一即可\nfunction uuid() {\n  return '$naive-component-' + componentId++ + new Date().getTime();\n}\n\nfunction emptyRender () {\n  return null;\n}\n\nexport default function Naive (options) {\n  options = options || {};\n  this.name = options.name || '';\n  this.key = options.key || uuid();\n  this._hooks = {};\n  if ('state' in options) {\n    if (!isFunction(options.state)) {\n      throw new NaiveException('state 必须是 [Function]');\n    }\n    const _state = options.state();\n    if (isPlainObject(_state)) {\n      this.state = _state;\n    } else {\n      throw new NaiveException('state 必须返回 [Plain Object]');\n    }\n  } else {\n    this.state = {};\n  }\n  this.props = {};\n  const combineProps = {};\n  // 合并 state 和 options.props\n  if (options.props) {\n    for (let p in options.props) {\n      if (options.props.hasOwnProperty(p)) {\n        this.props[p] = options.props[p];\n        if (/^:/.test(p)) {\n          combineProps[p.slice(1)] = options.props[p];\n        } else {\n          combineProps[p] = String(options.props[p]);\n        }\n      }\n    }\n  }\n  extend(this.state, combineProps);\n  const context = this;\n  const _vdomRender = options.render || emptyRender;\n  const _templateHelpers = {\n    \"if\": function (condition, options) {\n      condition = !!condition;\n      return condition ? h(options) : condition;\n    },\n    \"each\": function (list, createItem) {\n      const nodes = [];\n      if (isArray(list)) {\n        for (let i = 0; i < list.length; ++i) {\n          const item = list[i];\n          const key = isPlainObject(item) && 'id' in item ? item['id'] : i;\n          nodes.push(h(createItem.call(context, item, i, key)));\n        }\n      } else {\n        for (let p in list) {\n          if (list.hasOwnProperty(p)) {\n            const item = list[p];\n            const key = isPlainObject(item) && 'id' in item ? item['id'] : p;\n            nodes.push(h(createItem.call(context, item, p, key)));\n          }\n        }\n      }\n      return nodes;\n    }\n  };\n  this.vdomRender = function vdomRender () {\n    const vdom = _vdomRender.call(\n      this,\n      function createVdom () {\n        return h.apply(context, toArray(arguments));\n      },\n      _templateHelpers\n    );\n    return vdom;\n  };\n  this.$root = null; // 第一次 render 之后才会生成 $root\n  this.components = {}; // 组件描述对象列表\n  this._components = {}; // 组件实例映射\n  const componentsOptions = options.components || {};\n  for (let p in componentsOptions) {\n    if (componentsOptions.hasOwnProperty(p)) {\n      const componentDefine = componentsOptions[p] || {};\n      componentDefine.name = componentDefine.name || p;\n      componentDefine.parent = this;\n      this.components[p] = createComponentCreator(this, componentDefine);\n    }\n  }\n  this.parent = options.parent || null;\n  this._init(options);\n  this._callHooks('created');\n}\n\nfunction createComponentCreator (context, componentDefine) {\n  return function createComponent(props, children, key) {\n    if (!key || !context._components[key]) {\n      const options = extend({}, componentDefine, {props: props, key: key});\n      const newChild = new Naive(options);\n      context._components[key] = newChild;\n    } else {\n      updateProps(context._components[key], props);\n    }\n    return context._components[key];\n  };\n}\n\nconst prtt = Naive.prototype;\n\nprtt.render = function render () {\n  this.$root = this.vdom.render(this);\n  return this.$root;\n};\n\nprtt.setState = function setState (state) {\n  extend(this.state, state);\n  this.update(); // @TODO nextTick 的时候再 update\n  return this;\n};\n\n// 更新视图\nprtt.update = function update () {\n  if (!this.$root) {\n    return this;\n  }\n  const preVdom = this.vdom;\n  this.vdom = this.vdomRender();\n  // console.log(preVdom, this.vdom);\n  const patches = diff(preVdom, this.vdom);\n  // console.log(patches);\n  if (patches) {\n    applyPatch(this, this.$root, patches);\n  } else {\n    warn('不需要更新视图');\n  }\n  this._callHooks('updated');\n  return this;\n};\n\nfunction updateProps (component, props) {\n  const combineProps = {};\n  if (props) {\n    for (let p in props) {\n      if (props.hasOwnProperty(p)) {\n        component.props[p] = props[p];\n        if (/^:/.test(p)) {\n          combineProps[p.slice(1)] = props[p];\n        } else {\n          combineProps[p] = String(props[p]);\n        }\n      }\n    }\n  }\n  extend(component.state, combineProps);\n};\n\nprtt._init = function _init (options) {\n  const methods = options.methods || {};\n  // 将 methods 移到 this\n  for (let m in methods) {\n    if (methods.hasOwnProperty(m)) {\n      if (this.hasOwnProperty(m)) {\n        warn(`属性 \"${m}\" 已存在`);\n      } else {\n        this[m] = methods[m];\n      }\n    }\n  }\n  const hooks = options.hooks || {};\n  for (let p in hooks) {\n    if (hooks.hasOwnProperty(p)) {\n      this._addHook(p, hooks[p]);\n    }\n  }\n  if (options.init) {\n    options.init.call(this);\n  }\n  this.vdom = this.vdomRender();\n};\n\nprtt.mount = function mount (selector) {\n  const mountPoint = typeof selector === 'string' ? getElement(selector) : selector;\n  if (!mountPoint) {\n    throw new NaiveException('找不到挂载节点');\n  }\n  if (this.$root) {\n    replaceNode(this.$root, mountPoint);\n  } else {\n    replaceNode(this.render(), mountPoint);\n  }\n  this._callHooks('mounted');\n};\n\nprtt.unmount = function unmount () {\n  if (!this.$root) {\n    return this;\n  }\n  removeNode(this.$root);\n  this._callHooks('unmounted');\n};\n\nprtt._callHooks = callHooks;\n\nprtt._addHook = addHook;\n\nprtt._removeHook = removeHook;\n\n// 销毁组件\nprtt.destroy = function destroy () {\n  // 销毁事件监听\n  // 调用 destroy 勾子\n  this._callHooks('destroy');\n  // 销毁勾子回调\n  for (let p in this._hooks) {\n    if (this._hooks.hasOwnProperty(p)) {\n      this._removeHook(p);\n    }\n  }\n};\n"],"names":["warn","message","window","console","isArray","Array","obj","Object","prototype","toString","call","toArray","slice","isUndefined","extend","dest","sources","arguments","length","current","shift","p","isFunction","isPlainObject","getElement","selector","query","createElement","tag","document","createTextNode","text","context","querySelector","removeNode","node","parentNode","removeChild","replaceNode","newNode","replaceChild","appendChild","el","target","setAttr","attr","value","setAttribute","removeAttr","name","removeAttribute","supportClassList","classList","hasClass","element","classes","split","filter","s","contains","i","tmp","className","indexOf","addClass","add","apply","forEach","c","replace","removeClass","remove","RegExp","VText","data","render","renderVTextToTextNode","klass","setValue","join","hasOwnProperty","show","style","display","Cache","limit","size","head","tail","undefined","_keymap","create","put","key","removed","entry","get","newer","older","returnEntry","pathCache","restoreRE","saved","restore","str","parsePath","path","hit","parts","props","match1","test","match2","Error","_props","j","push","_prop","getObjectFromPath","result","setObjectFromPath","parent","model","currentValue","state","type","checked","tagName","multiple","options","selected","attachEvent","eventName","handler","addEventListener","handleDirective","directive","bindDirective","handleChange","event","selectValue","currentTarget","currentState","setState","preValue","splice","handleInput","newValue","removeClassAttr","removeValue","handleDirectiveRemove","NaiveException","h","children","components","isVNode","isVText","isVComponent","VNode","attrs","list","String","childNodes","child","concat","count","matchExpression","exp","match","parseArgumentList","needSeparate","inSingle","single","inDouble","double","inWord","word","args","t","parseExpression","Number","bindEvent","handlerFunc","matches","methodName","evt","_args","renderVNodeToElement","nodeContext","_callHooks","Naive","keyIndex","keys","free","item","itemKey","arr","index","reorder","pList","nList","nListIndex","nKeys","nFree","pListIndex","pKeys","pFree","rList","freeIndex","freeCount","deletedItems","pItem","itemIndex","lastFreeIndex","nItem","simulateList","simulateIndex","removes","inserts","simulateItem","k","wantedItem","to","domIndex","domTree","vdomTree","indices","mapping","recurse","rootNode","rootIndex","indexInRange","currentIndex","vChild","nextIndex","min","max","PATCH","ascending","a","b","doApplyPatches","domNode","patches","patch","REPLACE","PROPS","TEXT","REORDER","moves","INSERT","childComponent","$root","update","REMOVE","unmount","COMPONENT","pVdom","nVdom","mount","applyPatch","sort","domMapping","idx","patchReorder","keyMap","toRemove","from","insert","toInsert","insertBefore","isAttrDirective","patchProps","setProps","set","removeProps","objectEquals","JSON","stringify","diffProps","oldTree","newTree","oldTreeProps","newTreeProps","setPropsPatches","removePropsPatches","hasPatch","diffChildren","pChildren","nChildren","parentIndex","parentPatches","diffs","listDiff","orderedList","pLen","oLen","len","pNode","nNode","diffWalk","currentPatches","propsPatches","diff","addHook","hookName","callback","callbacks","_hooks","removeHook","callHooks","_callbacks","componentId","uuid","Date","getTime","emptyRender","_state","combineProps","_vdomRender","_templateHelpers","condition","createItem","nodes","vdomRender","vdom","createVdom","_components","componentsOptions","componentDefine","createComponentCreator","_init","createComponent","newChild","prtt","preVdom","updateProps","component","methods","m","hooks","_addHook","init","mountPoint","_removeHook","destroy"],"mappings":";;;;;;;;;AAAO,SAASA,IAAT,CAAeC,OAAf,EAAwB;MACzBC,OAAOC,OAAX,EAAoB;YACVH,IAAR,iBAA2BC,OAA3B;;;;AAIJ,AAAO;;AAMP,AAAO,IAAMG,UAAUC,MAAMD,OAAN,GAAgBC,MAAMD,OAAtB,GAAgC,SAASA,OAAT,CAAkBE,GAAlB,EAAuB;SACrEC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,GAA/B,MAAwC,gBAA/C;CADK;;AAIP,AAAO,SAASK,UAAT,CAAkBL,GAAlB,EAAuB;SACrBD,MAAMG,SAAN,CAAgBI,KAAhB,CAAsBF,IAAtB,CAA2BJ,GAA3B,EAAgC,CAAhC,CAAP;;;AAGF,AAAO,SAASO,WAAT,CAAsBP,GAAtB,EAA2B;SACzB,OAAOA,GAAP,KAAe,WAAtB;;;AAGF,AAAO;;AAEP,AAAO,SAASQ,MAAT,CAAgBC,IAAhB,EAAsB;MACvB,QAAOA,IAAP,yCAAOA,IAAP,OAAgB,QAAhB,IAA4B,CAACA,IAAjC,EAAuC;WAC9BA,IAAP;;MAEIC,UAAUX,MAAMG,SAAN,CAAgBI,KAAhB,CAAsBF,IAAtB,CAA2BO,SAA3B,EAAsC,CAAtC,CAAhB;SACOD,QAAQE,MAAf,EAAuB;QACfC,UAAUH,QAAQI,KAAR,EAAhB;SACK,IAAIC,CAAT,IAAcF,OAAd,EAAuB;WAChBE,CAAL,IAAUF,QAAQE,CAAR,CAAV;;;SAGGN,IAAP;;;AAGF,AAAO;;AAIP,AAAO,SAASO,UAAT,CAAqBhB,GAArB,EAA0B;SACxB,OAAOA,GAAP,KAAe,UAAtB;;;AAGF,AAAO,SAASiB,aAAT,CAAwBjB,GAAxB,EAA6B;SAC3BA,OAAO,IAAP,IAAe,QAAOA,GAAP,yCAAOA,GAAP,OAAe,QAA9B,IAA0C,CAACF,QAAQE,GAAR,CAA3C,IAA2DC,OAAOC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,GAA/B,MAAwC,iBAA1G;;;AAGF,AAAO;;AAIP,AACA,AAAO;;ACvDP;;;;;;;AAOA,AAAO,SAASkB,UAAT,CAAoBC,QAApB,EAA8B;SAC5B,OAAOA,QAAP,KAAoB,QAApB,GAA+BC,MAAMD,QAAN,CAA/B,GAAiDA,QAAxD;;;AAGF,AAAO,SAASE,aAAT,CAAuBC,GAAvB,EAA4B;SAC1BC,SAASF,aAAT,CAAuBC,GAAvB,CAAP;;;AAGF,AAAO,SAASE,cAAT,CAAyBC,IAAzB,EAA+B;SAC7BF,SAASC,cAAT,CAAwBC,IAAxB,CAAP;;;AAGF,AAAO;;AAIP,AAAO,SAASL,KAAT,CAAeD,QAAf,EAAyBO,OAAzB,EAAkC;YAC7BA,WAAWH,QAArB;SACOG,QAAQC,aAAR,CAAsBR,QAAtB,CAAP;;;;;;AAMF,AAAO;;AAKP,AAAO,SAASS,UAAT,CAAoBC,IAApB,EAA0B;MACzBC,aAAaD,OAAOA,KAAKC,UAAZ,GAAyB,IAA5C;MACIA,UAAJ,EAAgB;eACHC,WAAX,CAAuBF,IAAvB;;;;AAIJ,AAAO;;AAMP,AAAO;;AAIP,AAAO,SAASG,WAAT,CAAqBC,OAArB,EAA8BJ,IAA9B,EAAoC;OACpCC,UAAL,CAAgBI,YAAhB,CAA6BD,OAA7B,EAAsCJ,IAAtC;;;AAGF,AAAO;;AAQP,AAAO,SAASM,WAAT,CAAsBC,EAAtB,EAA0BC,MAA1B,EAAkC;SAChCF,WAAP,CAAmBC,EAAnB;;;AAGF,AAAO,SAASE,OAAT,CAAkBT,IAAlB,EAAwBU,IAAxB,EAA8BC,KAA9B,EAAqC;OACrCC,YAAL,CAAkBF,IAAlB,EAAwBC,KAAxB;;;AAGF,AAAO;;AAIP,AAAO,SAASE,UAAT,CAAoBb,IAApB,EAA0Bc,IAA1B,EAAgC;OAChCC,eAAL,CAAqBD,IAArB;;;AAGF,AAAO;;AAOP,AAEA,IAAME,mBAAmB,CAACtC,YAAYgB,SAASF,aAAT,CAAuB,KAAvB,EAA8ByB,SAA1C,CAA1B;;AAEA,AAEWzC,AAOX,AAAO,IAAI0C,WAAWF,mBACpB,UAASG,OAAT,EAAkBC,OAAlB,EAA2B;YACfA,QAAQC,KAAR,CAAc,KAAd,EAAqBC,MAArB,CAA4B;WAAKC,CAAL;GAA5B,CAAV;MACIC,WAAW,IAAf;OACK,IAAIC,IAAI,CAAb,EAAgBA,IAAIL,QAAQrC,MAA5B,EAAoC,EAAE0C,CAAtC,EAAyC;QACnC,CAACN,QAAQF,SAAR,CAAkBO,QAAlB,CAA2BJ,QAAQK,CAAR,CAA3B,CAAL,EAA6C;iBAChC,KAAX;;;;SAIGD,QAAP;CAVkB,GAapB,UAASL,OAAT,EAAkBC,OAAlB,EAA2B;YACfA,QAAQC,KAAR,CAAc,KAAd,EAAqBC,MAArB,CAA4B;WAAKC,CAAL;GAA5B,CAAV;MACIC,WAAW,IAAf;MAAqBE,MAAMP,QAAQQ,SAAnC;OACK,IAAIF,IAAI,CAAb,EAAgBA,IAAIL,QAAQrC,MAA5B,EAAoC,EAAE0C,CAAtC,EAAyC;QACnCC,IAAIE,OAAJ,CAAYR,QAAQK,CAAR,CAAZ,MAA4B,CAAC,CAAjC,EAAoC;iBACvB,KAAX;;;;SAIGD,QAAP;CAtBG;;AAyBP,AAAO,IAAIK,WAAWb,mBACpB,UAASG,OAAT,EAAkBC,OAAlB,EAA2B;YACfA,QAAQC,KAAR,CAAc,KAAd,EAAqBC,MAArB,CAA4B;WAAKC,CAAL;GAA5B,CAAV;UACQN,SAAR,CAAkBa,GAAlB,CAAsBC,KAAtB,CAA4BZ,QAAQF,SAApC,EAA+CG,OAA/C;SACOD,OAAP;CAJkB,GAOpB,UAASA,OAAT,EAAkBC,OAAlB,EAA2B;MACrBM,MAAMP,QAAQQ,SAAlB;YACUP,QAAQC,KAAR,CAAc,KAAd,EAAqBC,MAArB,CAA4B;WAAKC,CAAL;GAA5B,CAAV;UACQS,OAAR,CAAgB,aAAK;QACf,CAACd,SAASC,OAAT,EAAkBc,CAAlB,CAAL,EAA2B;YACnBP,IAAIQ,OAAJ,CAAY,OAAZ,EAAqB,MAAMd,OAA3B,CAAN;;GAFJ;UAKQO,SAAR,GAAoBD,GAApB;SACOP,OAAP;CAhBG;;AAmBP,AAAO,IAAIgB,cAAcnB,mBACvB,UAASG,OAAT,EAAkBC,OAAlB,EAA2B;YACfA,QAAQC,KAAR,CAAc,KAAd,EAAqBC,MAArB,CAA4B;WAAKC,CAAL;GAA5B,CAAV;UACQN,SAAR,CAAkBmB,MAAlB,CAAyBL,KAAzB,CAA+BZ,QAAQF,SAAvC,EAAkDG,OAAlD;SACOD,OAAP;CAJqB,GAOvB,UAASA,OAAT,EAAkBC,OAAlB,EAA2B;MACrBM,MAAMP,QAAQQ,SAAlB;YACUP,QAAQC,KAAR,CAAc,KAAd,EAAqBC,MAArB,CAA4B;WAAKC,CAAL;GAA5B,CAAV;UACQS,OAAR,CAAgB,aAAK;QACfd,SAASC,OAAT,EAAkBc,CAAlB,CAAJ,EAA0B;YAClBP,IAAIQ,OAAJ,CAAY,IAAIG,MAAJ,CAAWJ,CAAX,EAAc,GAAd,CAAZ,EAAgC,EAAhC,CAAN;;GAFJ;UAKQN,SAAR,GAAoBD,GAApB;SACOP,OAAP;CAhBG,CAmBP,AAAO;;ACpKP;AACA,AAAe,SAASmB,KAAT,CAAgB1C,IAAhB,EAAsB;OAC9B2C,IAAL,GAAY3C,IAAZ;;;AAGF0C,MAAMjE,SAAN,CAAgBmE,MAAhB,GAAyB,SAASC,qBAAT,GAAkC;SAClD9C,eAAe,KAAK4C,IAApB,CAAP;CADF;;ACJe,SAASG,KAAT,CAAgBC,QAAhB,EAA0BxB,OAA1B,EAAmCtB,OAAnC,EAA4C;MACrD,OAAO8C,QAAP,KAAoB,QAAxB,EAAkC;YACxBxB,OAAR,EAAiB,OAAjB,EAA0BwB,QAA1B;GADF,MAEO,IAAI1E,QAAQ0E,QAAR,CAAJ,EAAuB;YACpBxB,OAAR,EAAiB,OAAjB,EAA0BwB,SAASC,IAAT,CAAc,GAAd,CAA1B;GADK,MAEA;SACA,IAAIX,CAAT,IAAcU,QAAd,EAAwB;UAClBA,SAASE,cAAT,CAAwBZ,CAAxB,CAAJ,EAAgC;YAC1BU,SAASV,CAAT,CAAJ,EAAiB;mBACNd,OAAT,EAAkBc,CAAlB;SADF,MAEO;sBACOd,OAAZ,EAAqBc,CAArB;;;;;;;ACdK,SAASa,IAAT,CAAenC,KAAf,EAAsBQ,OAAtB,EAA+BtB,OAA/B,EAAwC;UAC7CkD,KAAR,CAAcC,OAAd,GAAwBrC,QAAQ,EAAR,GAAa,MAArC;;;ACDa,SAASoC,KAAT,CAAgBpC,KAAhB,EAAuBQ,OAAvB,EAAgCtB,OAAhC,EAAyC;OACjD,IAAI0B,CAAT,IAAcZ,KAAd,EAAqB;YACXoC,KAAR,CAAcxB,CAAd,IAAmBZ,MAAMY,CAAN,CAAnB;;;;ACFJ;;;;;;;;AAQA,AAAe,SAAS0B,KAAT,CAAgBC,KAAhB,EAAuB;OAC/BC,IAAL,GAAY,CAAZ,CADoC;OAE/BD,KAAL,GAAaA,KAAb,CAFoC;OAG/BE,IAAL,GAAY,KAAKC,IAAL,GAAYC,SAAxB,CAHoC;OAI/BC,OAAL,GAAenF,OAAOoF,MAAP,CAAc,IAAd,CAAf,CAJoC;;;AAOtC,IAAItE,IAAI+D,MAAM5E,SAAd;;;;;;;;;;;;AAYAa,EAAEuE,GAAF,GAAQ,UAAUC,GAAV,EAAe/C,KAAf,EAAsB;MACxBgD,OAAJ;;MAEIC,QAAQ,KAAKC,GAAL,CAASH,GAAT,EAAc,IAAd,CAAZ,CAH4B;MAIxB,CAACE,KAAL,EAAY;QACN,KAAKT,IAAL,KAAc,KAAKD,KAAvB,EAA8B;;gBAClB,KAAKjE,KAAL,EAAV;;YAEM;WACDyE;KADP;SAGKH,OAAL,CAAaG,GAAb,IAAoBE,KAApB;QACI,KAAKP,IAAT,EAAe;WACRA,IAAL,CAAUS,KAAV,GAAkBF,KAAlB;YACMG,KAAN,GAAc,KAAKV,IAAnB;KAFF,MAGO;WACAD,IAAL,GAAYQ,KAAZ;;SAEGP,IAAL,GAAYO,KAAZ,CAdU;SAeLT,IAAL;;QAEIxC,KAAN,GAAcA,KAAd;;SAEOgD,OAAP;CAvBF;;;;;;;AA+BAzE,EAAED,KAAF,GAAU,YAAY;MAChB2E,QAAQ,KAAKR,IAAjB;MACIQ,KAAJ,EAAW;SACJR,IAAL,GAAY,KAAKA,IAAL,CAAUU,KAAtB,CADS;SAEJV,IAAL,CAAUW,KAAV,GAAkBT,SAAlB;UACMQ,KAAN,GAAcF,MAAMG,KAAN,GAAcT,SAA5B;SACKC,OAAL,CAAaK,MAAMF,GAAnB,IAA0BJ,SAA1B;SACKH,IAAL;;SAEKS,KAAP;CATF;;;;;;;;;;;;AAsBA1E,EAAE2E,GAAF,GAAQ,UAAUH,GAAV,EAAeM,WAAf,EAA4B;MAC9BJ,QAAQ,KAAKL,OAAL,CAAaG,GAAb,CAAZ;MACIE,UAAUN,SAAd,EAAyB,OAFS;MAG9BM,UAAU,KAAKP,IAAnB,EAAyB;;WAChBW,cACHJ,KADG,GAEHA,MAAMjD,KAFV;;;;;;MAQEiD,MAAME,KAAV,EAAiB;;QACXF,UAAU,KAAKR,IAAnB,EAAyB;;WAClBA,IAAL,GAAYQ,MAAME,KAAlB,CADuB;;UAGnBA,KAAN,CAAYC,KAAZ,GAAoBH,MAAMG,KAA1B,CAJe;;MAMbH,MAAMG,KAAV,EAAiB;;UACTA,KAAN,CAAYD,KAAZ,GAAoBF,MAAME,KAA1B,CADe;;QAGXA,KAAN,GAAcR,SAAd,CArBkC;QAsB5BS,KAAN,GAAc,KAAKV,IAAnB,CAtBkC;MAuB9B,KAAKA,IAAT,EAAe;SACRA,IAAL,CAAUS,KAAV,GAAkBF,KAAlB,CADa;;OAGVP,IAAL,GAAYO,KAAZ,CA1BkC;SA2B3BI,cACHJ,KADG,GAEHA,MAAMjD,KAFV;CA3BF;;AC7EA,IAAMsD,YAAY,IAAIhB,KAAJ,CAAU,IAAV,CAAlB;;AAEA,AACA,AAEA,AAYA,AAAO;;AAMP,AACA,IAAMiB,YAAY,UAAlB;AACA,AACA,AACA,AAEA,IAAIC,QAAQ,EAAZ;;AAEA,AAQA,AAoBA,SAASC,OAAT,CAAkBC,GAAlB,EAAuB5C,CAAvB,EAA0B;SACjB0C,MAAM1C,CAAN,CAAP;;;;;;;;;AASF,AAAO;;AAaP,AAIA;;;;;;;;;AASA,AAAO;;;;;;;;;;;;;AA2BP,AAAO,SAAS6C,SAAT,CAAmBC,IAAnB,EAAyB;MAC1BC,MAAMP,UAAUJ,GAAV,CAAcU,IAAd,CAAV;MACIC,GAAJ,EAAS;WACAA,GAAP;;;;;;;;;MASEC,QAAQF,KAAKlD,KAAL,CAAW,QAAX,CAAZ;MAAkCI,IAAI,CAAtC;MACIiD,QAAQ,EAAZ;SACOjD,IAAIgD,MAAM1F,MAAjB,EAAyB;QACnB4F,SAAS,uCAAuCC,IAAvC,CAA4CH,MAAMhD,CAAN,CAA5C,CAAb;QACIoD,SAAS,4CAA4CD,IAA5C,CAAiDH,MAAMhD,CAAN,CAAjD,CAAb;QACI,EAAEkD,UAAUE,MAAZ,CAAJ,EAAyB;YACjB,IAAIC,KAAJ,CAAU,aAAaP,IAAvB,CAAN;;QAEEI,MAAJ,EAAY;UACNI,SAASN,MAAMhD,CAAN,EAASJ,KAAT,CAAe,GAAf,CAAb;UAAkC2D,IAAI,CAAtC;aACMA,IAAID,OAAOhG,MAAjB,EAAyB;YACnBgG,OAAOC,CAAP,MAAc,EAAlB,EAAsB;cAChBvD,MAAM,CAAV,EAAa;;;WAAb,MAGO;kBACC,IAAIqD,KAAJ,CAAU,aAAaP,IAAvB,CAAN;;SALJ,MAOO;gBACCU,IAAN,CAAWF,OAAOC,CAAP,CAAX;;;;KAXN,MAeO;;UACD,CAAC,QAAQJ,IAAR,CAAaH,MAAMhD,CAAN,CAAb,CAAL,EAA6B;YACvByD,QAAQT,MAAMhD,CAAN,EAASS,OAAT,CAAiB,wBAAjB,EAA2C,EAA3C,CAAZ;cACM+C,IAAN,CAAWC,KAAX;;;;;YAKIzB,GAAV,CAAcc,IAAd,EAAoBG,KAApB;SACOA,KAAP;;;AAGF,AAAO,SAASS,iBAAT,CAA2B5C,IAA3B,EAAiCgC,IAAjC,EAAuC;MACxCG,QAAQJ,UAAUC,IAAV,CAAZ;MACIa,SAASV,MAAM3F,MAAN,GAAe,CAAf,GAAmBwD,IAAnB,GAA0Be,SAAvC;OACK,IAAI7B,IAAI,CAAb,EAAgBA,IAAIiD,MAAM3F,MAA1B,EAAkC,EAAE0C,CAApC,EAAuC;aAC5B2D,OAAOV,MAAMjD,CAAN,CAAP,CAAT;QACI,CAAC2D,MAAL,EAAa;;;;SAIRA,MAAP;;;AAGF,AAAO,SAASC,iBAAT,CAA2B9C,IAA3B,EAAiCgC,IAAjC,EAAuC5D,KAAvC,EAA8C;MAC/C+D,QAAQJ,UAAUC,IAAV,CAAZ;MACIvF,UAAUuD,IAAd;MAAoB+C,SAAS/C,IAA7B;OACK,IAAId,IAAI,CAAb,EAAgBA,IAAIiD,MAAM3F,MAAN,GAAe,CAAnC,EAAsC,EAAE0C,CAAxC,EAA2C;aAChCzC,OAAT;cACUA,QAAQ0F,MAAMjD,CAAN,CAAR,CAAV;QACI/C,YAAYM,OAAZ,CAAJ,EAA0B;gBACd,EAAV;aACO0F,MAAMjD,CAAN,CAAP,IAAmBzC,OAAnB;;;MAGAyC,KAAK,CAAT,EAAY;QACN,QAAOzC,OAAP,yCAAOA,OAAP,OAAmB,QAAvB,EAAiC;cACxB0F,MAAMjD,CAAN,CAAR,IAAoBd,KAApB;KADD,MAEO;gBACK,EAAV;cACQ+D,MAAMjD,CAAN,CAAR,IAAoBd,KAApB;aACO+D,MAAMjD,IAAE,CAAR,CAAP,IAAqBzC,OAArB;;;;;ACtMS,SAASuG,KAAT,CAAe5E,KAAf,EAAsBQ,OAAtB,EAA+BtB,OAA/B,EAAwC;MAC/C2F,eAAeL,kBAAkBtF,QAAQ4F,KAA1B,EAAiC9E,KAAjC,CAArB;MACIQ,QAAQuE,IAAR,KAAiB,OAArB,EAA8B;YACpBC,OAAR,GAAkBH,iBAAiBrE,QAAQR,KAA3C;GADF,MAEO,IAAIQ,QAAQuE,IAAR,KAAiB,UAArB,EAAiC;QAClCzH,QAAQuH,YAAR,CAAJ,EAA2B;cACjBG,OAAR,GAAkBH,aAAa5D,OAAb,CAAqBT,QAAQR,KAA7B,MAAwC,CAAC,CAA3D;KADF,MAEO;cACGgF,OAAR,GAAkBH,iBAAiBrE,QAAQR,KAA3C;;GAJG,MAMA,IAAIQ,QAAQyE,OAAR,KAAoB,QAAxB,EAAkC;QACnCzE,QAAQ0E,QAAZ,EAAsB;UACdC,UAAU3E,QAAQ2E,OAAxB;WACK,IAAIrE,IAAI,CAAb,EAAgBA,IAAIqE,QAAQ/G,MAA5B,EAAoC,EAAE0C,CAAtC,EAAyC;YACnC+D,aAAa5D,OAAb,CAAqBkE,QAAQrE,CAAR,EAAWd,KAAhC,MAA2C,CAAC,CAAhD,EAAmD;kBACzCc,CAAR,EAAWsE,QAAX,GAAsB,IAAtB;SADF,MAEO;kBACGtE,CAAR,EAAWsE,QAAX,GAAsB,KAAtB;;;KANN,MASO;UACD5E,QAAQR,KAAR,KAAkB6E,YAAtB,EAAoC;gBAC1B7E,KAAR,GAAgB6E,YAAhB;;;GAZC,MAeA;QACDrE,QAAQR,KAAR,KAAkB6E,YAAtB,EAAoC;cAC1B7E,KAAR,GAAgB6E,YAAhB;;;;;AC9BC,SAASQ,WAAT,CAAsBzF,EAAtB,EAA0B0F,SAA1B,EAAqCC,OAArC,EAA8C;MAC/C3F,GAAG4F,gBAAP,EAAyB;OACpBA,gBAAH,CAAoBF,SAApB,EAA+BC,OAA/B,EAAwC,KAAxC;GADF,MAEO,IAAI3F,GAAGyF,WAAP,EAAoB;OACtBA,WAAH,CAAeC,SAAf,EAA0BC,OAA1B;;CAIJ,AAAO;;ACCA,SAASE,eAAT,CAA0BC,SAA1B,EAAqC1F,KAArC,EAA4CQ,OAA5C,EAAqDtB,OAArD,EAA8D;UAC3DwG,SAAR;SACO,MAAL;WACO1F,KAAL,EAAYQ,OAAZ,EAAqBtB,OAArB;;SAEG,OAAL;YACQc,KAAN,EAAaQ,OAAb,EAAsBtB,OAAtB;;SAEG,OAAL;YACQc,KAAN,EAAaQ,OAAb,EAAsBtB,OAAtB;;SAEG,OAAL;YACQc,KAAN,EAAaQ,OAAb,EAAsBtB,OAAtB;;;UAGIwG,cAAc,UAAd,IAA4BA,cAAc,SAA9C,EAAyD;YACnD1F,KAAJ,EAAW;kBACDQ,OAAR,EAAiBkF,SAAjB,EAA4BA,SAA5B;SADF,MAEO;qBACMlF,OAAX,EAAoBkF,SAApB;;OAJJ,MAMO;gBACGlF,OAAR,EAAiBkF,SAAjB,EAA4B1F,KAA5B;;;;;;AAMR,AAAO,SAAS2F,aAAT,CAAwBD,SAAxB,EAAmC1F,KAAnC,EAA0CQ,OAA1C,EAAmDtB,OAAnD,EAA4D;UACzDwG,SAAR;SACO,OAAL;UACMlF,QAAQuE,IAAR,KAAiB,OAArB,EAA8B;oBAChBvE,OAAZ,EAAqB,QAArB,EAA+B,SAASoF,YAAT,CAAsBC,KAAtB,EAA6B;cACpDC,cAAcD,MAAME,aAAN,CAAoB/F,KAAxC;cACMgG,eAAe9G,QAAQ4F,KAA7B;4BACkBkB,YAAlB,EAAgChG,KAAhC,EAAuC8F,WAAvC;kBACQG,QAAR,CAAiBD,YAAjB;SAJF;OADF,MAOO,IAAIxF,QAAQuE,IAAR,KAAiB,UAArB,EAAiC;oBAC1BvE,OAAZ,EAAqB,QAArB,EAA+B,SAASoF,YAAT,GAAwB;cAC/CE,cAAcD,MAAME,aAAN,CAAoB/F,KAAxC;cACMgG,eAAe9G,QAAQ4F,KAA7B;cACMoB,WAAW1B,kBAAkBwB,YAAlB,EAAgChG,KAAhC,CAAjB;cACI6F,MAAME,aAAN,CAAoBf,OAAxB,EAAiC;gBAC3BkB,SAASjF,OAAT,CAAiB6E,WAAjB,MAAkC,CAAC,CAAvC,EAA0C;uBAC/BxB,IAAT,CAAcwB,WAAd;;WAFJ,MAIO;gBACDhF,IAAI,CAAR;mBACMA,IAAIoF,SAAS9H,MAAnB,EAA2B;kBACrB8H,SAASpF,CAAT,MAAgBgF,WAApB,EAAiC;yBACtBK,MAAT,CAAgBrF,CAAhB,EAAmB,CAAnB;;;gBAGAA,CAAF;;;kBAGImF,QAAR,CAAiBD,YAAjB;SAlBF;OADK,MAqBA,IAAIxF,QAAQyE,OAAR,KAAoB,QAAxB,EAAkC;oBAC3BzE,OAAZ,EAAqB,QAArB,EAA+B,SAAS4F,WAAT,GAAwB;;cAE/CJ,eAAe9G,QAAQ4F,KAA7B;cACItE,QAAQ0E,QAAZ,EAAsB;gBACdC,UAAU3E,QAAQ2E,OAAxB;gBACMkB,WAAW,EAAjB;iBACK,IAAIvF,IAAI,CAAb,EAAgBA,IAAIqE,QAAQ/G,MAA5B,EAAoC,EAAE0C,CAAtC,EAAyC;kBACnCqE,QAAQrE,CAAR,EAAWsE,QAAf,EAAyB;yBACdd,IAAT,CAAca,QAAQrE,CAAR,EAAWd,KAAzB;;;8BAGcgG,YAAlB,EAAgChG,KAAhC,EAAuCqG,QAAvC;oBACQJ,QAAR,CAAiBD,YAAjB;WATF,MAUO;8BACaA,YAAlB,EAAgChG,KAAhC,EAAuCQ,QAAQR,KAA/C;oBACQiG,QAAR,CAAiBD,YAAjB;;SAfJ;OADK,MAmBA;oBACOxF,OAAZ,EAAqB,OAArB,EAA8B,SAAS4F,WAAT,GAAwB;;cAE9CJ,eAAe9G,QAAQ4F,KAA7B;4BACkBkB,YAAlB,EAAgChG,KAAhC,EAAuCQ,QAAQR,KAA/C;kBACQiG,QAAR,CAAiBD,YAAjB;SAJF;;;;;;;AAYR,SAASM,eAAT,CAA0BC,WAA1B,EAAuC/F,OAAvC,EAAgDtB,OAAhD,EAAyD;MACnD,OAAOqH,WAAP,KAAuB,QAA3B,EAAqC;gBACvB/F,OAAZ,EAAqB+F,WAArB;GADF,MAEO,IAAIjJ,QAAQiJ,WAAR,CAAJ,EAA0B;gBACnB/F,OAAZ,EAAqB+F,YAAYtE,IAAZ,CAAiB,GAAjB,CAArB;GADK,MAEA;SACA,IAAIX,CAAT,IAAciF,WAAd,EAA2B;UACrBA,YAAYrE,cAAZ,CAA2BZ,CAA3B,CAAJ,EAAmC;oBACrBd,OAAZ,EAAqBc,CAArB;;;;;;AAMR,AAAO,SAASkF,qBAAT,CAAgCd,SAAhC,EAA2C1F,KAA3C,EAAkDQ,OAAlD,EAA2DtB,OAA3D,EAAoE;UACjEwG,SAAR;SACO,OAAL;sBACkB1F,KAAhB,EAAuBQ,OAAvB,EAAgCtB,OAAhC;;;;;ACrHC,SAASuH,cAAT,CAAyBtJ,OAAzB,EAAkC;OAClCgD,IAAL,GAAY,gBAAZ;OACKhD,OAAL,GAAeA,OAAf;;;ACGF;AACA,AAAe,SAASuJ,CAAT,CAAYzB,OAAZ,EAAqBlB,KAArB,EAA4B4C,QAA5B,EAAsC5D,GAAtC,EAA2C;MAClD7D,UAAU,QAAQ,EAAxB;MACM0H,aAAa1H,QAAQ,YAAR,KAAyB,EAA5C;MACI2H,QAAQ5B,OAAR,KAAoB6B,QAAQ7B,OAAR,CAApB,IAAwC8B,aAAa9B,OAAb,CAA5C,EAAmE;WAC1DA,OAAP;GADF,MAEO,IAAIxG,cAAcwG,OAAd,CAAJ,EAA4B;QAC7B2B,WAAW1E,cAAX,CAA0B+C,QAAQA,OAAlC,CAAJ,EAAgD;aACvC2B,WAAW3B,QAAQA,OAAnB,EAA4BA,QAAQlB,KAApC,EAA2CkB,QAAQ0B,QAAnD,EAA6D1B,QAAQlC,GAArE,CAAP;KADF,MAEO;aACE,IAAIiE,KAAJ,CAAU/B,QAAQA,OAAlB,EAA2BA,QAAQgC,KAAnC,EAA0ChC,QAAQ0B,QAAlD,EAA4D1B,QAAQlC,GAApE,CAAP;;GAJG,MAMA,IAAIzF,QAAQ2H,OAAR,CAAJ,EAAsB;QACrBiC,OAAO,EAAb;SACK,IAAIpG,IAAI,CAAb,EAAgBA,IAAImE,QAAQ7G,MAA5B,EAAoC,EAAE0C,CAAtC,EAAyC;WAClCwD,IAAL,CAAUoC,EAAEzB,QAAQnE,CAAR,CAAF,CAAV;;WAEKoG,IAAP;GALK,MAMA,IAAG/I,UAAUC,MAAV,GAAmB,CAAtB,EAAyB;WACvB,IAAIuD,KAAJ,CAAUsD,OAAV,CAAP;GADK,MAEA;QACD2B,WAAW1E,cAAX,CAA0B+C,OAA1B,CAAJ,EAAwC;aAC/B2B,WAAW3B,OAAX,EAAoBlB,KAApB,EAA2B4C,QAA3B,EAAqC5D,GAArC,CAAP;KADF,MAEO;aACE,IAAIiE,KAAJ,CAAU/B,OAAV,EAAmBlB,KAAnB,EAA0B4C,QAA1B,EAAoC5D,GAApC,CAAP;;;;;ACnBS,SAASiE,KAAT,CAAgB/B,OAAhB,EAAyBlB,KAAzB,EAAgC4C,QAAhC,EAA0C5D,GAA1C,EAA+C;OACvDkC,OAAL,GAAeA,OAAf;OACKlB,KAAL,GAAaA,SAAS,EAAtB;OACKhB,GAAL,GAAWA,MAAMoE,OAAOpE,GAAP,CAAN,GAAoBJ,SAA/B,CAH4D;MAIxDyE,aAAa,EAAjB;aACWT,YAAY,EAAvB;OACK,IAAI7F,IAAI,CAAb,EAAgBA,IAAI6F,SAASvI,MAA7B,EAAqC,EAAE0C,CAAvC,EAA0C;QAClCuG,QAAQV,SAAS7F,CAAT,CAAd;QACIxD,QAAQ+J,KAAR,CAAJ,EAAoB;mBACLD,WAAWE,MAAX,CAAkBZ,EAAE9I,IAAF,CAAO,IAAP,EAAayJ,KAAb,CAAlB,CAAb;KADF,MAEO;UACDA,KAAJ,EAAW;mBACE/C,IAAX,CAAgBoC,EAAE9I,IAAF,CAAO,IAAP,EAAayJ,KAAb,CAAhB;;;;OAIDV,QAAL,GAAgBS,UAAhB;MACIG,QAAQ,KAAKZ,QAAL,CAAcvI,MAA1B;OACK,IAAI0C,KAAI,CAAb,EAAgBA,KAAI,KAAK6F,QAAL,CAAcvI,MAAlC,EAA0C,EAAE0C,EAA5C,EAA+C;aACpC,KAAK6F,QAAL,CAAc7F,EAAd,EAAiByG,KAAjB,IAA0B,CAAnC;;OAEGA,KAAL,GAAaA,KAAb,CArB4D;;;AAwB9D,AAKA,AAKA;AACA,SAASC,eAAT,CAA0BC,GAA1B,EAA+B;SACtBA,IAAIC,KAAJ,CAAU,cAAV,CAAP;;;AAGF,SAASC,iBAAT,CAA4BF,GAA5B,EAAiC;MAC3B3G,IAAI,CAAR;MACI8G,eAAe,KAAnB;MACIC,WAAW,KAAf;MACIC,SAAS,EAAb;MACIC,WAAW,KAAf;MACIC,SAAS,EAAb;MACIC,SAAS,KAAb;MACIC,OAAO,EAAX;MACIC,OAAO,EAAX;SACOrH,IAAI2G,IAAIrJ,MAAf,EAAuB;QACfgK,IAAIX,IAAI3G,CAAJ,CAAV;QACIsH,MAAM,IAAV,EAAgB;UACVP,QAAJ,EAAc;aACPvD,IAAL,CAAU;gBACF,QADE;iBAEDwD,OAAO7F,IAAP,CAAY,EAAZ;SAFT;eAIOkE,MAAP,CAAc,CAAd;mBACW,KAAX;uBACe,IAAf;OAPF,MAQO,IAAI4B,QAAJ,EAAc;eACZzD,IAAP,CAAY8D,CAAZ;OADK,MAEA,IAAIH,MAAJ,EAAY;cACX,IAAIxB,cAAJ,CAAmB,MAAnB,CAAN;OADK,MAEA,IAAImB,YAAJ,EAAkB;cACjB,IAAInB,cAAJ,CAAmB,MAAnB,CAAN;OADK,MAEA;mBACM,IAAX;;KAhBJ,MAkBO,IAAI2B,MAAM,GAAV,EAAe;UAChBL,QAAJ,EAAc;aACPzD,IAAL,CAAU;gBACF,QADE;iBAED0D,OAAO/F,IAAP,CAAY,EAAZ;SAFT;eAIOkE,MAAP,CAAc,CAAd;mBACW,KAAX;uBACe,IAAf;OAPF,MAQO,IAAI0B,QAAJ,EAAc;eACZvD,IAAP,CAAY8D,CAAZ;OADK,MAEA,IAAIH,MAAJ,EAAY;cACX,IAAIxB,cAAJ,CAAmB,MAAnB,CAAN;OADK,MAEA,IAAImB,YAAJ,EAAkB;cACjB,IAAInB,cAAJ,CAAmB,MAAnB,CAAN;OADK,MAEA;mBACM,IAAX;;KAhBG,MAkBA,IAAI2B,MAAM,GAAV,EAAe;UAChBP,QAAJ,EAAc;eACLvD,IAAP,CAAY8D,CAAZ;OADF,MAEO,IAAIL,QAAJ,EAAc;eACZzD,IAAP,CAAY8D,CAAZ;OADK,MAEA,IAAIH,MAAJ,EAAY;aACZ3D,IAAL,CAAU;gBACF,KADE;iBAED4D,KAAKjG,IAAL,CAAU,EAAV;SAFT;aAIKkE,MAAL,CAAY,CAAZ;iBACS,KAAT;uBACe,KAAf;OAPK,MAQA,IAAI,CAACyB,YAAL,EAAmB;cAClB,IAAInB,cAAJ,CAAmB,MAAnB,CAAN;OADK,MAEA;uBACU,KAAf;;KAhBG,MAkBA,IAAI2B,MAAM,GAAV,EAAe;UAChBP,QAAJ,EAAc;eACLvD,IAAP,CAAY8D,CAAZ;OADF,MAEO,IAAIL,QAAJ,EAAc;eACZzD,IAAP,CAAY8D,CAAZ;OADK,MAEA,IAAIH,MAAJ,EAAY;cACX,IAAIxB,cAAJ,CAAmB,MAAnB,CAAN;;KANG,MAQA;UACDoB,QAAJ,EAAc;eACLvD,IAAP,CAAY8D,CAAZ;OADF,MAEO,IAAIL,QAAJ,EAAc;eACZzD,IAAP,CAAY8D,CAAZ;OADK,MAEA,IAAIH,MAAJ,EAAY;aACZ3D,IAAL,CAAU8D,CAAV;OADK,MAEA;YACDR,YAAJ,EAAkB;gBACV,IAAInB,cAAJ,CAAmB,MAAnB,CAAN;SADF,MAEO;eACAnC,IAAL,CAAU8D,CAAV;mBACS,IAAT;;;;MAIJtH,CAAF;;MAEE+G,YAAYE,QAAhB,EAA0B;UAClB,IAAItB,cAAJ,CAAmB,MAAnB,CAAN;GADF,MAEO,IAAIwB,MAAJ,EAAY;SACZ3D,IAAL,CAAU;YACF,KADE;aAED4D,KAAKjG,IAAL,CAAU,EAAV;KAFT;;SAKKkG,IAAP;;;AAGF,SAASE,kBAAT,CAA0BZ,GAA1B,EAA+B7F,IAA/B,EAAqC;MAC/B,oBAAoBqC,IAApB,CAAyBwD,GAAzB,CAAJ,EAAmC;WAC1Ba,OAAOb,GAAP,CAAP;GADF,MAEO;WACEjD,kBAAkB5C,IAAlB,EAAwB6F,GAAxB,CAAP;;;;AAIJ,AAAO,SAASc,SAAT,CAAoBjD,SAApB,EAA+BmC,GAA/B,EAAoCjH,OAApC,EAA6CtB,OAA7C,EAAsD;MACvDsJ,oBAAJ;MACIhK,WAAWiJ,GAAX,CAAJ,EAAqB;kBACLA,GAAd;GADF,MAEO;;UACCgB,UAAUjB,gBAAgBC,GAAhB,CAAhB;UACIgB,OAAJ,EAAa;;cACLC,aAAaD,QAAQ,CAAR,CAAnB;wBACc,qBAAUE,GAAV,EAAe;gBACrBR,OAAOR,kBAAkBc,QAAQ,CAAR,CAAlB,CAAb;gBACMG,QAAQ,EAAd;iBACK,IAAI9H,IAAI,CAAb,EAAgBA,IAAIqH,KAAK/J,MAAzB,EAAiC,EAAE0C,CAAnC,EAAsC;kBAChCqH,KAAKrH,CAAL,EAAQiE,IAAR,KAAiB,QAArB,EAA+B;sBACvBT,IAAN,CAAW6D,KAAKrH,CAAL,EAAQd,KAAnB;eADF,MAEO,IAAImI,KAAKrH,CAAL,EAAQd,KAAR,KAAkB,QAAtB,EAAgC;sBAC/BsE,IAAN,CAAWqE,GAAX;eADK,MAEA;sBACCrE,IAAN,CAAW+D,mBAAgBF,KAAKrH,CAAL,EAAQd,KAAxB,EAA+B,KAAK8E,KAApC,CAAX;;;iBAGC4D,UAAL,EAAiBtH,KAAjB,CAAuB,IAAvB,EAA6BwH,KAA7B;WAZF;;OAFF,MAgBO;sBACS1J,QAAQuI,GAAR,CAAd;;;;cAGQjH,OAAZ,EAAqB8E,SAArB,EAAgC,SAASC,OAAT,CAAiBoD,GAAjB,EAAsB;WAC7CH,YAAY5K,IAAZ,CAAiBsB,OAAjB,EAA0ByJ,GAA1B,CAAP;GADF;;;AAKF3B,MAAMtJ,SAAN,CAAgBmE,MAAhB,GAAyB,SAASgH,oBAAT,CAA8B3J,OAA9B,EAAuC;MACxDsB,UAAU3B,cAAc,KAAKoG,OAAnB,CAAhB;MACMlB,QAAQ,KAAKA,KAAnB;MACM+E,cAAc,IAApB;OACK,IAAIvK,CAAT,IAAcwF,KAAd,EAAqB;QACfA,MAAM7B,cAAN,CAAqB3D,CAArB,CAAJ,EAA6B;UACvB,MAAM0F,IAAN,CAAW1F,CAAX,CAAJ,EAAmB;sBACHA,EAAET,KAAF,CAAQ,CAAR,CAAd,EAA0BiG,MAAMxF,CAAN,CAA1B,EAAoCiC,OAApC,EAA6CtB,OAA7C;wBACgBX,EAAET,KAAF,CAAQ,CAAR,CAAhB,EAA4BiG,MAAMxF,CAAN,CAA5B,EAAsCiC,OAAtC,EAA+CtB,OAA/C;OAFF,MAGO,IAAI,KAAK+E,IAAL,CAAU1F,CAAV,CAAJ,EAAkB;wBACPA,EAAET,KAAF,CAAQ,CAAR,CAAhB,EAA4BiG,MAAMxF,CAAN,CAA5B,EAAsCiC,OAAtC,EAA+CtB,OAA/C;OADK,MAEA,IAAI,KAAK+E,IAAL,CAAU1F,CAAV,CAAJ,EAAkB;YACjB+G,YAAY/G,EAAET,KAAF,CAAQ,CAAR,CAAlB;YACM2J,MAAM1D,MAAMxF,CAAN,CAAZ;kBACU+G,SAAV,EAAqBmC,GAArB,EAA0BjH,OAA1B,EAAmCtB,OAAnC;OAHK,MAIA;gBACGsB,OAAR,EAAiBjC,CAAjB,EAAoBwF,MAAMxF,CAAN,CAApB;;;;OAID,IAAIuC,IAAI,CAAb,EAAgBA,IAAI,KAAK6F,QAAL,CAAcvI,MAAlC,EAA0C,EAAE0C,CAA5C,EAA+C;QACvCuG,QAAQ,KAAKV,QAAL,CAAc7F,CAAd,CAAd;gBACYuG,MAAMxF,MAAN,CAAa3C,OAAb,CAAZ,EAAmCsB,OAAnC;QACIuG,aAAaM,KAAb,CAAJ,EAAyB;YACjB0B,UAAN,CAAiB,SAAjB;;;SAGGvI,OAAP;CA3BF;;AC3LO,SAASqG,OAAT,CAAkBxH,IAAlB,EAAwB;SACtBA,gBAAgB2H,KAAvB;;;AAGF,AAAO,SAASF,OAAT,CAAkBzH,IAAlB,EAAwB;SACtBA,gBAAgBsC,KAAvB;;;AAGF,AAAO,SAASoF,YAAT,CAAuB1H,IAAvB,EAA6B;SAC3BA,gBAAgB2J,KAAvB;;;ACbF;AACA,SAASC,QAAT,CAAmB/B,IAAnB,EAAyB;MACjBgC,OAAO,EAAb,CADuB;MAEjBC,OAAO,EAAb,CAFuB;OAGlB,IAAIrI,IAAI,CAAb,EAAgBA,IAAIoG,KAAK9I,MAAzB,EAAiC0C,GAAjC,EAAsC;QAC9BsI,OAAOlC,KAAKpG,CAAL,CAAb;QACMuI,UAAUD,KAAKrG,GAArB;QACI,OAAOsG,OAAP,KAAmB,WAAvB,EAAoC;WAC7BA,OAAL,IAAgBvI,CAAhB;KADF,MAEO;WACAwD,IAAL,CAAUxD,CAAV;;;SAGG;UACCoI,IADD;UAECC;GAFR;;;;AAOF,SAAS1H,MAAT,CAAgB6H,GAAhB,EAAqBC,KAArB,EAA4BxG,GAA5B,EAAiC;MAC3BoD,MAAJ,CAAWoD,KAAX,EAAkB,CAAlB;SACO;UACCA,KADD;SAEAxG;GAFP;;;AAMF,AAAe,SAASyG,OAAT,CAAiBC,KAAjB,EAAwBC,KAAxB,EAA+B;;;;MAItCC,aAAaV,SAASS,KAAT,CAAnB;MACME,QAAQD,WAAWT,IAAzB;MACMW,QAAQF,WAAWR,IAAzB;;MAEIU,MAAMzL,MAAN,KAAiBsL,MAAMtL,MAA3B,EAAmC;;WAC1B;YACCsL,KADD;aAEE;KAFT;;;;MAOII,aAAab,SAASQ,KAAT,CAAnB;MACMM,QAAQD,WAAWZ,IAAzB;MACMc,QAAQF,WAAWX,IAAzB;;MAEIa,MAAM5L,MAAN,KAAiBqL,MAAMrL,MAA3B,EAAmC;;WAC1B;YACCsL,KADD;aAEE;KAFT;;;;MAOIO,QAAQ,EAAd;;MAEIC,YAAY,CAAhB,CA9B4C;MA+BxCC,YAAYN,MAAMzL,MAAtB,CA/B4C;MAgCxCgM,eAAe,CAAnB,CAhC4C;;;;OAoCvC,IAAItJ,IAAI,CAAb,EAAiBA,IAAI2I,MAAMrL,MAA3B,EAAmC0C,GAAnC,EAAwC;QAChCuJ,QAAQZ,MAAM3I,CAAN,CAAd;;QAEI,OAAOuJ,MAAMtH,GAAb,KAAqB,WAAzB,EAAsC;;UAChC6G,MAAM1H,cAAN,CAAqBmI,MAAMtH,GAA3B,CAAJ,EAAqC;;YAC7BuH,YAAYV,MAAMS,MAAMtH,GAAZ,CAAlB;cACMuB,IAAN,CAAWoF,MAAMY,SAAN,CAAX;OAFF,MAGO;;;cAEChG,IAAN,CAAW,IAAX;;KANJ,MAQO;;UACD4F,YAAYC,SAAhB,EAA2B;;YACnBG,aAAYT,MAAMK,WAAN,CAAlB;cACM5F,IAAN,CAAWoF,MAAMY,UAAN,CAAX;OAFF,MAGO;;;cAEChG,IAAN,CAAW,IAAX;;;;;MAKAiG,gBAAgBL,aAAaL,MAAMzL,MAAnB;QACZA,MADY;QAEZ8L,SAAN,CAFJ,CA1D4C;;;;OAgEvC,IAAI7F,IAAI,CAAb,EAAgBA,IAAIqF,MAAMtL,MAA1B,EAAkCiG,GAAlC,EAAuC;QAC/BmG,QAAQd,MAAMrF,CAAN,CAAd;QACImG,MAAMzH,GAAV,EAAe;UACT,CAACgH,MAAM7H,cAAN,CAAqBsI,MAAMzH,GAA3B,CAAL,EAAsC;cAC9BuB,IAAN,CAAWkG,KAAX;;KAFJ,MAIO,IAAInG,KAAKkG,aAAT,EAAwB;YACvBjG,IAAN,CAAWkG,KAAX;;;;MAIEC,eAAeR,MAAMnM,KAAN,CAAY,CAAZ,CAArB,CA3E4C;MA4ExC4M,gBAAgB,CAApB;MACMC,UAAU,EAAhB,CA7E4C;MA8EtCC,UAAU,EAAhB,CA9E4C;MA+ExCC,qBAAJ;;OAEK,IAAIC,IAAI,CAAb,EAAgBA,IAAIpB,MAAMtL,MAA1B,GAAmC;QAC3B2M,aAAarB,MAAMoB,CAAN,CAAnB,CADiC;mBAElBL,aAAaC,aAAb,CAAf,CAFiC;;;WAK1BG,iBAAiB,IAAjB,IAAyBJ,aAAarM,MAA7C,EAAqD;cAC3CkG,IAAR,CAAa7C,OAAOgJ,YAAP,EAAqBC,aAArB,EAAoC,IAApC,CAAb,EADmD;qBAEpCD,aAAaC,aAAb,CAAf;;;QAGE,CAACG,YAAD,IAAiBA,aAAa9H,GAAb,KAAqBgI,WAAWhI,GAArD,EAA0D;;UAEpDgI,WAAWhI,GAAf,EAAoB;;YAEd8H,gBAAgBA,aAAa9H,GAAjC,EAAsC;cAChC6G,MAAMiB,aAAa9H,GAAnB,MAA4B+H,IAAI,CAApC,EAAuC;oBAC7BxG,IAAR,CAAa7C,OAAOgJ,YAAP,EAAqBC,aAArB,EAAoCG,aAAa9H,GAAjD,CAAb,EADqC;2BAEtB0H,aAAaC,aAAb,CAAf,CAFqC;;gBAIjC,CAACG,YAAD,IAAiBA,aAAa9H,GAAb,KAAqBgI,WAAWhI,GAArD,EAA0D;;sBAChDuB,IAAR,CAAa,EAACvB,KAAKgI,WAAWhI,GAAjB,EAAsBiI,IAAIF,CAA1B,EAAb;aADF,MAEO;;8BAAA;;WANT,MAUK;;oBACKxG,IAAR,CAAa,EAACvB,KAAKgI,WAAWhI,GAAjB,EAAsBiI,IAAIF,CAA1B,EAAb;;SAZJ,MAeK;;kBACKxG,IAAR,CAAa,EAACvB,KAAKgI,WAAWhI,GAAjB,EAAsBiI,IAAIF,CAA1B,EAAb;;;;;WAKC,IAAID,gBAAgBA,aAAa9H,GAAjC,EAAsC;;kBAEjCuB,IAAR,CAAa7C,OAAOgJ,YAAP,EAAqBC,aAArB,EAAoCG,aAAa9H,GAAjD,CAAb;;KA3BJ,MA8BK;;;;;;;SAOD2H,gBAAgBD,aAAarM,MAAnC,EAA2C;mBAC1BqM,aAAaC,aAAb,CAAf;YACQpG,IAAR,CAAa7C,OAAOgJ,YAAP,EAAqBC,aAArB,EAAoCG,gBAAgBA,aAAa9H,GAAjE,CAAb;;;;MAIE4H,QAAQvM,MAAR,KAAmBgM,YAAnB,IAAmC,CAACQ,QAAQxM,MAAhD,EAAwD;WAC/C;YACC6L,KADD;aAEE;KAFT;;;SAMK;UACCA,KADD;WAEE;eACIU,OADJ;eAEIC;;GAJb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzKF;AACA,AAAO,SAASK,QAAT,CAAmBC,OAAnB,EAA4BC,QAA5B,EAAsCC,OAAtC,EAA+C;MAChDA,QAAQhN,MAAR,KAAmB,CAAvB,EAA0B;WACjB,EAAP;GADF,MAEO;QACCiN,UAAU,EAAhB;YACQH,OAAR,EAAiBC,QAAjB,EAA2BC,OAA3B,EAAoCC,OAApC,EAA6C,CAA7C;WACOA,OAAP;;;;AAIJ,SAASC,OAAT,CAAkBC,QAAlB,EAA4BJ,QAA5B,EAAsCC,OAAtC,EAA+CC,OAA/C,EAAwDG,SAAxD,EAAmE;MAC7DD,QAAJ,EAAc;QACRE,aAAaL,OAAb,EAAsBI,SAAtB,EAAiCA,SAAjC,CAAJ,EAAiD;cACvCA,SAAR,IAAqBD,QAArB;;QAEEJ,SAASxE,QAAb,EAAuB;;UACjB+E,eAAeF,SAAnB;UACMpE,aAAamE,SAASnE,UAA5B;WACK,IAAItG,IAAI,CAAb,EAAgBA,IAAIqK,SAASxE,QAAT,CAAkBvI,MAAtC,EAA8C,EAAE0C,CAAhD,EAAmD;YAC3C6K,SAASR,SAASxE,QAAT,CAAkB7F,CAAlB,KAAwB,EAAvC;wBACgB,CAAhB;YACM8K,YAAYF,gBAAgBC,OAAOpE,KAAP,IAAgB,CAAhC,CAAlB;YACIkE,aAAaL,OAAb,EAAsBM,YAAtB,EAAoCE,SAApC,CAAJ,EAAoD;kBAC1CxE,WAAWtG,CAAX,CAAR,EAAuB6K,MAAvB,EAA+BP,OAA/B,EAAwCC,OAAxC,EAAiDK,YAAjD;;uBAEaE,SAAf;;;;;;;AAOR,SAASH,YAAT,CAAuBL,OAAvB,EAAgCS,GAAhC,EAAqCC,GAArC,EAA0C;MACpCV,QAAQhN,MAAR,KAAmB,CAAnB,IAAwByN,MAAMC,GAAlC,EAAuC;WAC9B,KAAP;;MAEErH,SAAS,KAAb;MACIhC,OAAO,CAAX;MAAcC,OAAO0I,QAAQhN,MAAR,GAAiB,CAAtC;MACIC,gBAAJ;MAAaqN,qBAAb;SACOjJ,QAAQC,IAAf,EAAqB;mBACH,CAACD,OAAOC,IAAR,IAAgB,CAAjB,IAAuB,CAAtC,CADmB;cAET0I,QAAQM,YAAR,CAAV;QACIjJ,SAASC,IAAb,EAAmB;eACRrE,WAAWwN,GAAX,IAAkBxN,WAAWyN,GAAtC;;KADF,MAGO,IAAIzN,UAAUwN,GAAd,EAAmB;aACjBH,eAAe,CAAtB;KADK,MAEA,IAAIrN,UAAUyN,GAAd,EAAmB;aACjBJ,eAAe,CAAtB;KADK,MAEA;;eACI,IAAT;;;;SAIGjH,MAAP;;;AChDK,IAAMsH,QAAQ;WACV,CADU;UAEX,CAFW;UAGX,CAHW;WAIV,CAJU;SAKZ,CALY;QAMb,CANa;aAOR,CAPQ;CAAd;;AAUP,SAASC,SAAT,CAAmBC,CAAnB,EAAsBC,CAAtB,EAAyB;SAChBD,IAAIC,CAAJ,GAAQ,CAAR,GAAY,CAAC,CAApB;;;;AAIF,SAASC,cAAT,CAAyBjN,OAAzB,EAAkCkN,OAAlC,EAA2CC,OAA3C,EAAoD;OAC7C,IAAIvL,IAAI,CAAb,EAAgBA,IAAIuL,QAAQjO,MAA5B,EAAoC,EAAE0C,CAAtC,EAAyC;QACjCwL,QAAQD,QAAQvL,CAAR,CAAd;YACQwL,MAAMvH,IAAd;WACOgH,MAAMQ,OAAX;;oBACcD,MAAMjN,IAAN,CAAWwC,MAAX,CAAkB3C,OAAlB,CAAZ,EAAwCkN,OAAxC;;WAEGL,MAAMS,KAAX;;mBACaJ,OAAX,EAAoBE,KAApB,EAA2BpN,OAA3B;;WAEG6M,MAAMU,IAAX;;gBACU7K,IAAR,GAAe0K,MAAM1K,IAArB;;WAEGmK,MAAMW,OAAX;;qBACexN,OAAb,EAAsBkN,OAAtB,EAA+BE,MAAMK,KAArC;;WAEGZ,MAAMa,MAAX;YACM7F,aAAauF,MAAMjN,IAAnB,CAAJ,EAA8B;;;cAEtBwN,iBAAiBP,MAAMjN,IAA7B;cACIwN,eAAeC,KAAnB,EAA0B;;2BAETC,MAAf;oBACQpN,WAAR,CAAoBkN,eAAeC,KAAnC;WAHF,MAIO;;oBAEGnN,WAAR,CAAoBkN,eAAehL,MAAf,CAAsB3C,OAAtB,CAApB;;yBAEa6J,UAAf,CAA0B,SAA1B;SAXF,MAYO;;cACDqD,OAAJ,EAAa;oBACHzM,WAAR,CAAoB2M,MAAMjN,IAAN,CAAWwC,MAAX,CAAkB3C,OAAlB,CAApB;WADF,MAEO;;;;;WAKN6M,MAAMiB,MAAX;YACMjG,aAAauF,MAAMjN,IAAnB,CAAJ,EAA8B;;;cAEtBwN,kBAAiBP,MAAMjN,IAA7B;0BACe4N,OAAf;SAHF,MAIO;;qBACMb,OAAX;;;WAGCL,MAAMmB,SAAX;;YACMZ,MAAMa,KAAN,CAAYpK,GAAZ,KAAoBuJ,MAAMc,KAAN,CAAYrK,GAApC,EAAyC;gBACjCoK,KAAN,CAAYJ,MAAZ;SADF,MAEO;gBACCK,KAAN,CAAYL,MAAZ;gBACMK,KAAN,CAAYC,KAAZ,CAAkBf,MAAMa,KAAN,CAAYL,KAA9B;gBACMK,KAAN,CAAYF,OAAZ;;;;;;;;;AASV,AAAO,SAASK,UAAT,CAAqBpO,OAArB,EAA8BkN,OAA9B,EAAuCE,KAAvC,EAA8C;MAC7CD,UAAUC,MAAMD,OAAtB;;MAEMjB,UAAU,EAAhB;OACK,IAAI7M,CAAT,IAAc8N,OAAd,EAAuB;QACjBA,QAAQnK,cAAR,CAAuB3D,CAAvB,CAAJ,EAA+B;cACrB+F,IAAR,CAAa,CAAC/F,CAAd,EAD6B;;;UAIzBgP,IAAR,CAAavB,SAAb;MACImB,QAAQb,MAAMa,KAAlB;MACMK,aAAavC,SAASmB,OAAT,EAAkBe,KAAlB,EAAyB/B,OAAzB,CAAnB;OACK,IAAItK,IAAI,CAAb,EAAgBA,IAAIsK,QAAQhN,MAA5B,EAAoC,EAAE0C,CAAtC,EAAyC;QACjC2M,MAAMrC,QAAQtK,CAAR,CAAZ;mBACe5B,OAAf,EAAwBsO,WAAWC,GAAX,CAAxB,EAAyCpB,QAAQoB,GAAR,CAAzC;;;;AAIJ,SAASC,YAAT,CAAuBxO,OAAvB,EAAgCkN,OAAhC,EAAyCO,KAAzC,EAAgD;MACxChC,UAAUgC,MAAMhC,OAAtB;MACMC,UAAU+B,MAAM/B,OAAtB;MACMxD,aAAagF,QAAQhF,UAA3B;MACMuG,SAAS,EAAf;;OAEK,IAAI7M,IAAI,CAAb,EAAgBA,IAAI6J,QAAQvM,MAA5B,EAAoC,EAAE0C,CAAtC,EAAyC;QACjCW,SAASkJ,QAAQ7J,CAAR,CAAf;QACM8M,WAAWxG,WAAW3F,OAAOoM,IAAlB,CAAjB;QACIpM,OAAOsB,GAAX,EAAgB;;aACPtB,OAAOsB,GAAd,IAAqB6K,QAArB;;eAESA,QAAX;;;OAGG,IAAI9M,KAAI,CAAb,EAAgBA,KAAI8J,QAAQxM,MAA5B,EAAoC,EAAE0C,EAAtC,EAAyC;QACjCgN,SAASlD,QAAQ9J,EAAR,CAAf;QACMjB,SAASiO,OAAO9C,EAAP,GAAY5D,WAAWhJ,MAAvB,GAAgCgJ,WAAW0G,OAAO9C,EAAlB,CAAhC,GAAwD,IAAvE;QACM+C,WAAWJ,OAAOG,OAAO/K,GAAd,CAAjB;YACQiL,YAAR,CAAqBD,QAArB,EAA+BlO,MAA/B;;;;;AAKJ,SAASoO,eAAT,CAA0BlO,IAA1B,EAAgC;oBACbkE,IAAV,CAAelE,IAAf;;;AAET,AAKA,SAASmO,UAAT,CAAqB9B,OAArB,EAA8BE,KAA9B,EAAqCpN,OAArC,EAA8C;MACtCiP,WAAW7B,MAAMvI,KAAN,CAAYqK,GAA7B;MACMC,cAAc/B,MAAMvI,KAAN,CAAYtC,MAAhC;OACK,IAAIlD,CAAT,IAAc4P,QAAd,EAAwB;QAClBA,SAASjM,cAAT,CAAwB3D,CAAxB,CAAJ,EAAgC;;UAE1B0P,gBAAgB1P,CAAhB,CAAJ,EAAwB;;YAElB,MAAM0F,IAAN,CAAW1F,CAAX,CAAJ,EAAmB;0BACDA,EAAET,KAAF,CAAQ,CAAR,CAAhB,EAA4BqQ,SAAS5P,CAAT,CAA5B,EAAyC6N,OAAzC,EAAkDlN,OAAlD;SADF,MAEO,IAAI,KAAK+E,IAAL,CAAU1F,CAAV,CAAJ,EAAkB;0BACPA,EAAET,KAAF,CAAQ,CAAR,CAAhB,EAA4BqQ,SAAS5P,CAAT,CAA5B,EAAyC6N,OAAzC,EAAkDlN,OAAlD;SADK,MAEA;cACCoG,YAAY/G,EAAET,KAAF,CAAQ,CAAR,CAAlB;cACM2J,MAAM0G,SAAS5P,CAAT,CAAZ;;oBAEU+G,SAAV,EAAqBmC,GAArB,EAA0B2E,OAA1B,EAAmClN,OAAnC;;OAVJ,MAYO;;YACD,OAAOoN,MAAMvI,KAAN,CAAYxF,CAAZ,CAAP,KAA0B,WAA9B,EAA2C;qBAC9B6N,OAAX,EAAoB7N,CAApB;SADF,MAEO;kBACG6N,OAAR,EAAiB7N,CAAjB,EAAoB+N,MAAMvI,KAAN,CAAYxF,CAAZ,CAApB;;;;;;OAMH,IAAIA,EAAT,IAAc8P,WAAd,EAA2B;QACrBA,YAAYnM,cAAZ,CAA2B3D,EAA3B,CAAJ,EAAmC;UAC7B0P,gBAAgB1P,EAAhB,CAAJ,EAAwB;YAClB,MAAM0F,IAAN,CAAW1F,EAAX,CAAJ,EAAmB,EAAnB,MACO,IAAI,KAAK0F,IAAL,CAAU1F,EAAV,CAAJ,EAAkB;gCACDA,GAAET,KAAF,CAAQ,CAAR,CAAtB,EAAkCuQ,YAAY9P,EAAZ,CAAlC,EAAkD6N,OAAlD,EAA2DlN,OAA3D;SADK,MAEA;;;;;;AClKf;AACA,SAASoP,YAAT,CAAuBrC,CAAvB,EAA0BC,CAA1B,EAA6B;SACpBqC,KAAKC,SAAL,CAAevC,CAAf,MAAsBsC,KAAKC,SAAL,CAAetC,CAAf,CAA7B;;;AAGF,SAASuC,SAAT,CAAoBC,OAApB,EAA6BC,OAA7B,EAAsC;MAChCC,eAAeF,QAAQ3K,KAA3B;MACI8K,eAAeF,QAAQ5K,KAA3B;MACI+K,kBAAkB,EAAtB;MAA0BC,qBAAqB,EAA/C;MAAmDC,WAAW,KAA9D;OACK,IAAIzQ,CAAT,IAAcqQ,YAAd,EAA4B;QACtB,CAACC,aAAa3M,cAAb,CAA4B3D,CAA5B,CAAD,IAAmC,OAAOsQ,aAAatQ,CAAb,CAAP,KAA2B,WAAlE,EAA+E;;iBAClE,IAAX;yBACmBA,CAAnB,IAAwBqQ,aAAarQ,CAAb,CAAxB;KAFF,MAGO,IAAIE,cAAcoQ,aAAatQ,CAAb,CAAd,CAAJ,EAAoC;UACrC,CAAC+P,aAAaO,aAAatQ,CAAb,CAAb,EAA8BqQ,aAAarQ,CAAb,CAA9B,CAAL,EAAqD;mBACxC,IAAX;wBACgBA,CAAhB,IAAqBsQ,aAAatQ,CAAb,CAArB;;KAHG,MAKA,IAAIsQ,aAAatQ,CAAb,MAAoBqQ,aAAarQ,CAAb,CAAxB,EAAyC;iBACnC,IAAX;sBACgBA,CAAhB,IAAqBsQ,aAAatQ,CAAb,CAArB;KAFK,MAGA,IAAIA,MAAM,SAAV,EAAqB;iBACf,IAAX;sBACgBA,CAAhB,IAAqBsQ,aAAatQ,CAAb,CAArB;;;;OAIC,IAAIA,EAAT,IAAcoQ,OAAd,EAAuB;QACjBA,QAAQzM,cAAR,CAAuB3D,EAAvB,KAA6B,CAACmQ,QAAQxM,cAAR,CAAuB3D,EAAvB,CAAlC,EAA6D;iBAChD,IAAX;sBACgBA,EAAhB,IAAqBsQ,aAAatQ,EAAb,CAArB;;;MAGA,CAACyQ,QAAL,EAAe;WACN,IAAP;;SAEK;SACAF,eADA;YAEGC;GAFV;;;;AAOF,SAASE,YAAT,CAAuBC,SAAvB,EAAkCC,SAAlC,EAA6CC,WAA7C,EAA0D/C,OAA1D,EAAmEgD,aAAnE,EAAkF;MAC1EC,QAAQC,QAASL,SAAT,EAAoBC,SAApB,CAAd;MACMK,cAAcF,MAAMpI,IAA1B;;MAEMuI,OAAOP,UAAU9Q,MAAvB;MACMsR,OAAOF,YAAYpR,MAAzB;MACMuR,MAAMF,OAAOC,IAAP,GAAcD,IAAd,GAAqBC,IAAjC,CANgF;;MAQ5EhE,eAAe0D,WAAnB;OACK,IAAItO,IAAI,CAAb,EAAgBA,IAAI6O,GAApB,EAAyB,EAAE7O,CAA3B,EAA8B;QACtB8O,QAAQV,UAAUpO,CAAV,CAAd;QACM+O,QAAQL,YAAY1O,CAAZ,CAAd;mBACe4K,eAAe,CAA9B;QACI,CAACkE,KAAL,EAAY;UACNC,KAAJ,EAAW;;sBACKvL,IAAd,CAAmB;gBACXyH,MAAMa,MADK;gBAEXiD;SAFR;;KAFJ,MAOO;eACID,KAAT,EAAgBC,KAAhB,EAAuBnE,YAAvB,EAAqCW,OAArC;;QAEEuD,SAASA,MAAMrI,KAAnB,EAA0B;sBACRqI,MAAMrI,KAAtB;;;MAGA+H,MAAM3C,KAAV,EAAiB;kBACDrI,IAAd,CAAmB;YACXyH,MAAMW,OADK;aAEV4C,MAAM3C;KAFf;;;;AAOJ,SAASmD,QAAT,CAAmB3C,KAAnB,EAA0BC,KAA1B,EAAiC1B,YAAjC,EAA+CW,OAA/C,EAAwD;MAClD0D,iBAAiB,EAArB,CADsD;MAElD3C,SAAS,IAAb,EAAmB;;mBACF9I,IAAf,CAAoB;YACZyH,MAAMiB,MADM;YAEZtB,YAFY;YAGZyB,KAHY;WAIb;KAJP;GADF,MAOO,IAAIpG,aAAaoG,KAAb,KAAuBpG,aAAaqG,KAAb,CAA3B,EAAgD;;mBACtC9I,IAAf,CAAoB;YACZyH,MAAMmB,SADM;aAEXC,KAFW;aAGXC;KAHT;GADK,MAMA,IAAIvG,QAAQsG,KAAR,KAAkBtG,QAAQuG,KAAR,CAAtB,EAAsC;;QACvCD,MAAMlI,OAAN,KAAkBmI,MAAMnI,OAAxB,IAAmCkI,MAAMpK,GAAN,KAAcqK,MAAMrK,GAA3D,EAAgE;;qBAC/CuB,IAAf,CAAoB;cACZyH,MAAMQ,OADM;cAEZa;OAFR;KADF,MAKO;;UACC4C,eAAevB,UAAUtB,KAAV,EAAiBC,KAAjB,CAArB;UACI4C,YAAJ,EAAkB;uBACD1L,IAAf,CAAoB;gBACZyH,MAAMS,KADM;iBAEXwD;SAFT;;;mBAMW7C,MAAMxG,QAAnB,EAA6ByG,MAAMzG,QAAnC,EAA6C+E,YAA7C,EAA2DW,OAA3D,EAAoE0D,cAApE;;GAfG,MAiBA,IAAIjJ,QAAQqG,KAAR,KAAkBrG,QAAQsG,KAAR,CAAtB,EAAsC;;QACvCD,MAAMvL,IAAN,KAAewL,MAAMxL,IAAzB,EAA+B;;qBACd0C,IAAf,CAAoB,EAACS,MAAMgH,MAAMU,IAAb,EAAmB7K,MAAMwL,MAAMxL,IAA/B,EAApB;;GAFG,MAIA;;mBACU0C,IAAf,CAAoB;YACZyH,MAAMQ,OADM;YAEZa,KAFY;eAGTD;KAHX;;MAME4C,eAAe3R,MAAf,GAAwB,CAA5B,EAA+B;YACrBsN,YAAR,IAAwBqE,cAAxB;;;;AAIJ,AAAO,SAASE,IAAT,CAAe9C,KAAf,EAAsBC,KAAtB,EAA6B;MAC5Bd,QAAQ,EAAd;QACMa,KAAN,GAAcA,KAAd;MACMd,UAAU,EAAhB;WACSc,KAAT,EAAgBC,KAAhB,EAAuB,CAAvB,EAA0Bf,OAA1B;QACMA,OAAN,GAAgBA,OAAhB;SACOC,KAAP;;;ACvIK,SAAS4D,OAAT,CAAkBC,QAAlB,EAA4BC,QAA5B,EAAsC;MACvCC,YAAY,KAAKC,MAAL,CAAYH,QAAZ,CAAhB;MACI,CAACE,SAAL,EAAgB;gBACF,EAAZ;;MAEE/S,QAAQ8S,QAAR,CAAJ,EAAuB;gBACTC,UAAU/I,MAAV,CAAiB8I,QAAjB,CAAZ;GADF,MAEO;cACK9L,IAAV,CAAe8L,QAAf;;OAEGE,MAAL,CAAYH,QAAZ,IAAwBE,SAAxB;;;AAGF,AAAO,SAASE,UAAT,CAAqBJ,QAArB,EAA+BC,QAA/B,EAAyC;MACxCC,YAAY,KAAKC,MAAL,CAAYH,QAAZ,CAAlB;MACI,CAACE,SAAD,IAAcA,UAAUjS,MAAV,KAAqB,CAAvC,EAA0C;WACjC,IAAP;;MAEE,CAACgS,QAAL,EAAe;cACHjK,MAAV,CAAiB,CAAjB,EAAoBkK,UAAUjS,MAA9B;GADF,MAEO;SACA,IAAI0C,IAAI,CAAb,EAAgBA,IAAIuP,UAAUjS,MAA9B,EAAsC,EAAE0C,CAAxC,EAA2C;UACrCuP,UAAUvP,CAAV,MAAiBsP,QAArB,EAA+B;kBACnBjK,MAAV,CAAiBrF,CAAjB,EAAoB,CAApB;;;;;SAKC,IAAP;;;AAGF,AAAO,SAAS0P,SAAT,CAAoBL,QAApB,EAA8B;MAC7BM,aAAa,KAAKH,MAAL,CAAYH,QAAZ,KAAyB,EAA5C;OACK,IAAIrP,IAAI,CAAb,EAAgBA,IAAI2P,WAAWrS,MAA/B,EAAuC,EAAE0C,CAAzC,EAA4C;eAC/BA,CAAX,EAAclD,IAAd,CAAmB,IAAnB;;;;AC5BJ,IAAI8S,cAAc,CAAlB;;;AAGA,SAASC,IAAT,GAAgB;SACP,sBAAsBD,aAAtB,GAAsC,IAAIE,IAAJ,GAAWC,OAAX,EAA7C;;;AAGF,SAASC,WAAT,GAAwB;SACf,IAAP;;;AAGF,AAAe,SAAS9H,KAAT,CAAgB7D,OAAhB,EAAyB;YAC5BA,WAAW,EAArB;OACKhF,IAAL,GAAYgF,QAAQhF,IAAR,IAAgB,EAA5B;OACK4C,GAAL,GAAWoC,QAAQpC,GAAR,IAAe4N,MAA1B;OACKL,MAAL,GAAc,EAAd;MACI,WAAWnL,OAAf,EAAwB;QAClB,CAAC3G,WAAW2G,QAAQL,KAAnB,CAAL,EAAgC;YACxB,IAAI2B,cAAJ,CAAmB,sBAAnB,CAAN;;QAEIsK,SAAS5L,QAAQL,KAAR,EAAf;QACIrG,cAAcsS,MAAd,CAAJ,EAA2B;WACpBjM,KAAL,GAAaiM,MAAb;KADF,MAEO;YACC,IAAItK,cAAJ,CAAmB,2BAAnB,CAAN;;GARJ,MAUO;SACA3B,KAAL,GAAa,EAAb;;OAEGf,KAAL,GAAa,EAAb;MACMiN,eAAe,EAArB;;MAEI7L,QAAQpB,KAAZ,EAAmB;SACZ,IAAIxF,CAAT,IAAc4G,QAAQpB,KAAtB,EAA6B;UACvBoB,QAAQpB,KAAR,CAAc7B,cAAd,CAA6B3D,CAA7B,CAAJ,EAAqC;aAC9BwF,KAAL,CAAWxF,CAAX,IAAgB4G,QAAQpB,KAAR,CAAcxF,CAAd,CAAhB;YACI,KAAK0F,IAAL,CAAU1F,CAAV,CAAJ,EAAkB;uBACHA,EAAET,KAAF,CAAQ,CAAR,CAAb,IAA2BqH,QAAQpB,KAAR,CAAcxF,CAAd,CAA3B;SADF,MAEO;uBACQA,CAAb,IAAkB4I,OAAOhC,QAAQpB,KAAR,CAAcxF,CAAd,CAAP,CAAlB;;;;;SAKD,KAAKuG,KAAZ,EAAmBkM,YAAnB;MACM9R,UAAU,IAAhB;MACM+R,cAAc9L,QAAQtD,MAAR,IAAkBiP,WAAtC;MACMI,mBAAmB;UACjB,aAAUC,SAAV,EAAqBhM,OAArB,EAA8B;kBACtB,CAAC,CAACgM,SAAd;aACOA,YAAYzK,EAAEvB,OAAF,CAAZ,GAAyBgM,SAAhC;KAHqB;YAKf,cAAUjK,IAAV,EAAgBkK,UAAhB,EAA4B;UAC5BC,QAAQ,EAAd;UACI/T,QAAQ4J,IAAR,CAAJ,EAAmB;aACZ,IAAIpG,IAAI,CAAb,EAAgBA,IAAIoG,KAAK9I,MAAzB,EAAiC,EAAE0C,CAAnC,EAAsC;cAC9BsI,OAAOlC,KAAKpG,CAAL,CAAb;cACMiC,MAAMtE,cAAc2K,IAAd,KAAuB,QAAQA,IAA/B,GAAsCA,KAAK,IAAL,CAAtC,GAAmDtI,CAA/D;gBACMwD,IAAN,CAAWoC,EAAE0K,WAAWxT,IAAX,CAAgBsB,OAAhB,EAAyBkK,IAAzB,EAA+BtI,CAA/B,EAAkCiC,GAAlC,CAAF,CAAX;;OAJJ,MAMO;aACA,IAAIxE,EAAT,IAAc2I,IAAd,EAAoB;cACdA,KAAKhF,cAAL,CAAoB3D,EAApB,CAAJ,EAA4B;gBACpB6K,QAAOlC,KAAK3I,EAAL,CAAb;gBACMwE,OAAMtE,cAAc2K,KAAd,KAAuB,QAAQA,KAA/B,GAAsCA,MAAK,IAAL,CAAtC,GAAmD7K,EAA/D;kBACM+F,IAAN,CAAWoC,EAAE0K,WAAWxT,IAAX,CAAgBsB,OAAhB,EAAyBkK,KAAzB,EAA+B7K,EAA/B,EAAkCwE,IAAlC,CAAF,CAAX;;;;aAICsO,KAAP;;GAtBJ;OAyBKC,UAAL,GAAkB,SAASA,UAAT,GAAuB;QACjCC,OAAON,YAAYrT,IAAZ,CACX,IADW,EAEX,SAAS4T,UAAT,GAAuB;aACd9K,EAAEtF,KAAF,CAAQlC,OAAR,EAAiBrB,WAAQM,SAAR,CAAjB,CAAP;KAHS,EAKX+S,gBALW,CAAb;WAOOK,IAAP;GARF;OAUKzE,KAAL,GAAa,IAAb,CAvEsC;OAwEjClG,UAAL,GAAkB,EAAlB,CAxEsC;OAyEjC6K,WAAL,GAAmB,EAAnB,CAzEsC;MA0EhCC,oBAAoBvM,QAAQyB,UAAR,IAAsB,EAAhD;OACK,IAAIrI,GAAT,IAAcmT,iBAAd,EAAiC;QAC3BA,kBAAkBxP,cAAlB,CAAiC3D,GAAjC,CAAJ,EAAyC;UACjCoT,kBAAkBD,kBAAkBnT,GAAlB,KAAwB,EAAhD;sBACgB4B,IAAhB,GAAuBwR,gBAAgBxR,IAAhB,IAAwB5B,GAA/C;sBACgBoG,MAAhB,GAAyB,IAAzB;WACKiC,UAAL,CAAgBrI,GAAhB,IAAqBqT,uBAAuB,IAAvB,EAA6BD,eAA7B,CAArB;;;OAGChN,MAAL,GAAcQ,QAAQR,MAAR,IAAkB,IAAhC;OACKkN,KAAL,CAAW1M,OAAX;OACK4D,UAAL,CAAgB,SAAhB;;;AAGF,SAAS6I,sBAAT,CAAiC1S,OAAjC,EAA0CyS,eAA1C,EAA2D;SAClD,SAASG,eAAT,CAAyB/N,KAAzB,EAAgC4C,QAAhC,EAA0C5D,GAA1C,EAA+C;QAChD,CAACA,GAAD,IAAQ,CAAC7D,QAAQuS,WAAR,CAAoB1O,GAApB,CAAb,EAAuC;UAC/BoC,UAAUnH,OAAO,EAAP,EAAW2T,eAAX,EAA4B,EAAC5N,OAAOA,KAAR,EAAehB,KAAKA,GAApB,EAA5B,CAAhB;UACMgP,WAAW,IAAI/I,KAAJ,CAAU7D,OAAV,CAAjB;cACQsM,WAAR,CAAoB1O,GAApB,IAA2BgP,QAA3B;KAHF,MAIO;kBACO7S,QAAQuS,WAAR,CAAoB1O,GAApB,CAAZ,EAAsCgB,KAAtC;;WAEK7E,QAAQuS,WAAR,CAAoB1O,GAApB,CAAP;GARF;;;AAYF,IAAMiP,OAAOhJ,MAAMtL,SAAnB;;AAEAsU,KAAKnQ,MAAL,GAAc,SAASA,MAAT,GAAmB;OAC1BiL,KAAL,GAAa,KAAKyE,IAAL,CAAU1P,MAAV,CAAiB,IAAjB,CAAb;SACO,KAAKiL,KAAZ;CAFF;;AAKAkF,KAAK/L,QAAL,GAAgB,SAASA,QAAT,CAAmBnB,KAAnB,EAA0B;SACjC,KAAKA,KAAZ,EAAmBA,KAAnB;OACKiI,MAAL,GAFwC;SAGjC,IAAP;CAHF;;;AAOAiF,KAAKjF,MAAL,GAAc,SAASA,MAAT,GAAmB;MAC3B,CAAC,KAAKD,KAAV,EAAiB;WACR,IAAP;;MAEImF,UAAU,KAAKV,IAArB;OACKA,IAAL,GAAY,KAAKD,UAAL,EAAZ;;MAEMjF,UAAU4D,KAAKgC,OAAL,EAAc,KAAKV,IAAnB,CAAhB;;MAEIlF,OAAJ,EAAa;eACA,IAAX,EAAiB,KAAKS,KAAtB,EAA6BT,OAA7B;GADF,MAEO;SACA,SAAL;;OAEGtD,UAAL,CAAgB,SAAhB;SACO,IAAP;CAfF;;AAkBA,SAASmJ,WAAT,CAAsBC,SAAtB,EAAiCpO,KAAjC,EAAwC;MAChCiN,eAAe,EAArB;MACIjN,KAAJ,EAAW;SACJ,IAAIxF,CAAT,IAAcwF,KAAd,EAAqB;UACfA,MAAM7B,cAAN,CAAqB3D,CAArB,CAAJ,EAA6B;kBACjBwF,KAAV,CAAgBxF,CAAhB,IAAqBwF,MAAMxF,CAAN,CAArB;YACI,KAAK0F,IAAL,CAAU1F,CAAV,CAAJ,EAAkB;uBACHA,EAAET,KAAF,CAAQ,CAAR,CAAb,IAA2BiG,MAAMxF,CAAN,CAA3B;SADF,MAEO;uBACQA,CAAb,IAAkB4I,OAAOpD,MAAMxF,CAAN,CAAP,CAAlB;;;;;SAKD4T,UAAUrN,KAAjB,EAAwBkM,YAAxB;;;AAGFgB,KAAKH,KAAL,GAAa,SAASA,KAAT,CAAgB1M,OAAhB,EAAyB;MAC9BiN,UAAUjN,QAAQiN,OAAR,IAAmB,EAAnC;;OAEK,IAAIC,CAAT,IAAcD,OAAd,EAAuB;QACjBA,QAAQlQ,cAAR,CAAuBmQ,CAAvB,CAAJ,EAA+B;UACzB,KAAKnQ,cAAL,CAAoBmQ,CAApB,CAAJ,EAA4B;gCACdA,CAAZ;OADF,MAEO;aACAA,CAAL,IAAUD,QAAQC,CAAR,CAAV;;;;MAIAC,QAAQnN,QAAQmN,KAAR,IAAiB,EAA/B;OACK,IAAI/T,CAAT,IAAc+T,KAAd,EAAqB;QACfA,MAAMpQ,cAAN,CAAqB3D,CAArB,CAAJ,EAA6B;WACtBgU,QAAL,CAAchU,CAAd,EAAiB+T,MAAM/T,CAAN,CAAjB;;;MAGA4G,QAAQqN,IAAZ,EAAkB;YACRA,IAAR,CAAa5U,IAAb,CAAkB,IAAlB;;OAEG2T,IAAL,GAAY,KAAKD,UAAL,EAAZ;CArBF;;AAwBAU,KAAK3E,KAAL,GAAa,SAASA,KAAT,CAAgB1O,QAAhB,EAA0B;MAC/B8T,aAAa,OAAO9T,QAAP,KAAoB,QAApB,GAA+BD,WAAWC,QAAX,CAA/B,GAAsDA,QAAzE;MACI,CAAC8T,UAAL,EAAiB;UACT,IAAIhM,cAAJ,CAAmB,SAAnB,CAAN;;MAEE,KAAKqG,KAAT,EAAgB;gBACF,KAAKA,KAAjB,EAAwB2F,UAAxB;GADF,MAEO;gBACO,KAAK5Q,MAAL,EAAZ,EAA2B4Q,UAA3B;;OAEG1J,UAAL,CAAgB,SAAhB;CAVF;;AAaAiJ,KAAK/E,OAAL,GAAe,SAASA,OAAT,GAAoB;MAC7B,CAAC,KAAKH,KAAV,EAAiB;WACR,IAAP;;aAES,KAAKA,KAAhB;OACK/D,UAAL,CAAgB,WAAhB;CALF;;AAQAiJ,KAAKjJ,UAAL,GAAkByH,SAAlB;;AAEAwB,KAAKO,QAAL,GAAgBrC,OAAhB;;AAEA8B,KAAKU,WAAL,GAAmBnC,UAAnB;;;AAGAyB,KAAKW,OAAL,GAAe,SAASA,OAAT,GAAoB;;;OAG5B5J,UAAL,CAAgB,SAAhB;;OAEK,IAAIxK,CAAT,IAAc,KAAK+R,MAAnB,EAA2B;QACrB,KAAKA,MAAL,CAAYpO,cAAZ,CAA2B3D,CAA3B,CAAJ,EAAmC;WAC5BmU,WAAL,CAAiBnU,CAAjB;;;CAPN;;;;"}