{"version":3,"file":"naive.js","sources":["../../lib/utils.js","../../lib/dom.js","../../lib/vdom/vtext.js","../../lib/directives/class.js","../../lib/directives/show.js","../../lib/directives/style.js","../../lib/cache.js","../../lib/parser.js","../../lib/directives/model.js","../../lib/event.js","../../lib/directive.js","../../lib/exception.js","../../lib/vdom/h.js","../../lib/vdom/vnode.js","../../lib/vdom/utils.js","../../lib/vdom/list-diff.js","../../lib/vdom/dom-index.js","../../lib/vdom/patch.js","../../lib/vdom/diff.js","../../lib/api/hooks.js","../../lib/defer.js","../../lib/main.js"],"sourcesContent":["const sliceArray = Array.prototype.slice;\n\nexport function warn (message) {\n  if (window.console) {\n    console.warn(`[naive.js] ${message}`)\n  }\n}\n\nexport function error (message) {\n  if (window.console) {\n    console.error(`[naive.js] ${message}`)\n  }\n}\n\nexport const isArray = Array.isArray || function isArray(arr) {\n  return Object.prototype.toString.call(arr) === '[obejct Array]'\n}\n\nexport function toArray (obj) {\n  return sliceArray.call(obj, 0);\n}\n\nexport function isUndefined (obj) {\n  return void 0 === obj\n}\n\nexport function noop () {}\n\nfunction isObject(obj) {\n  return 'object' === typeof obj\n}\n\nexport function clone(obj) {\n  return deepExtend({}, obj)\n}\n\nexport function hasOwn (obj, prop) {\n  return obj.hasOwnProperty(prop);\n}\n\nlet resolved = typeof Promise!=='undefined' && Promise.resolve();\nexport const defer = resolved ? (f => { resolved.then(f); }) : setTimeout; // asap async\n\n\n\n// IE8\nexport function isFunction(obj) {\n  return 'function' === typeof obj\n}\n\nexport function isString(obj) {\n  return 'string' === typeof obj\n}\n\nfunction plainObject() {\n  return {}\n}\n\nfunction hasOwnProp() {\n  return plainObject().hasOwnProperty\n}\n\n// IE8+\nexport function isPlainObject(obj) {\n  if (!obj || Object.prototype.toString.call( obj ) !== '[object Object]') {\n    return false\n  }\n\n  var proto = Object.getPrototypeOf(obj)\n\n  if (!proto) {\n    return true\n  }\n\n  var Ctor = hasOwnProp.call(proto, 'constructor') && proto.constructor\n  return typeof Ctor === 'function' && hasOwnProp.toString.call(Ctor) === hasOwnProp.toString.call(Object)\n}\n\n// IE8+\nexport function deepExtend() {\n  var options, name, src, copy, copyIsArray, clone\n  var target = arguments[0] || {}\n  var length = arguments.length\n\n  if (!isObject(target) && !isFunction(target)) {\n    target = {}\n  }\n\n  for (var i = 1; i < length; i++) {\n    if ((options = arguments[i]) != null ) {\n\n      if (isString(options)) {\n        continue\n      }\n\n      for (name in options) {\n        src = target[name]\n        copy = options[name]\n\n        // é˜²æ­¢å¾ªç¯å¼•ç”¨\n        if (target === copy) {\n          continue\n        }\n\n        // Recurse if we're merging plain objects or arrays\n        if (copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n\n          if (copyIsArray) {\n            copyIsArray = false\n            clone = src && isArray(src) ? src : []\n          } else {\n            clone = src && isPlainObject(src) ? src : {}\n          }\n\n          // Never move original objects, clone them\n          target[name] = deepExtend(clone, copy)\n          target[name] = deepExtend(clone, copy)\n\n        // Don't bring in undefined values\n        } else if (copy !== undefined) {\n          target[name] = copy\n        }\n      }\n    }\n  }\n\n  // Return the modified object\n  return target\n}\n","import { isUndefined, toArray } from './utils';\n\n/**\n * è·å–å…ƒç´ \n *\n * IE 8 åªæ”¯æŒåˆ° CSS2 é€‰æ‹©å™¨\n *\n * @param {String} selector\n */\nexport function getElement(selector) {\n  const isString = typeof selector === 'string';\n  if (isString) {\n    if (selector[0] === '#') {\n      return document.getElementById(selector.slice(1));\n    } else {\n      return query(selector);\n    }\n  } else {\n    return selector;\n  }\n}\n\nexport function createElement(tag) {\n  return document.createElement(tag);\n}\n\nexport function createTextNode (text) {\n  return document.createTextNode(text);\n}\n\nexport function createDocumentFragment () {\n  return document.createDocumentFragment();\n}\n\nexport function query(selector, context) {\n  context = context || document;\n  return context.querySelector(selector);\n}\n\n/**\n * æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ document å†…\n */\nexport function inDoc(node) {\n  const doc = node.ownerDocument.documentElement;\n  return doc === node || node && node.nodeType === 1 && doc.contains(node);\n}\n\nexport function removeNode(node) {\n  const parentNode = node ? node.parentNode : null;\n  if (parentNode) {\n    parentNode.removeChild(node);\n  }\n}\n\nexport function before(newNode, node) {\n  node.parentNode.insertBefore(newNode, node);\n}\n\nexport function replaceNode(newNode, node) {\n  node.parentNode.replaceChild(newNode, node);\n}\n\nexport function after(el, target) {\n  if (target.nextSibling) {\n    before(el, target.nextSibling)\n  } else {\n    target.parentNode.appendChild(el)\n  }\n}\n\nexport function appendChild (el, target) {\n  target.appendChild(el);\n}\n\nexport function setAttr (node, attr, value) {\n  node.setAttribute(attr, value);\n}\n\nexport function hasAttr(node, name) {\n  return node.hasAttribute(name);\n}\n\nexport function removeAttr(node, name) {\n  node.removeAttribute(name);\n}\n\nconst supportClassList = !isUndefined(document.createElement('div').classList);\n\nlet getClasses = supportClassList ?\n  function(element) {\n    return toArray(element.classList);\n  }\n  :\n  function(element) {\n    return element.className.split(/\\s+/).filter(s => s);\n  };\n\nexport let hasClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var contains = true;\n    for (let i = 0; i < classes.length; ++i) {\n      if (!element.classList.contains(classes[i])) {\n        contains = false;\n        break;\n      }\n    }\n    return contains;\n  }\n  :\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var contains = true, tmp = element.className;\n    for (let i = 0; i < classes.length; ++i) {\n      if (tmp.indexOf(classes[i]) === -1) {\n        contains = false;\n        break;\n      }\n    }\n    return contains;\n  };\n\nexport let addClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    element.classList.add.apply(element.classList, classes);\n    return element;\n  }\n  :\n  function(element, classes) {\n    var tmp = element.className;\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      if (!hasClass(element, c)) {\n        tmp = tmp.replace(/\\s+|$/, ' ' + classes);\n      }\n    });\n    element.className = tmp;\n    return element;\n  };\n\nexport let removeClass = supportClassList ?\n  function(element, classes) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    element.classList.remove.apply(element.classList, classes);\n    return element;\n  }\n  :\n  function(element, classes) {\n    var tmp = element.className;\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      if (hasClass(element, c)) {\n        tmp = tmp.replace(new RegExp(c, 'g'), '');\n      }\n    });\n    element.className = tmp;\n    return element;\n  };\n\nexport let toggleClass = supportClassList ?\n  function(element, classes, force) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    classes.forEach(c => {\n      element.classList.toggle(c, force);\n    });\n    return element;\n  }\n  :\n  function(element, classes, force) {\n    classes = classes.split(/\\s+/).filter(s => s);\n    var useForce = force !== undefined;\n    classes.forEach(c => {\n      if (hasClass(element, c) && (useForce && !force || !useForce)) {\n        removeClass(element, c);\n      } else if (!hasClass(element, c) && (useForce && force || !useForce)) {\n        addClass(element, c);\n      }\n    });\n    return element;\n  };\n","import { createTextNode } from '../dom';\n\n// virtual text node\nexport default function VText (text) {\n  this.data = text;\n}\n\nVText.prototype.render = function renderVTextToTextNode () {\n  return createTextNode(this.data);\n};\n","import { isArray } from '../utils';\nimport { addClass, removeClass, setAttr } from '../dom';\n\nexport default function klass (setValue, element, context) {\n  if (typeof setValue === 'string') {\n    setAttr(element, 'class', setValue);\n  } else if (isArray(setValue)) {\n    setAttr(element, 'class', setValue.join(' '));\n  } else {\n    for (let c in setValue) {\n      if (setValue.hasOwnProperty(c)) {\n        if (setValue[c]) {\n          addClass(element, c);\n        } else {\n          removeClass(element, c);\n        }\n      }\n    }\n  }\n}\n","export default function show (value, element, context) {\n  element.style.display = value ? '' : 'none';\n}\n","export default function style (value, element, context) {\n  for (let s in value) {\n    element.style[s] = value[s];\n  }\n}\n","/**\n * åŒå‘é“¾è¡¨å®ç°çš„ä½¿ç”¨ LRU ç®—æ³•çš„ç¼“å­˜\n * ç¼“å­˜æœ€è¿‘æœ€å¸¸ç”¨çš„é¡¹ç›®ï¼Œå½“ç¼“å­˜æ»¡æ—¶ä¸¢å¼ƒæœ€è¿‘æœ€å°‘ç”¨çš„é¡¹ç›®\n *\n * @param {Number} ç¼“å­˜æœ€å¤§é™åˆ¶\n * @constructor\n */\n\nexport default function Cache (limit) {\n  this.size = 0; // ç¼“å­˜å¤§å°\n  this.limit = limit; // ç¼“å­˜å¤§å°æœ€å¤§é™åˆ¶\n  this.head = this.tail = undefined; // å¤´å°¾æŒ‡é’ˆ\n  this._keymap = Object.create(null); // ç¼“å­˜æ˜ å°„è¡¨\n}\n\nvar p = Cache.prototype;\n\n/**\n * å°† <key> <value> é”®å€¼å¯¹å­˜å‚¨åˆ°ç¼“å­˜æ˜ å°„è¡¨\n * å¦‚æœç¼“å­˜æ»¡äº†ï¼Œåˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹è®©å‡ºç©ºé—´ç»™æ–°çš„ç¼“å­˜ï¼Œå¹¶è¿”å›è¢«åˆ çš„èŠ‚ç‚¹\n * å¦åˆ™è¿”å› undefined\n *\n * @param {String} é”®\n * @param {*} å€¼\n * @return {Entry|undefined}\n */\n\np.put = function (key, value) {\n  var removed;\n\n  var entry = this.get(key, true); // å…ˆæŸ¥çœ‹æ˜¯å¦å·²ç»æœ‰ç¼“å­˜ï¼Œå¦‚æœæœ‰ï¼Œåªéœ€è¦æ›´æ–°å®ƒçš„ value å°±å¯ä»¥äº†\n  if (!entry) {\n    if (this.size === this.limit) { // ç¼“å­˜æ»¡äº†\n      removed = this.shift();\n    }\n    entry = {\n      key: key\n    };\n    this._keymap[key] = entry;\n    if (this.tail) {\n      this.tail.newer = entry;\n      entry.older = this.tail;\n    } else {\n      this.head = entry;\n    }\n    this.tail = entry; // å°†è¿™ä¸ªé¡¹ç›®ä½œä¸ºæœ€æ–°çš„æ’å…¥ç¼“å­˜\n    this.size++;\n  }\n  entry.value = value;\n\n  return removed;\n}\n\n/**\n * ä»ç¼“å­˜ä¸­æ¸…é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆæ”¾å¾—æœ€ä¹…çš„ï¼‰é¡¹ç›®\n * è¿”å›è¢«æ¸…é™¤çš„é¡¹ç›®ï¼Œå¦‚æœç¼“å­˜ä¸ºç©ºå°±è¿”å› undefined\n */\n\np.shift = function () {\n  var entry = this.head;\n  if (entry) {\n    this.head = this.head.newer; // å¤´éƒ¨çš„æ˜¯æœ€æ—§çš„ï¼Œæ‰€ä»¥è¦ä»å¤´éƒ¨å¼€å§‹æ¸…é™¤\n    this.head.older = undefined;\n    entry.newer = entry.older = undefined;\n    this._keymap[entry.key] = undefined;\n    this.size--;\n  }\n  return entry;\n}\n\n/**\n * è·å–å¹¶ä¸”æ³¨å†Œæœ€è¿‘ä½¿ç”¨çš„ <key>\n * è¿”å› <key> å¯¹åº”çš„å€¼\n * å¦‚æœç¼“å­˜ä¸­æ‰¾ä¸åˆ°è¿™ä¸ª <key> å°±è¿”å› undefined\n *\n * @param {String} é”®\n * @param {Boolean} æ˜¯å¦è¿”å›æ•´ä¸ª entry ï¼Œå¦‚æœä¸º false åˆ™åªè¿”å› value\n * @return {Entry|*} è¿”å› Entry æˆ–è€…å®ƒçš„å€¼ï¼Œæˆ–è€… undefined\n */\n\np.get = function (key, returnEntry) {\n  var entry = this._keymap[key];\n  if (entry === undefined) return; // ç¼“å­˜ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å› undefined\n  if (entry === this.tail) { // ç¼“å­˜æ˜¯æœ€æ–°çš„ï¼Œç›´æ¥è¿”å›è¿™ä¸ªç¼“å­˜é¡¹ï¼ˆæˆ–è€…å®ƒçš„å€¼ï¼‰\n    return returnEntry\n      ? entry\n      : entry.value;\n  }\n  // HEAD--------------TAIL\n  //   <.older   .newer>\n  //  <--- add direction --\n  //   A  B  C  <D>  E\n  if (entry.newer) { // å¦‚æœç¼“å­˜ä¸æ˜¯æœ€æ–°çš„\n    if (entry === this.head) { // å¦‚æœç¼“å­˜æ˜¯æœ€æ—§çš„\n      this.head = entry.newer; // å°†æ¯”å®ƒæ–°çš„ä½œä¸ºæœ€æ—§çš„\n    }\n    entry.newer.older = entry.older; // C <-- E. å°†å®ƒçš„åä¸€ä¸ªä½œä¸ºå‰ä¸€ä¸ªçš„æœ€æ—§\n  }\n  if (entry.older) { // å¦‚æœæœ‰æ¯”å®ƒæ›´æ—§çš„\n    entry.older.newer = entry.newer; // C. --> E å°†å®ƒçš„å‰ä¸€ä¸ªä½œä¸ºåä¸€ä¸ªçš„æœ€æ–°\n  }\n  entry.newer = undefined; // D --x // å®ƒæœ¬èº«æ²¡æœ‰æ›´æ–°çš„\n  entry.older = this.tail; // D. --> E\n  if (this.tail) {\n    this.tail.newer = entry; // E. <-- D\n  }\n  this.tail = entry; // å°†è‡ªå·±ä½œä¸ºæœ€æ–°çš„\n  return returnEntry\n    ? entry\n    : entry.value;\n}\n","import Cache from './cache';\nimport { isUndefined } from './utils';\n\nconst pathCache = new Cache(1000);\n\nconst TrimRE = /^\\s+|\\s$/g;\nconst WordsRE = /([a-zA-Z$][\\w.$]*)/g;\n\n// ä¸€ä¸ªåˆ«åå¯¹åº”ä¸€ä¸ªä½œç”¨åŸŸ\nfunction parseExpressionFor(exp, scope) {\n  var vars = exp.split(/\\s+in\\s+/);\n  var alias = vars[0], expression = vars[1];\n  return {\n    alias: alias,\n    raw: expression,\n    scope: expression,\n    expression: parseExpressionGetter(expression, scope)\n  };\n}\n\nexport function splitPath(expression) {\n  expression = expression.replace(/^\\s+|\\s$/g, ''); // trim\n  var wordsRE = /([a-zA-Z$][\\w.$]*)/g;\n  return expression.match(wordsRE) || [];\n}\n\nconst saveRE = /[\\{,]\\s*[\\w\\$_]+\\s*:|('(?:[^'\\\\]|\\\\.)*'|\"(?:[^\"\\\\]|\\\\.)*\")/g;\nconst restoreRE = /\"(\\d+)\"/g;\nconst wsRE = /\\s/g;\nconst newlineRE = /\\n/g;\nconst identRE = /[^\\w$\\.](?:[A-Za-z_$][\\w$]*)/g;\n\nvar saved = [];\n\nfunction save (str, isString) {\n  var i = saved.length\n  saved[i] = isString\n    ? str.replace(newlineRE, '\\\\n')\n    : str\n  return '\"' + i + '\"'\n}\n\nfunction rewrite (raw, scope) {\n  var c = raw.charAt(0);\n  var path = raw.slice(1);\n  path = path.indexOf('\"') > -1\n    ? path.replace(restoreRE, restore)\n    : path;\n  var scopeVarKey = '';\n  for (let i = scope.length - 1; i >= 0; --i) { // ä»åå¾€å‰\n    var _scope = scope[i];\n    var namePaths = parsePath(path);\n    if (namePaths.length > 0 && namePaths[0] === _scope.alias) { // åŒ¹é…åˆ°åˆ«åï¼Œè¯´æ˜åœ¨å½“å‰ä½œç”¨åŸŸ\n      namePaths = namePaths.slice(1);\n      scopeVarKey = _scope.scope + '[' + _scope.$index + ']' + (namePaths.length > 0 ? '.' + namePaths.join('.') : '');\n      break;\n    }\n  }\n  var body = 'vm.get(\"' + (scopeVarKey ? scopeVarKey : path) + '\")';\n  return c + body;\n}\n\nfunction restore (str, i) {\n  return saved[i];\n}\n\n/**\n * è§£æä¸€ä¸ªè¡¨è¾¾å¼\n * @param {String} expression è¡¨è¾¾å¼å­—ç¬¦ä¸²\n * @param {String} scope ä½œç”¨åŸŸé™åˆ¶\n * @return {Function} ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥è¿”å›è¡¨è¾¾å¼çš„å€¼\n */\nexport function parseExpressionGetter(expression, scope) {\n  saved.length = 0;\n  var parsed = expression\n    .replace(saveRE, save)\n    .replace(wsRE, '');\n  parsed = (' ' + parsed)\n    .replace(identRE, function(raw) {\n      return rewrite(raw, scope);\n    })\n    .replace(restoreRE, restore);\n  return makeGetterFunction(parsed);\n}\n\nfunction makeGetterFunction(body) {\n  return new Function('vm', 'return ' + body + ';');\n}\n\n/**\n * parseExpression è§£æè¡¨è¾¾å¼\n * å¯¹äº `b-for` æŒ‡ä»¤ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå…¶å®ƒæŒ‡ä»¤åªè¦è¿”å›è¡¨è¾¾å¼æ‰§è¡Œå‡½æ•°å³å¯\n *\n * @param {String} name æŒ‡ä»¤åç§°\n * @param {String} expression è¡¨è¾¾å¼å­—ç¬¦ä¸²\n * @param {String} ä½œç”¨åŸŸé™åˆ¶\n * @return {{raw:String, expression:Function}}\n */\nexport function parseExpression(name, expression, scope) {\n  if (name === 'b-for') {\n    return parseExpressionFor(expression, scope);\n  }\n  if (name === 'b-on') {\n    return {\n      raw: expression,\n      expression: expression\n    };\n  }\n  return {\n    raw: expression,\n    expression: parseExpressionGetter(expression, scope)\n  };\n}\n\n/**\n * parsePath è§£æå–å€¼è·¯å¾„ï¼Œè¿”å›çœŸæ­£çš„å€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œè¿”å› undefined\n *\n * @param {Object} data\n * @param {String} path\n * @return {*} value\n * @throw {Error} ä¸åˆæ³•çš„è·¯å¾„\n *\n * @example\n * parsePath('a.b.c') === ['a', 'b', 'c']\n */\nexport function parsePath(path) {\n  var hit = pathCache.get(path);\n  if (hit) {\n    return hit;\n  }\n  // data.a.b.c ğŸ‘\n  // data.a[\"b\"].c ğŸ‘\n  // data[\"a\"][\"b\"][\"c\"] ğŸ‘\n  // data.a[\"b.c\"] ğŸ‘\n  // data[\"a.b.c\"] ğŸ‘\n  // data.a[b] ğŸ‘\n  // data.a[b.c] ğŸ‘\n  var parts = path.split(/\\[|\\]/g), i = 0;\n  var props = [];\n  while (i < parts.length) {\n    var match1 = /^(\\.)?[^\\'\\\"\\.\\s]+(\\.[^\\'\\\"\\.\\s]+)*$/.test(parts[i]);\n    var match2 = /(^\\s*\\'.+\\'\\s*$)|(^\\s*\\\".+\\\"\\s*$)|(^\\s*$)/.test(parts[i]);\n    if (!(match1 || match2)) {\n      throw new Error(\"ä¸åˆæ³•çš„è·¯å¾„: \" + path);\n    }\n    if (match1) {\n      var _props = parts[i].split('.'), j = 0;\n      while(j < _props.length) {\n        if (_props[j] === '') {\n          if (i !== 0) {\n            j++;\n            continue;\n          } else {\n            throw new Error(\"ä¸åˆæ³•çš„è·¯å¾„: \" + path);\n          }\n        } else {\n          props.push(_props[j]);\n        }\n        j++;\n      }\n    } else { // match2\n      if (!/^\\s*$/.test(parts[i])) {\n        var _prop = parts[i].replace(/^\\s*[\\\"\\']|[\\'\\\"]\\s*$/g, '');\n        props.push(_prop);\n      }\n    }\n    i++;\n  }\n  pathCache.put(path, props);\n  return props;\n}\n\nexport function getObjectFromPath(data, path) {\n  var props = parsePath(path);\n  var result = props.length > 0 ? data : undefined;\n  for (let i = 0; i < props.length; ++i) {\n    result = result[props[i]];\n    if (!result) {\n      break;\n    }\n  }\n  return result;\n}\n\nexport function setObjectFromPath(data, path, value) {\n  var props = parsePath(path);\n  var current = data, parent = data;\n  for (var i = 0; i < props.length - 1; ++i) {\n    parent = current;\n    current = current[props[i]];\n    if (isUndefined(current)) {\n      current = {};\n      parent[props[i]] = current;\n    }\n  }\n  if (i >= 0) {\n    if (typeof current === 'object') {\n     current[props[i]] = value;\n    } else {\n      current = {};\n      current[props[i]] = value;\n      parent[props[i-1]] = current;\n    }\n  }\n}\n","import { getObjectFromPath } from '../parser';\nimport { isArray } from '../utils';\n\nexport default function model(value, element, context) {\n  const currentValue = getObjectFromPath(context.state, value)\n  if (element.type === 'radio') {\n    element.checked = currentValue === element.value;\n  } else if (element.type === 'checkbox') {\n    if (isArray(currentValue)) {\n      element.checked = currentValue.indexOf(element.value) !== -1;\n    } else {\n      element.checked = currentValue === element.value;\n    }\n  } else if (element.tagName === 'SELECT') {\n    if (element.multiple) {\n      const options = element.options;\n      for (let i = 0; i < options.length; ++i) {\n        if (currentValue.indexOf(options[i].value) !== -1) {\n          options[i].selected = true;\n        } else {\n          options[i].selected = false;\n        }\n      }\n    } else {\n      if (element.value !== currentValue) {\n        element.value = currentValue;\n      }\n    }\n  } else {\n    if (element.value !== currentValue) {\n      element.value = currentValue;\n    }\n  }\n}\n","export function attachEvent (el, eventName, handler) {\n  if (el.addEventListener) {\n    el.addEventListener(eventName, handler, false);\n  } else if (el.attachEvent) {\n    el.attachEvent(eventName, handler);\n  }\n}\n\nexport function detachEvent (el, eventName, handler) {\n  if (el.removeEventListener) {\n    el.removeEventListener(eventName, handler, false);\n  } else if (el.detachEvent) {\n    el.detachEvent(eventName, handler);\n  }\n}\n","import { setAttr, removeAttr, removeClass } from './dom';\nimport { isArray, clone } from './utils';\nimport klass from './directives/class';\nimport show from './directives/show';\nimport style from './directives/style';\nimport model from './directives/model';\nimport { attachEvent } from './event';\nimport { getObjectFromPath, setObjectFromPath } from './parser';\n\nconst HtmlBooleanAttributes = ['disabled', 'checked', 'selected'];\n\nexport function handleDirective (directive, value, element, context) {\n  switch (directive) {\n    case 'show':\n      show(value, element, context);\n      break;\n    case 'class':\n      klass(value, element, context);\n      break;\n    case 'style':\n      style(value, element, context);\n      break;\n    case 'model':\n      model(value, element, context);\n      break;\n    default:\n      if (HtmlBooleanAttributes.indexOf(directive) !== -1) {\n        if (value) {\n          setAttr(element, directive, directive);\n        } else {\n          removeAttr(element, directive);\n        }\n      } else {\n        setAttr(element, directive, value);\n      }\n      break;\n  }\n}\n\nexport function bindDirective (directive, value, element, context) {\n  switch (directive) {\n    case 'model':\n      if (element.type === 'radio') {\n        attachEvent(element, 'change', function handleChange(event) {\n          const selectValue = event.currentTarget.value;\n          const currentState = clone(context.state);\n          setObjectFromPath(currentState, value, selectValue);\n          context.setState(currentState);\n        });\n      } else if (element.type === 'checkbox') {\n        attachEvent(element, 'change', function handleChange() {\n          const selectValue = event.currentTarget.value\n          const currentState = clone(context.state)\n          const preValue = getObjectFromPath(currentState, value)\n          if (event.currentTarget.checked) {\n            if (preValue.indexOf(selectValue) === -1) {\n              preValue.push(selectValue)\n            }\n          } else {\n            let i = 0;\n            while(i < preValue.length) {\n              if (preValue[i] === selectValue) {\n                preValue.splice(i, 1);\n                break;\n              }\n              ++i;\n            }\n          }\n          context.setState(currentState);\n        });\n      } else if (element.tagName === 'SELECT') {\n        attachEvent(element, 'change', function handleInput () {\n          // é€šè¿‡ path è®¾ç½® state\n          const currentState = clone(context.state);\n          if (element.multiple) {\n            const options = element.options;\n            const newValue = [];\n            for (let i = 0; i < options.length; ++i) {\n              if (options[i].selected) {\n                newValue.push(options[i].value);\n              }\n            }\n            setObjectFromPath(currentState, value, newValue);\n            context.setState(currentState);\n          } else {\n            setObjectFromPath(currentState, value, element.value);\n            context.setState(currentState);\n          }\n        });\n      } else {\n        attachEvent(element, 'input', function handleInput () {\n          // é€šè¿‡ path è®¾ç½® state\n          const currentState = clone(context.state);\n          setObjectFromPath(currentState, value, element.value);\n          context.setState(currentState);\n        });\n      }\n      break;\n    default:\n  }\n}\n\nfunction removeClassAttr (removeValue, element, context) {\n  if (typeof removeValue === 'string') {\n    removeClass(element, removeValue);\n  } else if (isArray(removeValue)) {\n    removeClass(element, removeValue.join(' '));\n  } else {\n    for (let c in removeValue) {\n      if (removeValue.hasOwnProperty(c)) {\n        removeClass(element, c);\n      }\n    }\n  }\n}\n\nexport function handleDirectiveRemove (directive, value, element, context) {\n  switch (directive) {\n    case 'class':\n      removeClassAttr(value, element, context);\n      break;\n  }\n}\n","export function NaiveException (message) {\n  this.name = 'NaiveException';\n  this.message = message;\n}\n","import VNode from './vnode';\nimport VText from './vtext';\nimport { isArray, isPlainObject } from '../utils';\nimport { isVNode, isVText, isVComponent } from './utils';\n\n// create VNode, VText, VComponent\n// @TODO éœ€è¦å¢å¼ºå‚æ•°\nexport default function h (tagName, props, children, key) {\n  const context = this || {};\n  const components = context['components'] || {};\n  if (isVNode(tagName) || isVText(tagName) || isVComponent(tagName)) {\n    return tagName;\n  } else if (isPlainObject(tagName)) {\n    if (components.hasOwnProperty(tagName.tagName)) {\n      // å¯èƒ½æ˜¯ props æˆ–è€… attrs\n      return components[tagName.tagName](tagName.props || tagName.attrs, tagName.children, tagName.key);\n    } else {\n      return new VNode(tagName.tagName, tagName.attrs, tagName.children, tagName.key);\n    }\n  } else if (isArray(tagName)) {\n    const list = [];\n    for (let i = 0; i < tagName.length; ++i) {\n      list.push(h(tagName[i]));\n    }\n    return list;\n  } else if(arguments.length < 2) {\n    return new VText(tagName);\n  } else {\n    if (components.hasOwnProperty(tagName)) {\n      return components[tagName](props, children, key);\n    } else {\n      return new VNode(tagName, props, children, key);\n    }\n  }\n}\n","import { createElement, setAttr, appendChild } from '../dom';\nimport VText from './vtext';\nimport { isVNode, isVText, isVComponent } from './utils';\nimport { isArray, isFunction, warn, toArray } from '../utils';\nimport { handleDirective, bindDirective } from '../directive';\nimport { attachEvent } from '../event';\nimport { NaiveException } from '../exception';\nimport { getObjectFromPath } from '../parser';\nimport h from './h';\n\nexport default function VNode (tagName, props, children, key) {\n  this.tagName = tagName;\n  this.props = props || {};\n  this.key = key ? String(key) : undefined; // key ç”¨æ¥æ ‡è¯†èŠ‚ç‚¹ï¼Œæ–¹ä¾¿ diff\n  let childNodes = [];\n  children = children || [];\n  for (let i = 0; i < children.length; ++i) {\n    const child = children[i];\n    if (isArray(child)) {\n      childNodes = childNodes.concat(h.call(this, child));\n    } else {\n      if (child !== false) {\n        childNodes.push(h.call(this, child));\n      }\n    }\n  }\n  this.children = childNodes;\n  let count = this.children.length;\n  for (let i = 0; i < this.children.length; ++i) {\n    count += this.children[i].count || 0;\n  }\n  this.count = count; // è®°å½•å­èŠ‚ç‚¹æ•°ï¼Œåœ¨ patch çš„æ—¶å€™æ‰¾åˆ°èŠ‚ç‚¹ä½ç½®\n}\n\n// æ£€æŸ¥æ˜¯å¦æŒ‡ä»¤å±æ€§\nfunction checkAttrDirective (attr) {\n  return /^@|n-|:/.test(attr);\n}\n\n// add event listener\nfunction isEventDirective (attr) {\n  return /^@/.test(attr);\n}\n\n// äº‹ä»¶æŒ‡ä»¤çš„å€¼å¯èƒ½æ˜¯è¡¨è¾¾å¼\nfunction matchExpression (exp) {\n  return exp.match(/(.*)\\((.*)\\)/);\n}\n\n// [é‡è¦] è§£æäº‹ä»¶ç»‘å®šçš„æ–¹æ³•\nfunction parseArgumentList (exp) {\n  let i = 0;\n  let needSeparate = false;\n  let inSingle = false;\n  let single = [];\n  let inDouble = false;\n  let double = [];\n  let inWord = false;\n  let word = [];\n  let args = [];\n  while (i < exp.length) {\n    const t = exp[i];\n    if (t === '\\'') {\n      if (inSingle) {\n        args.push({\n          type: 'string',\n          value: single.join('')\n        });\n        single.splice(0);\n        inSingle = false;\n        needSeparate = true;\n      } else if (inDouble) {\n        double.push(t);\n      } else if (inWord) {\n        throw new NaiveException('å‚æ•°é”™è¯¯');\n      } else if (needSeparate) {\n        throw new NaiveException('å‚æ•°é”™è¯¯');\n      } else {\n        inSingle = true;\n      }\n    } else if (t === '\"') {\n      if (inDouble) {\n        args.push({\n          type: 'string',\n          value: double.join('')\n        });\n        double.splice(0);\n        inDouble = false;\n        needSeparate = true;\n      } else if (inSingle) {\n        double.push(t);\n      } else if (inWord) {\n        throw new NaiveException('å‚æ•°é”™è¯¯');\n      } else if (needSeparate) {\n        throw new NaiveException('å‚æ•°é”™è¯¯');\n      } else {\n        inDouble = true;\n      }\n    } else if (t === ',') {\n      if (inSingle) {\n        single.push(t);\n      } else if (inDouble) {\n        double.push(t);\n      } else if (inWord) {\n        args.push({\n          type: 'exp',\n          value: word.join('')\n        });\n        word.splice(0);\n        inWord = false;\n        needSeparate = false;\n      } else if (!needSeparate) {\n        throw new NaiveException('å‚æ•°é”™è¯¯');\n      } else {\n        needSeparate = false;\n      }\n    } else if (t === ' ') {\n      if (inSingle) {\n        single.push(t);\n      } else if (inDouble) {\n        double.push(t);\n      } else if (inWord) {\n        throw new NaiveException('å‚æ•°é”™è¯¯');\n      }\n    } else {\n      if (inSingle) {\n        single.push(t);\n      } else if (inDouble) {\n        double.push(t);\n      } else if (inWord) {\n        word.push(t);\n      } else {\n        if (needSeparate) {\n          throw new NaiveException('å‚æ•°é”™è¯¯');\n        } else {\n          word.push(t);\n          inWord = true;\n        }\n      }\n    }\n    ++i;\n  }\n  if (inSingle || inDouble) {\n    throw new NaiveException('å‚æ•°é”™è¯¯');\n  } else if (inWord) {\n    args.push({\n      type: 'exp',\n      value: word.join('')\n    });\n  }\n  return args;\n}\n\nfunction parseExpression (exp, data) {\n  if (/^[+-]?\\d+\\.?\\d*?$/.test(exp)) {\n    return Number(exp);\n  } else {\n    return getObjectFromPath(data, exp);\n  }\n}\n\nVNode.prototype.render = function renderVNodeToElement(context) {\n  const element = createElement(this.tagName);\n  const props = this.props;\n  const nodeContext = this;\n  for (let p in props) {\n    if (props.hasOwnProperty(p)) {\n      if (/^n-/.test(p)) {\n        bindDirective(p.slice(2), props[p], element, context);\n        handleDirective(p.slice(2), props[p], element, context);\n      } else if (/^:/.test(p)) {\n        handleDirective(p.slice(1), props[p], element, context);\n      } else if (/^@/.test(p)) {\n        const eventName = p.slice(1);\n        const handler = props[p];\n        attachEvent(element, eventName, handler);\n      } else {\n        setAttr(element, p, props[p]);\n      }\n    }\n  }\n  for (let i = 0; i < this.children.length; ++i) {\n    const child = this.children[i];\n    const _isVComponent = isVComponent(child)\n    if (_isVComponent) {\n      // å¦‚æœæ˜¯ç»„ä»¶ï¼Œå…ˆ update props\n      child.update();\n    }\n    appendChild(child.render(context), element);\n    if (_isVComponent) {\n      child._callHooks('mounted');\n    }\n  }\n  return element;\n};\n","import VText from './vtext';\nimport VNode from './vnode';\nimport Naive from '../main';\n\nexport function isVNode (node) {\n  return node instanceof VNode;\n}\n\nexport function isVText (node) {\n  return node instanceof VText;\n}\n\nexport function isVComponent (node) {\n  return node instanceof Naive;\n}\n","import { isVComponent } from './utils';\n\n// åˆ†åˆ«æ‰¾åˆ°æœ‰ key çš„å…ƒç´ ä½ç½®å’Œæ²¡æœ‰ key çš„å…ƒç´ çš„ä½ç½®\nfunction keyIndex (list) {\n  const keys = {}; // æœ‰ key çš„èŠ‚ç‚¹ä½ç½®\n  const free = []; // å¯æ›¿æ¢çš„ä½ç½®ï¼ˆæ²¡æœ‰ key çš„èŠ‚ç‚¹éƒ½è¢«æ ‡è¯†ä¸ºå¯æ›¿æ¢çš„èŠ‚ç‚¹ï¼‰\n  for (let i = 0; i < list.length; i++) {\n    const item = list[i]\n    const itemKey = item.key;\n    if (typeof itemKey !== 'undefined') {\n      keys[itemKey] = i;\n    } else {\n      free.push(i);\n    }\n  }\n  return {\n    keys: keys,\n    free: free\n  };\n}\n\n// æ¨¡æ‹Ÿåˆ é™¤\nfunction remove(arr, index, key) {\n  arr.splice(index, 1);\n  return {\n    from: index,\n    key: key\n  };\n}\n\nexport default function reorder(pList, nList) {\n  // N: pList.length\n  // M: nList.length\n  // O(M) time, O(M) memory\n  const nListIndex = keyIndex(nList);\n  const nKeys = nListIndex.keys;\n  const nFree = nListIndex.free;\n\n  if (nFree.length === nList.length) { // å¦‚æœ nList å…¨éƒ¨èŠ‚ç‚¹éƒ½æ²¡æœ‰ key å°±ä¸éœ€è¦ reorder æŠŠ nList ç›´æ¥ä½œä¸º reorder ä¹‹åçš„åˆ—è¡¨è¿”å›\n    return {\n      list: nList,\n      moves: null\n    };\n  }\n\n  // O(N) time, O(N) memory\n  const pListIndex = keyIndex(pList)\n  const pKeys = pListIndex.keys;\n  const pFree = pListIndex.free;\n\n  if (pFree.length === pList.length) { // å¦‚æœ pList å…¨éƒ¨èŠ‚ç‚¹éƒ½æ²¡æœ‰ key å°±ä¸éœ€è¦ reorder æŠŠ nList ç›´æ¥ä½œä¸º reorder ä¹‹åçš„åˆ—è¡¨è¿”å›\n    return {\n      list: nList,\n      moves: null\n    };\n  }\n\n  // O(MAX(N, M)) memory\n  const rList = [];\n\n  let freeIndex = 0; // è¡¨ç¤ºæ²¡æœ‰ key çš„èŠ‚ç‚¹å·²ä½¿ç”¨çš„ä¸ªæ•°\n  let freeCount = nFree.length; // è¡¨ç¤º nList ä¸­æ²¡æœ‰ key çš„èŠ‚ç‚¹çš„æ€»ä¸ªæ•°\n  let deletedItems = 0; // è¢«åˆ é™¤çš„èŠ‚ç‚¹çš„ä¸ªæ•°\n\n  // O(N) time\n  // éå† pList å°† pList æœ‰ key çš„èŠ‚ç‚¹æ˜ å°„åˆ° nList çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰æ˜ å°„ï¼Œå°±ç”¨ null è¡¨ç¤ºèŠ‚ç‚¹å°†è¢«åˆ é™¤ã€‚pList ç©ºé—²èŠ‚ç‚¹ç”¨ nList çš„ç©ºé—²èŠ‚ç‚¹æŒ‰é¡ºåºå ä½\n  for (let i = 0 ; i < pList.length; i++) {\n    const pItem = pList[i];\n\n    if (typeof pItem.key !== 'undefined') { // key èŠ‚ç‚¹\n      if (nKeys.hasOwnProperty(pItem.key)) { // æœ‰æ˜ å°„\n        const itemIndex = nKeys[pItem.key];\n        rList.push(nList[itemIndex]);\n      } else { // æ²¡æœ‰æ˜ å°„\n        deletedItems++;\n        rList.push(null);\n      }\n    } else { // ç©ºé—²èŠ‚ç‚¹\n      if (freeIndex < freeCount) { // nList çš„ç©ºé—²èŠ‚ç‚¹è¿˜æ²¡ç”¨å®Œï¼Œç»§ç»­ç”¨\n        const itemIndex = nFree[freeIndex++];\n        rList.push(nList[itemIndex]);\n      } else { // nList çš„ç©ºé—²èŠ‚ç‚¹ç”¨å®Œäº†ï¼Œè¿™ä¸ª pList çš„ç©ºé—²èŠ‚ç‚¹æ²¡æœ‰èŠ‚ç‚¹ä¸å…¶å¯¹åº”ï¼Œåº”è¯¥è¢«åˆ é™¤\n        deletedItems++;\n        rList.push(null);\n      }\n    }\n  }\n\n  const lastFreeIndex = freeIndex >= nFree.length ? // nList ä¸­ä¸‹ä¸€ä¸ªç©ºé—²èŠ‚ç‚¹çš„ä½ç½®\n      nList.length : // nList ä¸­ç©ºé—²èŠ‚ç‚¹å·²ç»ç”¨å®Œäº†\n      nFree[freeIndex]; // æœªç”¨å®Œ\n\n  // O(M) time\n  // éå† nList å°†æ–°å¢èŠ‚ç‚¹ï¼å‰©ä½™ç©ºé—²èŠ‚ç‚¹è¿½åŠ åˆ° rList æœ«å°¾\n  for (let j = 0; j < nList.length; j++) {\n    const nItem = nList[j];\n    if (nItem.key) {\n      if (!pKeys.hasOwnProperty(nItem.key)) {\n        rList.push(nItem);\n      }\n    } else if (j >= lastFreeIndex) {\n      rList.push(nItem);\n    }\n  }\n\n  const simulateList = rList.slice(0); // å¤åˆ¶ä¸€ä»½ï¼Œæ¨¡æ‹Ÿ rList -> nList é‡æ’æ“ä½œ\n  let simulateIndex = 0;\n  const removes = []; // è¢«ç§»é™¤çš„èŠ‚ç‚¹\n  const inserts = []; // è¢«æ’å…¥çš„èŠ‚ç‚¹\n  let simulateItem;\n\n  for (let k = 0; k < nList.length;) {\n    const wantedItem = nList[k]; // ç›®æ ‡èŠ‚ç‚¹\n    simulateItem = simulateList[simulateIndex]; // æ¨¡æ‹ŸèŠ‚ç‚¹\n\n    // å…ˆæ¨¡æ‹Ÿåˆ é™¤\n    while (simulateItem === null && simulateList.length) {\n      removes.push(remove(simulateList, simulateIndex, null)); // åˆ é™¤ä¸éœ€è¦è®°å½• key çš„èŠ‚ç‚¹\n      simulateItem = simulateList[simulateIndex];\n    }\n\n    if (!simulateItem || simulateItem.key !== wantedItem.key) {\n      // å¦‚æœå½“å‰ä½ç½®æœ‰ key\n      if (wantedItem.key) {\n        // å¦‚æœå½“å‰èŠ‚ç‚¹çš„ä½ç½®ä¸å¯¹ï¼Œè¦è¿›è¡Œç§»åŠ¨\n        if (simulateItem && simulateItem.key) {\n          if (nKeys[simulateItem.key] !== k + 1) {\n            if (isVComponent(simulateItem)) {\n              // debugger\n            }\n            removes.push(remove(simulateList, simulateIndex, simulateItem.key)); // å…ˆç§»é™¤å½“å‰ä½ç½®çš„èŠ‚ç‚¹\n            simulateItem = simulateList[simulateIndex]; // åˆ é™¤åï¼Œè¯¥ä½ç½®å¯¹åº”çš„æ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\n            // ç„¶ååœ¨å½“å‰ä½ç½®æ’å…¥ç›®æ ‡èŠ‚ç‚¹\n            if (!simulateItem || simulateItem.key !== wantedItem.key) { // å¦‚æœåˆ é™¤ä¹‹åè¿˜ä¸å¯¹åº”ï¼Œå°±æ’å…¥ç›®æ ‡èŠ‚ç‚¹\n              inserts.push({key: wantedItem.key, to: k});\n            } else { // åˆ é™¤åæ­£å¥½å¯¹åº”å°±ä¸éœ€è¦æ’å…¥äº†\n              simulateIndex++; // æ£€æŸ¥ä¸‹ä¸€ä¸ª\n            }\n          }\n          else { // nKeys[simulateItem.key] === k + 1 å¦‚æœä¸‹ä¸€ä¸ªç›®æ ‡èŠ‚ç‚¹å’Œå½“å‰æ¨¡æ‹ŸèŠ‚ç‚¹å¯¹åº”\n            inserts.push({key: wantedItem.key, to: k});\n          }\n        }\n        else { // ä½ç½®ä¸å¯¹ï¼Œæ’å…¥\n          inserts.push({key: wantedItem.key, to: k});\n        }\n        k++;\n      }\n      // ç›®æ ‡èŠ‚ç‚¹æ²¡æœ‰ key ä½†æ˜¯ æ¨¡æ‹ŸèŠ‚ç‚¹æœ‰ key\n      else if (simulateItem && simulateItem.key) {\n        // ä½ç½®ä¸å¯¹ï¼Œåˆ é™¤\n        removes.push(remove(simulateList, simulateIndex, simulateItem.key))\n      }\n    }\n    else {\n      simulateIndex++;\n      k++;\n    }\n  }\n\n  // åˆ é™¤æ‰€æœ‰å‰©ä½™èŠ‚ç‚¹\n  while(simulateIndex < simulateList.length) {\n    simulateItem = simulateList[simulateIndex];\n    removes.push(remove(simulateList, simulateIndex, simulateItem && simulateItem.key));\n  }\n\n  // è¿™ç§æƒ…å†µä¸éœ€è¦ç§»ä½ï¼Œåªéœ€è¦åˆ é™¤å¤šä½™çš„èŠ‚ç‚¹ï¼šæ²¡æœ‰ key å¯¹åº”çš„èŠ‚ç‚¹ã€å¤šä½™çš„ç©ºé—²èŠ‚ç‚¹\n  if (removes.length === deletedItems && !inserts.length) {\n    return {\n      list: rList,\n      moves: null\n    };\n  }\n\n  return {\n    list: rList,\n    moves: {\n      removes: removes,\n      inserts: inserts\n    }\n  };\n}\n\n// reorder:\n// [f1, A, B, C, D, f2] => [f3, C, B, A, f4, E, f5]\n// rList: [f3, A, B, C, null, f4]\n// rList: [f3, A, B, C, null, f4, E, f5]\n// deletedItems: 1\n// simulateList: [f3, A, B, C, null, f4, E, f5]\n// nList:        [f3, C, B, A, f4,   E,  f5   ]\n// si:0, k:0, nItem:f3, sItem:f3\n// s1:1, k:1, nItem:C, sItem:A\n// remove(1, A) => simulateList:[f3, B, C, null, f4, E, f5], sItem:B\n// insert(1, C) k++\n// si:1, k:2, nItem:B, sItem:B\n// si:2, k:3, nItem:A, sItem:C\n// remove(2, C) => simulateList:[f3, B, null, f4, E, f5], sItem:null\n// insert(3, A) k++\n// si:2, k:4, nItem:f4, sItem:null\n// remove(2, null) => simulateList:[f3, B, f4, E, f5], sItem:f4\n// si:2, k:4, nItem:f4, sItem:f4 => si++, k++\n// si:3, k:5, nItem:E, sItem:E => si++, k++\n// si:4, k:6, nItem:f5, sItem:f5 => si++, k++\n// si:5, k:7\n// moves:{removes: [(1, A), (2, C), (2, null)], inserts: [(1, C), (3, A)]}\n\n// diffChildren:\n// pList: [f1, A1, B1, C1, D,    f2       ]\n// rList: [f3, A2, B2, C2, null, f4, E, f5]\n// diff(f1, f3)\n// diff(A1, A2)\n// diff(B1, B2)\n// diff(C1, C2)\n// diff(D, null) => remove(D)\n// diff(f2, f4)\n// insert(null, E)\n// insert(null, f5)\n// {order: moves}\n\n// patch:\n// [f1, A1, B1, C1, D, f2]\n// ç›®æ ‡: [f3, C2, B2, A2, f4, E, f5]\n// insert(null, E) => [f1, A1, B1, C1, D, f2, E]\n// insert(null, f5) => [f1, A1, B1, C1, D, f2, E, f5]\n// patch order:\n// remove(1, A) => [f1, B1, C1, D, f2, E, f5], map:{A: A1}\n// remove(2, C) => [f1, B1, D, f2, E, f5], map:{A: A1, C: C1}\n// remove(2, null) => [f1, B1, f2, E, f5]\n// insert(1, C) => [f1, C1, B1, f2, E, f5]\n// insert(3, A) => [f1, C1, B1, A1, f2, E, f5]\n// patch å­èŠ‚ç‚¹\n// patch(f1, f3)\n// patch(A1, A2)\n// patch(B1, B2)\n// patch(C1, C2)\n// remove D å·²åˆ é™¤ï¼Œä¸ä¼šé‡å¤åˆ é™¤\n// patch(f2, f4)\n","// æ˜ å°„ dom æ ‘ä¸ virtual-dom æ ‘ï¼Œæ‰¾åˆ°å¯¹åº”ç´¢å¼•çš„ dom èŠ‚ç‚¹å¹¶ä¿å­˜ç´¢å¼•æ˜ å°„\nexport function domIndex (domTree, vdomTree, indices) {\n  if (indices.length === 0) {\n    return {};\n  } else {\n    const mapping = {};\n    recurse(domTree, vdomTree, indices, mapping, 0);\n    return mapping;\n  }\n}\n\nfunction recurse (rootNode, vdomTree, indices, mapping, rootIndex) {\n  if (rootNode) {\n    if (indexInRange(indices, rootIndex, rootIndex)) {\n      mapping[rootIndex] = rootNode;\n    }\n    if (vdomTree.children) { // åªæœ‰ VNode è¦æŸ¥æ‰¾ VText/VComponent ä¸éœ€è¦\n      let currentIndex = rootIndex;\n      const childNodes = rootNode.childNodes;\n      for (let i = 0; i < vdomTree.children.length; ++i) {\n        const vChild = vdomTree.children[i] || {};\n        currentIndex += 1;\n        const nextIndex = currentIndex + (vChild.count || 0);\n        if (indexInRange(indices, currentIndex, nextIndex)) {\n          recurse(childNodes[i], vChild, indices, mapping, currentIndex);\n        }\n        currentIndex = nextIndex;\n      }\n    }\n  }\n}\n\n// æŸ¥æ‰¾ indices æ•°ç»„ï¼ˆå·²æ’åºï¼‰ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ [min, max] åŒºé—´å†…çš„å…ƒç´ \nfunction indexInRange (indices, min, max) {\n  if (indices.length === 0 || min > max) {\n    return false;\n  }\n  let result = false;\n  let head = 0, tail = indices.length - 1;\n  let current, currentIndex;\n  while (head <= tail) {\n    currentIndex = ((head + tail) / 2) >> 0; // ç§»ä½æ“ä½œä¸ºäº†å¿«é€Ÿå‘ä¸‹å–æ•´\n    current = indices[currentIndex];\n    if (head === tail) {\n      result = current >= min && current <= max;\n      break;\n    } else if (current < min) {\n      head = currentIndex + 1;\n    } else if (current > max) {\n      tail = currentIndex - 1;\n    } else { // min <= current <= max\n      result = true;\n      break;\n    }\n  }\n  return result;\n}\n","import { setAttr, replaceNode, removeNode, removeAttr } from '../dom';\nimport { handleDirective, handleDirectiveRemove } from '../directive';\nimport { domIndex } from './dom-index';\nimport { isVComponent } from './utils';\n\nexport const PATCH = {\n  REPLACE: 0, // æ›¿æ¢èŠ‚ç‚¹\n  INSERT: 1, // æ’å…¥\n  REMOVE: 2, // ç§»é™¤\n  REORDER: 3, // é‡æ’\n  PROPS: 4, // ä¿®æ”¹å±æ€§\n  TEXT: 5, // æ›¿æ¢æ–‡æœ¬\n  COMPONENT: 6 // ç»„ä»¶ patch\n};\n\nfunction ascending(a, b) {\n  return a > b ? 1 : -1;\n}\n\n// ç§»é™¤èŠ‚ç‚¹\n// å¦‚æœæ˜¯ DOM èŠ‚ç‚¹ï¼Œè°ƒç”¨ removeNode\n// å¦‚æœæ˜¯ç»„ä»¶èŠ‚ç‚¹ï¼Œè°ƒç”¨ unmount\n// å…ˆåˆ å­èŠ‚ç‚¹ï¼Œé€’å½’åˆ é™¤\nfunction doRemoveNode(domNode, target) {\n  if (!target.children) {\n    if (isVComponent(target)) {\n      target.unmount();\n    } else {\n      removeNode(domNode);\n    }\n    return;\n  }\n  for (let i = 0; i < target.children.length; ++i) {\n    const child = target.children[i];\n    doRemoveNode(domNode.childNodes[i], child);\n  }\n  removeNode(domNode);\n}\n\n// æ ¹æ®è¡¥ä¸æ›´æ–° DOM èŠ‚ç‚¹\nfunction doApplyPatches (context, domNode, patches) {\n  for (let i = 0; i < patches.length; ++i) {\n    const patch = patches[i];\n    switch (patch.type) {\n      case PATCH.REPLACE: // æ›¿æ¢å…ƒç´ èŠ‚ç‚¹\n        replaceNode(patch.node.render(context), domNode);\n        break;\n      case PATCH.PROPS: // å±æ€§ä¿®æ”¹\n        patchProps(domNode, patch, context);\n        break;\n      case PATCH.TEXT: // æ›¿æ¢æ–‡æœ¬å†…å®¹\n        domNode.data = patch.data;\n        break;\n      case PATCH.REORDER: // å­èŠ‚ç‚¹é‡æ–°æ’åº\n        // @TODO è¿™é‡Œä¹Ÿæœ‰ç§»é™¤ç»„ä»¶çš„æ“ä½œ\n        patchReorder(context, domNode, patch.moves)\n        break;\n      case PATCH.INSERT:\n        if (isVComponent(patch.node)) { // æ’å…¥ç»„ä»¶\n          // console.log('æ’å…¥ç»„ä»¶')\n          const childComponent = patch.node;\n          if (childComponent.$root) {\n            // å¦‚æœç»„ä»¶å·²ç»æœ‰ $root å°± setState -> update\n            childComponent.update();\n            domNode.appendChild(childComponent.$root)\n          } else {\n            // å¦åˆ™ç›´æ¥ render\n            domNode.appendChild(childComponent.render(context))\n          }\n          childComponent._callHooks('mounted');\n        } else { // æ’å…¥èŠ‚ç‚¹\n          if (domNode) {\n            domNode.appendChild(patch.node.render(context));\n          } else {\n            // å¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨äº†ï¼Œä¸éœ€è¦æ‰§è¡Œæ’å…¥æ“ä½œ\n          }\n        }\n        break;\n      case PATCH.REMOVE:\n        doRemoveNode(domNode, patch.node)\n        break;\n      case PATCH.COMPONENT: // å¯èƒ½æ˜¯åŒä¸€ç»„ä»¶æˆ–ä¸åŒç»„ä»¶ï¼Œä½†è‚¯å®šéƒ½æ˜¯ç»„ä»¶\n        if (patch.pVdom.key === patch.nVdom.key) {\n          patch.pVdom.update();\n        } else {\n          // ???\n          patch.nVdom.update();\n          patch.nVdom.mount(patch.pVdom.$root);\n          patch.pVdom.unmount();\n        }\n        break;\n      default:\n        // warn\n    }\n  }\n}\n\nexport function applyPatch (context, domNode, patch) {\n  const patches = patch.patches;\n  // å…ˆæ‰¾éœ€è¦ patch çš„ dom èŠ‚ç‚¹\n  const indices = [];\n  for (let p in patches) {\n    if (patches.hasOwnProperty(p)) {\n      indices.push(+p); // ä¸€å®šè¦è½¬æˆæ•°å­—\n    }\n  }\n  indices.sort(ascending);\n  let pVdom = patch.pVdom;\n  const domMapping = domIndex(domNode, pVdom, indices);\n  for (let i = 0; i < indices.length; ++i) {\n    const idx = indices[i];\n    doApplyPatches(context, domMapping[idx], patches[idx]);\n  }\n}\n\nfunction patchReorder (context, domNode, moves) {\n  const removes = moves.removes;\n  const inserts = moves.inserts;\n  const childNodes = domNode.childNodes;\n  const keyMap = {};\n  // å…ˆåˆ é™¤\n  for (let i = 0; i < removes.length; ++i) {\n    const remove = removes[i];\n    const toRemove = childNodes[remove.from];\n    if (remove.key) { // éœ€è¦ä¿ç•™ï¼Œç­‰å¾…é‡æ–°æ’å…¥\n      keyMap[remove.key] = toRemove;\n    }\n    removeNode(toRemove);\n  }\n  // åæ’å…¥\n  for (let i = 0; i < inserts.length; ++i) {\n    const insert = inserts[i];\n    const target = insert.to < childNodes.length ? childNodes[insert.to] : null;\n    const toInsert = keyMap[insert.key];\n    domNode.insertBefore(toInsert, target);\n  }\n}\n\n// æ£€æŸ¥æ˜¯å¦æŒ‡ä»¤å±æ€§\nfunction isAttrDirective (attr) {\n  return /^@|n-|:/.test(attr);\n}\n// æ£€æŸ¥æ˜¯å¦äº‹ä»¶æŒ‡ä»¤\nfunction isEventDirective (attr) {\n  return /^@/.test(attr);\n}\n\nfunction patchProps (domNode, patch, context) {\n  const setProps = patch.props.set;\n  const removeProps = patch.props.remove;\n  for (let p in setProps) {\n    if (setProps.hasOwnProperty(p)) {\n      // æ£€æŸ¥æ˜¯å¦æŒ‡ä»¤å±æ€§\n      if (isAttrDirective(p)) {\n        // å¤„ç†æŒ‡ä»¤\n        if (/^n-/.test(p)) {\n          handleDirective(p.slice(2), setProps[p], domNode, context);\n        } else if (/^:/.test(p)) {\n          handleDirective(p.slice(1), setProps[p], domNode, context);\n        } else {\n          // äº‹ä»¶ä¸å¤„ç†\n        }\n      } else { // æ™®é€šå±æ€§\n        if (typeof patch.props[p] === 'undefined') {\n          removeAttr(domNode, p);\n        } else {\n          setAttr(domNode, p, patch.props[p]);\n        }\n      }\n    }\n  }\n  // @TODO remove é”™è¯¯\n  for (let p in removeProps) {\n    if (removeProps.hasOwnProperty(p)) {\n      if (isAttrDirective(p)) {\n        if (/^n-/.test(p)) {\n        } else if (/^:/.test(p)) {\n          handleDirectiveRemove(p.slice(1), removeProps[p], domNode, context);\n        } else {\n        }\n      }\n    }\n  }\n}\n","import { isVNode, isVText, isVComponent } from './utils';\nimport { isArray, isPlainObject } from '../utils';\nimport listDiff from './list-diff';\nimport { PATCH } from './patch';\n\n// å¿«é€Ÿæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦â€œç›¸ç­‰â€\nfunction objectEquals (a, b) {\n  return JSON.stringify(a) === JSON.stringify(b);\n}\n\nfunction diffProps (oldTree, newTree) {\n  let oldTreeProps = oldTree.props;\n  let newTreeProps = newTree.props;\n  let setPropsPatches = {}, removePropsPatches = {}, hasPatch = false;\n  for (let p in oldTreeProps) {\n    if (!newTreeProps.hasOwnProperty(p) || typeof newTreeProps[p] === 'undefined') { // å±æ€§è¢«ç§»é™¤\n      hasPatch = true;\n      removePropsPatches[p] = oldTreeProps[p];\n    } else if (isPlainObject(newTreeProps[p])) {\n      if (!objectEquals(newTreeProps[p], oldTreeProps[p])) {\n        hasPatch = true;\n        setPropsPatches[p] = newTreeProps[p];\n      }\n    } else if (newTreeProps[p] !== oldTreeProps[p]) {\n      hasPatch = true;\n      setPropsPatches[p] = newTreeProps[p];\n    } else if (p === 'n-model') {\n      hasPatch = true;\n      setPropsPatches[p] = newTreeProps[p];\n    }\n  }\n  // æ£€æŸ¥æ–°å±æ€§\n  for (let p in newTree) {\n    if (newTree.hasOwnProperty(p) && !oldTree.hasOwnProperty(p)) {\n      hasPatch = true;\n      setPropsPatches[p] = newTreeProps[p];\n    }\n  }\n  if (!hasPatch) {\n    return null;\n  }\n  return {\n    set: setPropsPatches,\n    remove: removePropsPatches\n  };\n}\n\n// æŒ‰ç…§å…ˆåˆ é™¤åæ’å…¥çš„é¡ºåº\nfunction diffChildren (pChildren, nChildren, parentIndex, patches, parentPatches) {\n  const diffs = listDiff(pChildren, nChildren);\n  const orderedList = diffs.list;\n\n  const pLen = pChildren.length;\n  const oLen = orderedList.length;\n  const len = pLen > oLen ? pLen : oLen; // const len = max(pLen, oLen);\n\n  let currentIndex = parentIndex;\n  for (let i = 0; i < len; ++i) {\n    const pNode = pChildren[i];\n    const nNode = orderedList[i];\n    currentIndex = currentIndex + 1;\n    if (!pNode) {\n      if (nNode) { // æ—§çš„æ²¡æœ‰æ–°çš„æœ‰ï¼Œæ’å…¥ï¼ˆæœ«å°¾ï¼‰\n        parentPatches.push({\n          type: PATCH.INSERT,\n          node: nNode\n        });\n      }\n    } else {\n      diffWalk(pNode, nNode, currentIndex, patches);\n    }\n    if (pNode && pNode.count) {\n      currentIndex += pNode.count;\n    }\n  }\n  if (diffs.moves) {\n    parentPatches.push({\n      type: PATCH.REORDER,\n      moves: diffs.moves\n    });\n  }\n}\n\nfunction diffWalk (pVdom, nVdom, currentIndex, patches) {\n  let currentPatches = []; // å½“å‰å±‚çº§çš„ patch\n  if (nVdom == null) { // * VS null|undefined\n    currentPatches.push({\n      type: PATCH.REMOVE,\n      from: currentIndex,\n      node: pVdom,\n      key: null\n    });\n  } else if (isVComponent(pVdom) && isVComponent(nVdom)) { // Component VS Component\n    currentPatches.push({\n      type: PATCH.COMPONENT,\n      pVdom: pVdom,\n      nVdom: nVdom\n    });\n  } else if (isVNode(pVdom) && isVNode(nVdom)) { // VNode VS VNode\n    if (pVdom.tagName !== nVdom.tagName || pVdom.key !== nVdom.key) { // ä¸åŒ tagName/key èŠ‚ç‚¹: æ›¿æ¢\n      currentPatches.push({\n        type: PATCH.REPLACE,\n        node: nVdom\n      });\n    } else { // åŒ key åŒ tagName èŠ‚ç‚¹: æ¯”è¾ƒå±æ€§å’Œå­èŠ‚ç‚¹\n      const propsPatches = diffProps(pVdom, nVdom);\n      if (propsPatches) {\n        currentPatches.push({\n          type: PATCH.PROPS,\n          props: propsPatches\n        });\n      }\n      // ç»§ç»­ diff å­èŠ‚ç‚¹\n      diffChildren(pVdom.children, nVdom.children, currentIndex, patches, currentPatches);\n    }\n  } else if (isVText(pVdom) && isVText(nVdom)) { // VText VS VText\n    if (pVdom.data !== nVdom.data) { // å†…å®¹ä¸ä¸€æ ·çš„æ—¶å€™æ‰æ›¿æ¢ï¼ˆåªæ›¿æ¢å†…å®¹å³å¯ï¼‰\n      currentPatches.push({type: PATCH.TEXT, data: nVdom.data});\n    }\n  } else { // ä¸åŒç±»å‹çš„èŠ‚ç‚¹\n    currentPatches.push({\n      type: PATCH.REPLACE,\n      node: nVdom,\n      preNode: pVdom\n    });\n  }\n  if (currentPatches.length > 0) {\n    patches[currentIndex] = currentPatches;\n  }\n}\n\nexport function diff (pVdom, nVdom) {\n  const patch = {};\n  patch.pVdom = pVdom;\n  const patches = {};\n  diffWalk(pVdom, nVdom, 0, patches);\n  patch.patches = patches;\n  return patch;\n}\n","import { isArray } from '../utils';\n\nexport function addHook (hookName, callback) {\n  let callbacks = this._hooks[hookName];\n  if (!callbacks) {\n    callbacks = [];\n  }\n  if (isArray(callback)) {\n    callbacks = callbacks.concat(callback);\n  } else {\n    callbacks.push(callback);\n  }\n  this._hooks[hookName] = callbacks;\n}\n\nexport function removeHook (hookName, callback) {\n  const callbacks = this._hooks[hookName];\n  if (!callbacks || callbacks.length === 0) {\n    return this;\n  }\n  if (!callback) {\n    callbacks.splice(0, callbacks.length);\n  } else {\n    for (let i = 0; i < callbacks.length; ++i) {\n      if (callbacks[i] === callback) {\n        callbacks.splice(i, 1);\n        break;\n      }\n    }\n  }\n  return this;\n}\n\nexport function callHooks (hookName, params) {\n  const _callbacks = this._hooks[hookName] || [];\n  for (let i = 0; i < _callbacks.length; ++i) {\n    _callbacks[i].apply(this, params);\n  }\n}\n","// å¼‚æ­¥æ‰§è¡Œ\n// å¦‚æœ Promise å¯ç”¨ï¼Œå°±ç”¨ Promiseï¼Œå¦åˆ™ç”¨ setTimeout\nlet resolved = typeof Promise!=='undefined' && Promise.resolve();\nexport const defer = resolved ? (f => { resolved.then(f); }) : setTimeout;\n\nlet renderCallbacks = [];\n\nlet nextTickCallbacks = [];\n\nlet isDirty = false;\n\nexport function nextTick(callback) {\n  nextTickCallbacks.push(callback);\n  if (renderCallbacks.length === 0) {\n    defer(doNextTick);\n  }\n}\n\nexport function enqueueRender(component) {\n  if (!component._dirty && (component._dirty = true) && renderCallbacks.push(component)===1) {\n    isDirty = true;\n    defer(rerender);\n  }\n}\n\nfunction doNextTick() {\n  if (isDirty) {\n    // wait for rendering\n    return false;\n  }\n  let p, list = nextTickCallbacks;\n  nextTickCallbacks = [];\n  while ((p = list.shift())) {\n    p();\n  }\n}\n\nfunction rerender() {\n  let p, list = renderCallbacks;\n  renderCallbacks = [];\n  while ( (p = list.pop()) ) {\n    if (p._dirty) {\n      p.update();\n    }\n  }\n  isDirty = false;\n  doNextTick();\n}\n","import { getElement, appendChild, replaceNode, removeNode } from './dom';\nimport { diff } from './vdom/diff';\nimport { applyPatch } from './vdom/patch';\nimport h from './vdom/h';\nimport { warn, deepExtend, clone, isFunction, isPlainObject, toArray, isArray, isUndefined } from './utils';\nimport { addHook, removeHook, callHooks } from './api/hooks';\nimport { NaiveException } from './exception';\nimport { enqueueRender, nextTick as nextTickDefer } from './defer';\n\nlet componentId = 1;\n\n// ç”Ÿæˆï¼ˆé‡æ–°ç”Ÿæˆï¼‰ vdom çš„æ—¶æœº:\n// 1. åˆå§‹åŒ–çš„æ—¶å€™\n// 2. update çš„æ—¶å€™\n// 3. render çš„æ—¶å€™\n\n// render çš„æ—¶æœº:\n// 1. mount çš„æ—¶å€™\n// 2. çˆ¶èŠ‚ç‚¹æ›´æ–°çš„æ—¶å€™\n\n// å› ä¸ºæ˜¯åœ¨åº”ç”¨å†…ç”Ÿæˆçš„ç»„ä»¶ï¼Œæ‰€ä»¥ä¸éœ€è¦ç”¨ uuid ç®—æ³•ï¼Œåªéœ€è¦ä¿è¯åœ¨åº”ç”¨å†…å”¯ä¸€å³å¯\n// componentId ä¿è¯ component ç±»å‹çš„å”¯ä¸€æ€§ï¼Œæ—¶é—´æˆ³ä¿è¯ç»„ä»¶å”¯ä¸€æ€§\nfunction uuid() {\n  return '$naive-component-' + componentId++ + '-' + new Date().getTime();\n}\n\nfunction emptyRender () {\n  return null;\n}\n\nexport default function Naive (options) {\n  options = options || {};\n  this.name = options.name || '';\n  this.key = options.key || uuid();\n  this._hooks = {};\n  if ('state' in options) {\n    if (!isFunction(options.state)) {\n      throw new NaiveException('state å¿…é¡»æ˜¯ [Function]');\n    }\n    const _state = options.state();\n    if (isPlainObject(_state)) {\n      this.state = _state;\n    } else {\n      throw new NaiveException('state å¿…é¡»è¿”å› [Plain Object]');\n    }\n  } else {\n    this.state = {};\n  }\n  this.props = {};\n  const combineProps = {};\n  // åˆå¹¶ state å’Œ options.props\n  if (options.props) {\n    for (let p in options.props) {\n      if (options.props.hasOwnProperty(p)) {\n        this.props[p] = options.props[p];\n        if (/^:/.test(p)) {\n          combineProps[p.slice(1)] = options.props[p];\n        } else {\n          combineProps[p] = String(options.props[p]);\n        }\n      }\n    }\n  }\n  deepExtend(this.state, combineProps)\n  const context = this;\n  const _vdomRender = options.render || emptyRender;\n  const _templateHelpers = {\n    \"if\": function (condition, options) {\n      condition = !!condition;\n      return condition ? h.call(context, options) : condition;\n    },\n    \"each\": function (list, iteratorCount, createItem) {\n      const nodes = [];\n      if (isArray(list)) {\n        for (let i = 0; i < list.length; ++i) {\n          const item = list[i];\n          const _itemUid = isPlainObject(item) && 'id' in item ? item['id'] : i;\n          let params = [item, _itemUid];\n          if (iteratorCount === 2) {\n            params = [item, i, _itemUid];\n          } else if (iteratorCount === 3) {\n            params = [item, i, i, _itemUid];\n          }\n          nodes.push(h(createItem.apply(context, params)));\n        }\n      } else {\n        let idx = 0;\n        for (let p in list) {\n          if (list.hasOwnProperty(p)) {\n            const item = list[p];\n            const _itemUid = isPlainObject(item) && 'id' in item ? item['id'] : p;\n            let params = [item, _itemUid];\n            if (iteratorCount === 2) {\n              params = [item, p, _itemUid];\n            } else if (iteratorCount === 3) {\n              params = [item, p, idx, _itemUid];\n            }\n            nodes.push(h(createItem.apply(context, params)));\n            idx++;\n          }\n        }\n      }\n      return nodes;\n    }\n  };\n  this.vdomRender = function vdomRender () {\n    const vdom = _vdomRender.call(\n      this,\n      function createVdom () {\n        return h.apply(context, toArray(arguments));\n      },\n      _templateHelpers\n    );\n    return vdom;\n  };\n  this.$root = null; // ç¬¬ä¸€æ¬¡ render ä¹‹åæ‰ä¼šç”Ÿæˆ $root\n  this.components = {}; // ç»„ä»¶æè¿°å¯¹è±¡åˆ—è¡¨\n  this._components = {}; // ç»„ä»¶å®ä¾‹æ˜ å°„\n  const componentsOptions = options.components || {};\n  for (let p in componentsOptions) {\n    if (componentsOptions.hasOwnProperty(p)) {\n      const componentDefine = componentsOptions[p] || {};\n      componentDefine.name = componentDefine.name || p;\n      componentDefine.parent = this;\n      this.components[p] = createComponentCreator(this, componentDefine);\n    }\n  }\n  this.parent = options.parent || null;\n  this._init(options);\n  this._callHooks('created');\n}\n\nfunction createComponentCreator (context, componentDefine) {\n  return function createComponent(props, children, key) {\n    if (!key || !context._components[key]) {\n      const options = deepExtend({}, componentDefine, {props: props, key: key})\n      const newChild = new Naive(options);\n      context._components[key] = newChild;\n    } else {\n      updateProps(context._components[key], props);\n    }\n    return context._components[key];\n  };\n}\n\nconst prtt = Naive.prototype;\n\n// æ ¹æ® vdom ç”Ÿæˆ dom\n// è¿™é‡Œä¸ä¼šæ›´æ–° state\nprtt.render = function render () {\n  this.vdom = this.vdomRender();\n  this.$root = this.vdom.render(this);\n  return this.$root;\n};\n\nfunction simpleExtend(dest, src) {\n  if (!isPlainObject(src)) {\n    return dest;\n  }\n  for (let p in dest) {\n    if (dest.hasOwnProperty(p)) {\n      if (!isUndefined(src[p])) {\n        dest[p] = src[p]\n      }\n    }\n  }\n  return dest;\n}\n\nprtt.setState = function setState (state) {\n  // console.count('setState');\n  // @TODO ä¸èƒ½ä½¿ç”¨åŒä¸€ä¸ª state\n  if (state === this.state) {\n    warn('åŒä¸€ä¸ª state');\n  }\n  simpleExtend(this.state, state);\n  enqueueRender(this);\n  return this;\n};\n\n// æ›´æ–°è§†å›¾\nprtt.update = function update () {\n  // console.count('update');\n  if (!this.$root) {\n    return this;\n  }\n  const preVdom = this.vdom;\n  this.vdom = this.vdomRender();\n  // console.log(preVdom, this.vdom);\n  const patches = diff(preVdom, this.vdom);\n  // console.log(patches);\n  if (patches) {\n    applyPatch(this, this.$root, patches);\n  } else {\n    warn('ä¸éœ€è¦æ›´æ–°è§†å›¾');\n  }\n  this._callHooks('updated', [clone(this.state)]);\n  this._dirty = false;\n  return this;\n};\n\n// nextTick\nprtt.nextTick = function nextTick(callback) {\n  nextTickDefer(callback);\n};\n\nfunction updateProps (component, props) {\n  const combineProps = {};\n  if (props) {\n    for (let p in props) {\n      if (props.hasOwnProperty(p)) {\n        component.props[p] = props[p];\n        if (/^:/.test(p)) {\n          combineProps[p.slice(1)] = props[p];\n        } else {\n          combineProps[p] = String(props[p]);\n        }\n      }\n    }\n  }\n  deepExtend(component.state, combineProps);\n};\n\nprtt._init = function _init (options) {\n  const methods = options.methods || {};\n  // å°† methods ç§»åˆ° this\n  for (let m in methods) {\n    if (methods.hasOwnProperty(m)) {\n      if (this.hasOwnProperty(m)) {\n        warn(`å±æ€§ \"${m}\" å·²å­˜åœ¨`);\n      } else {\n        this[m] = methods[m];\n      }\n    }\n  }\n  const hooks = options.hooks || {};\n  for (let p in hooks) {\n    if (hooks.hasOwnProperty(p)) {\n      this._addHook(p, hooks[p]);\n    }\n  }\n  if (options.init) {\n    options.init.call(this);\n  }\n  this.vdom = this.vdomRender();\n};\n\nprtt.mount = function mount (selector) {\n  const mountPoint = typeof selector === 'string' ? getElement(selector) : selector;\n  if (!mountPoint) {\n    throw new NaiveException('æ‰¾ä¸åˆ°æŒ‚è½½èŠ‚ç‚¹');\n  }\n  if (this.$root) {\n    replaceNode(this.$root, mountPoint);\n  } else {\n    replaceNode(this.render(), mountPoint);\n  }\n  this._callHooks('mounted', [this.$root]);\n};\n\nprtt.unmount = function unmount () {\n  if (!this.$root) {\n    return this;\n  }\n  this._callHooks('beforeUnmount');\n  // å…ˆç§»é™¤å­ç»„ä»¶\n  for (let child in this._components) {\n    if (this._components.hasOwnProperty(child)) {\n      this._components[child].unmount()\n    }\n  }\n  removeNode(this.$root);\n  this._callHooks('unmounted');\n};\n\nprtt._callHooks = callHooks;\n\nprtt._addHook = addHook;\n\nprtt._removeHook = removeHook;\n\n// é”€æ¯ç»„ä»¶\nprtt.destroy = function destroy () {\n  // é”€æ¯äº‹ä»¶ç›‘å¬\n  // è°ƒç”¨ destroy å‹¾å­\n  this._callHooks('destroy');\n  // é”€æ¯å‹¾å­å›è°ƒ\n  for (let p in this._hooks) {\n    if (this._hooks.hasOwnProperty(p)) {\n      this._removeHook(p);\n    }\n  }\n};\n"],"names":["sliceArray","Array","prototype","slice","warn","message","window","console","isArray","arr","Object","toString","call","toArray","obj","isUndefined","isObject","clone","deepExtend","isFunction","isString","plainObject","hasOwnProp","hasOwnProperty","isPlainObject","proto","getPrototypeOf","Ctor","constructor","options","name","src","copy","copyIsArray","target","arguments","length","i","undefined","getElement","selector","document","getElementById","query","createElement","tag","createTextNode","text","context","querySelector","removeNode","node","parentNode","removeChild","replaceNode","newNode","replaceChild","appendChild","el","setAttr","attr","value","setAttribute","removeAttr","removeAttribute","supportClassList","classList","hasClass","element","classes","split","filter","s","contains","tmp","className","indexOf","addClass","add","apply","forEach","c","replace","removeClass","remove","RegExp","VText","data","render","renderVTextToTextNode","klass","setValue","join","show","style","display","Cache","limit","size","head","tail","_keymap","create","p","put","key","removed","entry","get","shift","newer","older","returnEntry","pathCache","restoreRE","saved","restore","str","parsePath","path","hit","parts","props","match1","test","match2","Error","_props","j","push","_prop","getObjectFromPath","result","setObjectFromPath","current","parent","model","currentValue","state","type","checked","tagName","multiple","selected","attachEvent","eventName","handler","addEventListener","HtmlBooleanAttributes","handleDirective","directive","bindDirective","handleChange","event","selectValue","currentTarget","currentState","setState","preValue","splice","handleInput","newValue","removeClassAttr","removeValue","handleDirectiveRemove","NaiveException","h","children","components","isVNode","isVText","isVComponent","attrs","VNode","list","String","childNodes","child","concat","count","renderVNodeToElement","nodeContext","_isVComponent","update","_callHooks","Naive","keyIndex","keys","free","item","itemKey","index","reorder","pList","nList","nListIndex","nKeys","nFree","pListIndex","pKeys","pFree","rList","freeIndex","freeCount","deletedItems","pItem","itemIndex","lastFreeIndex","nItem","simulateList","simulateIndex","removes","inserts","simulateItem","k","wantedItem","to","domIndex","domTree","vdomTree","indices","mapping","recurse","rootNode","rootIndex","indexInRange","currentIndex","vChild","nextIndex","min","max","PATCH","ascending","a","b","doRemoveNode","domNode","unmount","doApplyPatches","patches","patch","REPLACE","PROPS","TEXT","REORDER","moves","INSERT","childComponent","$root","REMOVE","COMPONENT","pVdom","nVdom","mount","applyPatch","sort","domMapping","idx","patchReorder","keyMap","toRemove","from","insert","toInsert","insertBefore","isAttrDirective","patchProps","setProps","set","removeProps","objectEquals","JSON","stringify","diffProps","oldTree","newTree","oldTreeProps","newTreeProps","setPropsPatches","removePropsPatches","hasPatch","diffChildren","pChildren","nChildren","parentIndex","parentPatches","diffs","listDiff","orderedList","pLen","oLen","len","pNode","nNode","diffWalk","currentPatches","propsPatches","diff","addHook","hookName","callback","callbacks","_hooks","removeHook","callHooks","params","_callbacks","resolved","Promise","resolve","defer","then","f","setTimeout","renderCallbacks","nextTickCallbacks","isDirty","nextTick","doNextTick","enqueueRender","component","_dirty","rerender","pop","componentId","uuid","Date","getTime","emptyRender","_state","combineProps","_vdomRender","_templateHelpers","condition","iteratorCount","createItem","nodes","_itemUid","vdomRender","vdom","createVdom","_components","componentsOptions","componentDefine","createComponentCreator","_init","createComponent","newChild","prtt","simpleExtend","dest","preVdom","updateProps","methods","m","hooks","_addHook","init","mountPoint","_removeHook","destroy"],"mappings":"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"}